(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[142],{2320:function(g){self,g.exports=(()=>{"use strict";var g={4567:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.AccessibilityManager=void 0;let k=C(9042),x=C(6114),D=C(9924),R=C(844),A=C(5596),B=C(4725),T=C(3656),M=m.AccessibilityManager=class extends R.Disposable{constructor(g,m){super(),this._terminal=g,this._renderService=m,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=document.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let g=0;g<this._terminal.rows;g++)this._rowElements[g]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[g]);if(this._topBoundaryFocusListener=g=>this._handleBoundaryFocus(g,0),this._bottomBoundaryFocusListener=g=>this._handleBoundaryFocus(g,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new D.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(g=>this._handleResize(g.rows))),this.register(this._terminal.onRender(g=>this._refreshRows(g.start,g.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(g=>this._handleChar(g))),this.register(this._terminal.onLineFeed(()=>this._handleChar("\n"))),this.register(this._terminal.onA11yTab(g=>this._handleTab(g))),this.register(this._terminal.onKey(g=>this._handleKey(g.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new A.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,T.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,R.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(g){for(let m=0;m<g;m++)this._handleChar(" ")}_handleChar(g){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==g&&(this._charsToAnnounce+=g):this._charsToAnnounce+=g,"\n"===g&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=k.tooMuchOutput)),x.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityContainer.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,x.isMac&&this._liveRegion.remove()}_handleKey(g){this._clearLiveRegion(),/\p{Control}/u.test(g)||this._charsToConsume.push(g)}_refreshRows(g,m){this._liveRegionDebouncer.refresh(g,m,this._terminal.rows)}_renderRows(g,m){let C=this._terminal.buffer,y=C.lines.length.toString();for(let w=g;w<=m;w++){let g=C.translateBufferLineToString(C.ydisp+w,!0),m=(C.ydisp+w+1).toString(),k=this._rowElements[w];k&&(0===g.length?k.innerText="\xa0":k.textContent=g,k.setAttribute("aria-posinset",m),k.setAttribute("aria-setsize",y))}this._announceCharacters()}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(g,m){let C,y;let w=g.target,k=this._rowElements[0===m?1:this._rowElements.length-2];if(w.getAttribute("aria-posinset")!==(0===m?"1":`${this._terminal.buffer.lines.length}`)&&g.relatedTarget===k){if(0===m?(C=w,y=this._rowElements.pop(),this._rowContainer.removeChild(y)):(C=this._rowElements.shift(),y=w,this._rowContainer.removeChild(C)),C.removeEventListener("focus",this._topBoundaryFocusListener),y.removeEventListener("focus",this._bottomBoundaryFocusListener),0===m){let g=this._createAccessibilityTreeNode();this._rowElements.unshift(g),this._rowContainer.insertAdjacentElement("afterbegin",g)}else{let g=this._createAccessibilityTreeNode();this._rowElements.push(g),this._rowContainer.appendChild(g)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===m?-1:1),this._rowElements[0===m?1:this._rowElements.length-2].focus(),g.preventDefault(),g.stopImmediatePropagation()}}_handleResize(g){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let g=this._rowContainer.children.length;g<this._terminal.rows;g++)this._rowElements[g]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[g]);for(;this._rowElements.length>g;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let g=document.createElement("div");return g.setAttribute("role","listitem"),g.tabIndex=-1,this._refreshRowDimensions(g),g}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let g=0;g<this._terminal.rows;g++)this._refreshRowDimensions(this._rowElements[g])}}_refreshRowDimensions(g){g.style.height=`${this._renderService.dimensions.css.cell.height}px`}};m.AccessibilityManager=y([w(1,B.IRenderService)],M)},3614:(g,m)=>{function i(g){return g.replace(/\r?\n/g,"\r")}function s(g,m){return m?"\x1b[200~"+g+"\x1b[201~":g}function r(g,m,C,y){g=s(g=i(g),C.decPrivateModes.bracketedPasteMode&&!0!==y.rawOptions.ignoreBracketedPasteMode),C.triggerDataEvent(g,!0),m.value=""}function n(g,m,C){let y=C.getBoundingClientRect(),w=g.clientX-y.left-10,k=g.clientY-y.top-10;m.style.width="20px",m.style.height="20px",m.style.left=`${w}px`,m.style.top=`${k}px`,m.style.zIndex="1000",m.focus()}Object.defineProperty(m,"__esModule",{value:!0}),m.rightClickHandler=m.moveTextAreaUnderMouseCursor=m.paste=m.handlePasteEvent=m.copyHandler=m.bracketTextForPaste=m.prepareTextForTerminal=void 0,m.prepareTextForTerminal=i,m.bracketTextForPaste=s,m.copyHandler=function(g,m){g.clipboardData&&g.clipboardData.setData("text/plain",m.selectionText),g.preventDefault()},m.handlePasteEvent=function(g,m,C,y){g.stopPropagation(),g.clipboardData&&r(g.clipboardData.getData("text/plain"),m,C,y)},m.paste=r,m.moveTextAreaUnderMouseCursor=n,m.rightClickHandler=function(g,m,C,y,w){n(g,m,C),w&&y.rightClickSelect(g),m.value=y.selectionText,m.select()}},7239:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.ColorContrastCache=void 0;let y=C(1505);m.ColorContrastCache=class{constructor(){this._color=new y.TwoKeyMap,this._css=new y.TwoKeyMap}setCss(g,m,C){this._css.set(g,m,C)}getCss(g,m){return this._css.get(g,m)}setColor(g,m,C){this._color.set(g,m,C)}getColor(g,m){return this._color.get(g,m)}clear(){this._color.clear(),this._css.clear()}}},3656:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.addDisposableDomListener=void 0,m.addDisposableDomListener=function(g,m,C,y){g.addEventListener(m,C,y);let w=!1;return{dispose:()=>{w||(w=!0,g.removeEventListener(m,C,y))}}}},6465:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.Linkifier2=void 0;let k=C(3656),x=C(8460),D=C(844),R=C(2585),A=m.Linkifier2=class extends D.Disposable{get currentLink(){return this._currentLink}constructor(g){super(),this._bufferService=g,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new x.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new x.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,D.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,D.toDisposable)(()=>{this._lastMouseEvent=void 0})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0}))}registerLinkProvider(g){return this._linkProviders.push(g),{dispose:()=>{let m=this._linkProviders.indexOf(g);-1!==m&&this._linkProviders.splice(m,1)}}}attachToDom(g,m,C){this._element=g,this._mouseService=m,this._renderService=C,this.register((0,k.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,k.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,k.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,k.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(g){if(this._lastMouseEvent=g,!this._element||!this._mouseService)return;let m=this._positionFromMouseEvent(g,this._element,this._mouseService);if(!m)return;this._isMouseOut=!1;let C=g.composedPath();for(let g=0;g<C.length;g++){let m=C[g];if(m.classList.contains("xterm"))break;if(m.classList.contains("xterm-hover"))return}this._lastBufferCell&&m.x===this._lastBufferCell.x&&m.y===this._lastBufferCell.y||(this._handleHover(m),this._lastBufferCell=m)}_handleHover(g){if(this._activeLine!==g.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(g,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,g)||(this._clearCurrentLink(),this._askForLink(g,!0))}_askForLink(g,m){var C,y;this._activeProviderReplies&&m||(null===(C=this._activeProviderReplies)||void 0===C||C.forEach(g=>{null==g||g.forEach(g=>{g.link.dispose&&g.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=g.y);let w=!1;for(let[C,k]of this._linkProviders.entries())m?(null===(y=this._activeProviderReplies)||void 0===y?void 0:y.get(C))&&(w=this._checkLinkProviderResult(C,g,w)):k.provideLinks(g.y,m=>{var y,k;if(this._isMouseOut)return;let x=null==m?void 0:m.map(g=>({link:g}));null===(y=this._activeProviderReplies)||void 0===y||y.set(C,x),w=this._checkLinkProviderResult(C,g,w),(null===(k=this._activeProviderReplies)||void 0===k?void 0:k.size)===this._linkProviders.length&&this._removeIntersectingLinks(g.y,this._activeProviderReplies)})}_removeIntersectingLinks(g,m){let C=new Set;for(let y=0;y<m.size;y++){let w=m.get(y);if(w)for(let m=0;m<w.length;m++){let y=w[m],k=y.link.range.start.y<g?0:y.link.range.start.x,x=y.link.range.end.y>g?this._bufferService.cols:y.link.range.end.x;for(let g=k;g<=x;g++){if(C.has(g)){w.splice(m--,1);break}C.add(g)}}}}_checkLinkProviderResult(g,m,C){var y;if(!this._activeProviderReplies)return C;let w=this._activeProviderReplies.get(g),k=!1;for(let m=0;m<g;m++)this._activeProviderReplies.has(m)&&!this._activeProviderReplies.get(m)||(k=!0);if(!k&&w){let g=w.find(g=>this._linkAtPosition(g.link,m));g&&(C=!0,this._handleNewLink(g))}if(this._activeProviderReplies.size===this._linkProviders.length&&!C)for(let g=0;g<this._activeProviderReplies.size;g++){let w=null===(y=this._activeProviderReplies.get(g))||void 0===y?void 0:y.find(g=>this._linkAtPosition(g.link,m));if(w){C=!0,this._handleNewLink(w);break}}return C}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(g){if(!this._element||!this._mouseService||!this._currentLink)return;let m=this._positionFromMouseEvent(g,this._element,this._mouseService);m&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,m)&&this._currentLink.link.activate(g,this._currentLink.link.text)}_clearCurrentLink(g,m){this._element&&this._currentLink&&this._lastMouseEvent&&(!g||!m||this._currentLink.link.range.start.y>=g&&this._currentLink.link.range.end.y<=m)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,D.disposeArray)(this._linkCacheDisposables))}_handleNewLink(g){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;let m=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);m&&this._linkAtPosition(g.link,m)&&(this._currentLink=g,this._currentLink.state={decorations:{underline:void 0===g.link.decorations||g.link.decorations.underline,pointerCursor:void 0===g.link.decorations||g.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,g.link,this._lastMouseEvent),g.link.decorations={},Object.defineProperties(g.link.decorations,{pointerCursor:{get:()=>{var g,m;return null===(m=null===(g=this._currentLink)||void 0===g?void 0:g.state)||void 0===m?void 0:m.decorations.pointerCursor},set:g=>{var m,C;(null===(m=this._currentLink)||void 0===m?void 0:m.state)&&this._currentLink.state.decorations.pointerCursor!==g&&(this._currentLink.state.decorations.pointerCursor=g,this._currentLink.state.isHovered&&(null===(C=this._element)||void 0===C||C.classList.toggle("xterm-cursor-pointer",g)))}},underline:{get:()=>{var g,m;return null===(m=null===(g=this._currentLink)||void 0===g?void 0:g.state)||void 0===m?void 0:m.decorations.underline},set:m=>{var C,y,w;(null===(C=this._currentLink)||void 0===C?void 0:C.state)&&(null===(w=null===(y=this._currentLink)||void 0===y?void 0:y.state)||void 0===w?void 0:w.decorations.underline)!==m&&(this._currentLink.state.decorations.underline=m,this._currentLink.state.isHovered&&this._fireUnderlineEvent(g.link,m))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(g=>{if(!this._currentLink)return;let m=0===g.start?0:g.start+1+this._bufferService.buffer.ydisp,C=this._bufferService.buffer.ydisp+1+g.end;if(this._currentLink.link.range.start.y>=m&&this._currentLink.link.range.end.y<=C&&(this._clearCurrentLink(m,C),this._lastMouseEvent&&this._element)){let g=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);g&&this._askForLink(g,!1)}})))}_linkHover(g,m,C){var y;(null===(y=this._currentLink)||void 0===y?void 0:y.state)&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(m,!0),this._currentLink.state.decorations.pointerCursor&&g.classList.add("xterm-cursor-pointer")),m.hover&&m.hover(C,m.text)}_fireUnderlineEvent(g,m){let C=g.range,y=this._bufferService.buffer.ydisp,w=this._createLinkUnderlineEvent(C.start.x-1,C.start.y-y-1,C.end.x,C.end.y-y-1,void 0);(m?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(w)}_linkLeave(g,m,C){var y;(null===(y=this._currentLink)||void 0===y?void 0:y.state)&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(m,!1),this._currentLink.state.decorations.pointerCursor&&g.classList.remove("xterm-cursor-pointer")),m.leave&&m.leave(C,m.text)}_linkAtPosition(g,m){let C=g.range.start.y*this._bufferService.cols+g.range.start.x,y=g.range.end.y*this._bufferService.cols+g.range.end.x,w=m.y*this._bufferService.cols+m.x;return C<=w&&w<=y}_positionFromMouseEvent(g,m,C){let y=C.getCoords(g,m,this._bufferService.cols,this._bufferService.rows);if(y)return{x:y[0],y:y[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(g,m,C,y,w){return{x1:g,y1:m,x2:C,y2:y,cols:this._bufferService.cols,fg:w}}};m.Linkifier2=y([w(0,R.IBufferService)],A)},9042:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.tooMuchOutput=m.promptLabel=void 0,m.promptLabel="Terminal input",m.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.OscLinkProvider=void 0;let k=C(511),x=C(2585),D=m.OscLinkProvider=class{constructor(g,m,C){this._bufferService=g,this._optionsService=m,this._oscLinkService=C}provideLinks(g,m){var C;let y=this._bufferService.buffer.lines.get(g-1);if(!y)return void m(void 0);let w=[],x=this._optionsService.rawOptions.linkHandler,D=new k.CellData,R=y.getTrimmedLength(),A=-1,B=-1,T=!1;for(let m=0;m<R;m++)if(-1!==B||y.hasContent(m)){if(y.loadCell(m,D),D.hasExtendedAttrs()&&D.extended.urlId){if(-1===B){B=m,A=D.extended.urlId;continue}T=D.extended.urlId!==A}else -1!==B&&(T=!0);if(T||-1!==B&&m===R-1){let y=null===(C=this._oscLinkService.getLinkData(A))||void 0===C?void 0:C.uri;if(y){let C={start:{x:B+1,y:g},end:{x:m+(T||m!==R-1?0:1),y:g}},k=!1;if(!(null==x?void 0:x.allowNonHttpProtocols))try{let g=new URL(y);["http:","https:"].includes(g.protocol)||(k=!0)}catch(g){k=!0}k||w.push({text:y,range:C,activate:(g,m)=>x?x.activate(g,m,C):function(g,m){if(confirm(`Do you want to navigate to ${m}?

WARNING: This link could potentially be dangerous`)){let g=window.open();if(g){try{g.opener=null}catch(g){}g.location.href=m}else console.warn("Opening link blocked as opener could not be cleared")}}(0,m),hover:(g,m)=>{var y;return null===(y=null==x?void 0:x.hover)||void 0===y?void 0:y.call(x,g,m,C)},leave:(g,m)=>{var y;return null===(y=null==x?void 0:x.leave)||void 0===y?void 0:y.call(x,g,m,C)}})}T=!1,D.hasExtendedAttrs()&&D.extended.urlId?(B=m,A=D.extended.urlId):(B=-1,A=-1)}}m(w)}};m.OscLinkProvider=y([w(0,x.IBufferService),w(1,x.IOptionsService),w(2,x.IOscLinkService)],D)},6193:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.RenderDebouncer=void 0,m.RenderDebouncer=class{constructor(g,m){this._parentWindow=g,this._renderCallback=m,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(g){return this._refreshCallbacks.push(g),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(g,m,C){this._rowCount=C,g=void 0!==g?g:0,m=void 0!==m?m:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,g):g,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,m):m,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();let g=Math.max(this._rowStart,0),m=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(g,m),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let g of this._refreshCallbacks)g(0);this._refreshCallbacks=[]}}},5596:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.ScreenDprMonitor=void 0;let y=C(844);let r=class r extends y.Disposable{constructor(g){super(),this._parentWindow=g,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,y.toDisposable)(()=>{this.clearListener()}))}setListener(g){this._listener&&this.clearListener(),this._listener=g,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var g;this._outerListener&&(null===(g=this._resolutionMediaMatchList)||void 0===g||g.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}};m.ScreenDprMonitor=r},3236:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.Terminal=void 0;let y=C(3614),w=C(3656),k=C(6465),x=C(9042),D=C(3730),R=C(1680),A=C(3107),B=C(5744),T=C(2950),M=C(1296),O=C(428),I=C(4269),H=C(5114),F=C(8934),W=C(3230),U=C(9312),N=C(4725),$=C(6731),j=C(8055),z=C(8969),K=C(8460),q=C(844),V=C(6114),G=C(8437),X=C(2584),J=C(7399),Y=C(5941),Z=C(9074),Q=C(2585),ee=C(5435),et=C(4567),ei="undefined"!=typeof window?window.document:null;let P=class P extends z.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(g={}){super(g),this.browser=V,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new q.MutableDisposable),this._onCursorMove=this.register(new K.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new K.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new K.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new K.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new K.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new K.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new K.EventEmitter),this._onBlur=this.register(new K.EventEmitter),this._onA11yCharEmitter=this.register(new K.EventEmitter),this._onA11yTabEmitter=this.register(new K.EventEmitter),this._onWillOpen=this.register(new K.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(k.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(D.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(Z.DecorationService),this._instantiationService.setService(Q.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((g,m)=>this.refresh(g,m))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(g=>this._reportWindowsOptions(g))),this.register(this._inputHandler.onColor(g=>this._handleColorEvent(g))),this.register((0,K.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,K.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,K.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,K.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(g=>this._afterResize(g.cols,g.rows))),this.register((0,q.toDisposable)(()=>{var g,m;this._customKeyEventHandler=void 0,null===(m=null===(g=this.element)||void 0===g?void 0:g.parentNode)||void 0===m||m.removeChild(this.element)}))}_handleColorEvent(g){if(this._themeService)for(let m of g){let g,C="";switch(m.index){case 256:g="foreground",C="10";break;case 257:g="background",C="11";break;case 258:g="cursor",C="12";break;default:g="ansi",C="4;"+m.index}switch(m.type){case 0:let y=j.color.toColorRGB("ansi"===g?this._themeService.colors.ansi[m.index]:this._themeService.colors[g]);this.coreService.triggerDataEvent(`${X.C0.ESC}]${C};${(0,Y.toRgbString)(y)}${X.C1_ESCAPED.ST}`);break;case 1:if("ansi"===g)this._themeService.modifyColors(g=>g.ansi[m.index]=j.rgba.toColor(...m.color));else{let C=g;this._themeService.modifyColors(g=>g[C]=j.rgba.toColor(...m.color))}break;case 2:this._themeService.restoreColor(m.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(g){g?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(et.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(g){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(X.C0.ESC+"[I"),this.updateCursorStyle(g),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var g;return null===(g=this.textarea)||void 0===g?void 0:g.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(X.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let g=this.buffer.ybase+this.buffer.y,m=this.buffer.lines.get(g);if(!m)return;let C=Math.min(this.buffer.x,this.cols-1),y=this._renderService.dimensions.css.cell.height,w=m.getWidth(C),k=this._renderService.dimensions.css.cell.width*w,x=this.buffer.y*this._renderService.dimensions.css.cell.height,D=C*this._renderService.dimensions.css.cell.width;this.textarea.style.left=D+"px",this.textarea.style.top=x+"px",this.textarea.style.width=k+"px",this.textarea.style.height=y+"px",this.textarea.style.lineHeight=y+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,w.addDisposableDomListener)(this.element,"copy",g=>{this.hasSelection()&&(0,y.copyHandler)(g,this._selectionService)}));let e=g=>(0,y.handlePasteEvent)(g,this.textarea,this.coreService,this.optionsService);this.register((0,w.addDisposableDomListener)(this.textarea,"paste",e)),this.register((0,w.addDisposableDomListener)(this.element,"paste",e)),V.isFirefox?this.register((0,w.addDisposableDomListener)(this.element,"mousedown",g=>{2===g.button&&(0,y.rightClickHandler)(g,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,w.addDisposableDomListener)(this.element,"contextmenu",g=>{(0,y.rightClickHandler)(g,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),V.isLinux&&this.register((0,w.addDisposableDomListener)(this.element,"auxclick",g=>{1===g.button&&(0,y.moveTextAreaUnderMouseCursor)(g,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,w.addDisposableDomListener)(this.textarea,"keyup",g=>this._keyUp(g),!0)),this.register((0,w.addDisposableDomListener)(this.textarea,"keydown",g=>this._keyDown(g),!0)),this.register((0,w.addDisposableDomListener)(this.textarea,"keypress",g=>this._keyPress(g),!0)),this.register((0,w.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,w.addDisposableDomListener)(this.textarea,"compositionupdate",g=>this._compositionHelper.compositionupdate(g))),this.register((0,w.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,w.addDisposableDomListener)(this.textarea,"input",g=>this._inputEvent(g),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(g){var m;if(!g)throw Error("Terminal requires a parent element.");g.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=g.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),g.appendChild(this.element);let C=ei.createDocumentFragment();this._viewportElement=ei.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),C.appendChild(this._viewportElement),this._viewportScrollArea=ei.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=ei.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=ei.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),C.appendChild(this.screenElement),this.textarea=ei.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",x.promptLabel),V.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(H.CoreBrowserService,this.textarea,null!==(m=this._document.defaultView)&&void 0!==m?m:window),this._instantiationService.setService(N.ICoreBrowserService,this._coreBrowserService),this.register((0,w.addDisposableDomListener)(this.textarea,"focus",g=>this._handleTextAreaFocus(g))),this.register((0,w.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(O.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(N.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance($.ThemeService),this._instantiationService.setService(N.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(I.CharacterJoinerService),this._instantiationService.setService(N.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(W.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(N.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(g=>this._onRender.fire(g))),this.onResize(g=>this._renderService.resize(g.cols,g.rows)),this._compositionView=ei.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(T.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(C);try{this._onWillOpen.fire(this.element)}catch(g){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(F.MouseService),this._instantiationService.setService(N.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(R.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(g=>this.scrollLines(g.amount,g.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(U.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(N.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(g=>this.scrollLines(g.amount,g.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(g=>this._renderService.handleSelectionChanged(g.start,g.end,g.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(g=>{this.textarea.value=g,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(g=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,w.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(A.BufferDecorationRenderer,this.screenElement)),this.register((0,w.addDisposableDomListener)(this.element,"mousedown",g=>this._selectionService.handleMouseDown(g))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(et.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",g=>this._handleScreenReaderModeOptionChange(g))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(B.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",g=>{!this._overviewRulerRenderer&&g&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(B.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(M.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){let g=this,m=this.element;function i(m){let C,y;let w=g._mouseService.getMouseReportCoords(m,g.screenElement);if(!w)return!1;switch(m.overrideType||m.type){case"mousemove":y=32,void 0===m.buttons?(C=3,void 0!==m.button&&(C=m.button<3?m.button:3)):C=1&m.buttons?0:4&m.buttons?1:2&m.buttons?2:3;break;case"mouseup":y=0,C=m.button<3?m.button:3;break;case"mousedown":y=1,C=m.button<3?m.button:3;break;case"wheel":if(0===g.viewport.getLinesScrolled(m))return!1;y=m.deltaY<0?0:1,C=4;break;default:return!1}return!(void 0===y||void 0===C||C>4)&&g.coreMouseService.triggerMouseEvent({col:w.col,row:w.row,x:w.x,y:w.y,button:C,action:y,ctrl:m.ctrlKey,alt:m.altKey,shift:m.shiftKey})}let C={mouseup:null,wheel:null,mousedrag:null,mousemove:null},y={mouseup:g=>(i(g),g.buttons||(this._document.removeEventListener("mouseup",C.mouseup),C.mousedrag&&this._document.removeEventListener("mousemove",C.mousedrag)),this.cancel(g)),wheel:g=>(i(g),this.cancel(g,!0)),mousedrag:g=>{g.buttons&&i(g)},mousemove:g=>{g.buttons||i(g)}};this.register(this.coreMouseService.onProtocolChange(g=>{g?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(g)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&g?C.mousemove||(m.addEventListener("mousemove",y.mousemove),C.mousemove=y.mousemove):(m.removeEventListener("mousemove",C.mousemove),C.mousemove=null),16&g?C.wheel||(m.addEventListener("wheel",y.wheel,{passive:!1}),C.wheel=y.wheel):(m.removeEventListener("wheel",C.wheel),C.wheel=null),2&g?C.mouseup||(m.addEventListener("mouseup",y.mouseup),C.mouseup=y.mouseup):(this._document.removeEventListener("mouseup",C.mouseup),m.removeEventListener("mouseup",C.mouseup),C.mouseup=null),4&g?C.mousedrag||(C.mousedrag=y.mousedrag):(this._document.removeEventListener("mousemove",C.mousedrag),C.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,w.addDisposableDomListener)(m,"mousedown",g=>{if(g.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(g))return i(g),C.mouseup&&this._document.addEventListener("mouseup",C.mouseup),C.mousedrag&&this._document.addEventListener("mousemove",C.mousedrag),this.cancel(g)})),this.register((0,w.addDisposableDomListener)(m,"wheel",g=>{if(!C.wheel){if(!this.buffer.hasScrollback){let m=this.viewport.getLinesScrolled(g);if(0===m)return;let C=X.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(g.deltaY<0?"A":"B"),y="";for(let g=0;g<Math.abs(m);g++)y+=C;return this.coreService.triggerDataEvent(y,!0),this.cancel(g,!0)}return this.viewport.handleWheel(g)?this.cancel(g):void 0}},{passive:!1})),this.register((0,w.addDisposableDomListener)(m,"touchstart",g=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(g),this.cancel(g)},{passive:!0})),this.register((0,w.addDisposableDomListener)(m,"touchmove",g=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(g)?void 0:this.cancel(g)},{passive:!1}))}refresh(g,m){var C;null===(C=this._renderService)||void 0===C||C.refreshRows(g,m)}updateCursorStyle(g){var m;(null===(m=this._selectionService)||void 0===m?void 0:m.shouldColumnSelect(g))?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(g,m,C=0){var y;1===C?(super.scrollLines(g,m,C),this.refresh(0,this.rows-1)):null===(y=this.viewport)||void 0===y||y.scrollLines(g)}paste(g){(0,y.paste)(g,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(g){this._customKeyEventHandler=g}registerLinkProvider(g){return this.linkifier2.registerLinkProvider(g)}registerCharacterJoiner(g){if(!this._characterJoinerService)throw Error("Terminal must be opened first");let m=this._characterJoinerService.register(g);return this.refresh(0,this.rows-1),m}deregisterCharacterJoiner(g){if(!this._characterJoinerService)throw Error("Terminal must be opened first");this._characterJoinerService.deregister(g)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(g){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+g)}registerDecoration(g){return this._decorationService.registerDecoration(g)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(g,m,C){this._selectionService.setSelection(g,m,C)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var g;null===(g=this._selectionService)||void 0===g||g.clearSelection()}selectAll(){var g;null===(g=this._selectionService)||void 0===g||g.selectAll()}selectLines(g,m){var C;null===(C=this._selectionService)||void 0===C||C.selectLines(g,m)}_keyDown(g){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(g))return!1;let m=this.browser.isMac&&this.options.macOptionIsMeta&&g.altKey;if(!m&&!this._compositionHelper.keydown(g))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;m||"Dead"!==g.key&&"AltGraph"!==g.key||(this._unprocessedDeadKey=!0);let C=(0,J.evaluateKeyboardEvent)(g,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(g),3===C.type||2===C.type){let m=this.rows-1;return this.scrollLines(2===C.type?-m:m),this.cancel(g,!0)}return 1===C.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,g)||(C.cancel&&this.cancel(g,!0),!C.key||!!(g.key&&!g.ctrlKey&&!g.altKey&&!g.metaKey&&1===g.key.length&&g.key.charCodeAt(0)>=65&&90>=g.key.charCodeAt(0))||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(C.key!==X.C0.ETX&&C.key!==X.C0.CR||(this.textarea.value=""),this._onKey.fire({key:C.key,domEvent:g}),this._showCursor(),this.coreService.triggerDataEvent(C.key,!0),!this.optionsService.rawOptions.screenReaderMode||g.altKey||g.ctrlKey?this.cancel(g,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(g,m){let C=g.isMac&&!this.options.macOptionIsMeta&&m.altKey&&!m.ctrlKey&&!m.metaKey||g.isWindows&&m.altKey&&m.ctrlKey&&!m.metaKey||g.isWindows&&m.getModifierState("AltGraph");return"keypress"===m.type?C:C&&(!m.keyCode||m.keyCode>47)}_keyUp(g){this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(g)||(16===g.keyCode||17===g.keyCode||18===g.keyCode||this.focus(),this.updateCursorStyle(g),this._keyPressHandled=!1)}_keyPress(g){let m;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&!1===this._customKeyEventHandler(g))return!1;if(this.cancel(g),g.charCode)m=g.charCode;else if(null===g.which||void 0===g.which)m=g.keyCode;else{if(0===g.which||0===g.charCode)return!1;m=g.which}return!(!m||(g.altKey||g.ctrlKey||g.metaKey)&&!this._isThirdLevelShift(this.browser,g)||(m=String.fromCharCode(m),this._onKey.fire({key:m,domEvent:g}),this._showCursor(),this.coreService.triggerDataEvent(m,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(g){if(g.data&&"insertText"===g.inputType&&(!g.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let m=g.data;return this.coreService.triggerDataEvent(m,!0),this.cancel(g),!0}return!1}resize(g,m){g!==this.cols||m!==this.rows?super.resize(g,m):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(g,m){var C,y;null===(C=this._charSizeService)||void 0===C||C.measure(),null===(y=this.viewport)||void 0===y||y.syncScrollArea(!0)}clear(){var g;if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let g=1;g<this.rows;g++)this.buffer.lines.push(this.buffer.getBlankLine(G.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),null===(g=this.viewport)||void 0===g||g.reset(),this.refresh(0,this.rows-1)}}reset(){var g,m;this.options.rows=this.rows,this.options.cols=this.cols;let C=this._customKeyEventHandler;this._setup(),super.reset(),null===(g=this._selectionService)||void 0===g||g.reset(),this._decorationService.reset(),null===(m=this.viewport)||void 0===m||m.reset(),this._customKeyEventHandler=C,this.refresh(0,this.rows-1)}clearTextureAtlas(){var g;null===(g=this._renderService)||void 0===g||g.clearTextureAtlas()}_reportFocus(){var g;(null===(g=this.element)||void 0===g?void 0:g.classList.contains("focus"))?this.coreService.triggerDataEvent(X.C0.ESC+"[I"):this.coreService.triggerDataEvent(X.C0.ESC+"[O")}_reportWindowsOptions(g){if(this._renderService)switch(g){case ee.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:let m=this._renderService.dimensions.css.canvas.width.toFixed(0),C=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${X.C0.ESC}[4;${C};${m}t`);break;case ee.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:let y=this._renderService.dimensions.css.cell.width.toFixed(0),w=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${X.C0.ESC}[6;${w};${y}t`)}}cancel(g,m){if(this.options.cancelEvents||m)return g.preventDefault(),g.stopPropagation(),!1}};m.Terminal=P},9924:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.TimeBasedDebouncer=void 0,m.TimeBasedDebouncer=class{constructor(g,m=1e3){this._renderCallback=g,this._debounceThresholdMS=m,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(g,m,C){this._rowCount=C,g=void 0!==g?g:0,m=void 0!==m?m:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,g):g,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,m):m;let y=Date.now();if(y-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=y,this._innerRefresh();else if(!this._additionalRefreshRequested){let g=y-this._lastRefreshMs,m=this._debounceThresholdMS-g;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},m)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;let g=Math.max(this._rowStart,0),m=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(g,m)}}},1680:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.Viewport=void 0;let k=C(3656),x=C(4725),D=C(8460),R=C(844),A=C(2585),B=m.Viewport=class extends R.Disposable{constructor(g,m,C,y,w,x,R,A){super(),this._viewportElement=g,this._scrollArea=m,this._bufferService=C,this._optionsService=y,this._charSizeService=w,this._renderService=x,this._coreBrowserService=R,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new D.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,k.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(g=>this._activeBuffer=g.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(g=>this._renderDimensions=g)),this._handleThemeChange(A.colors),this.register(A.onChangeColors(g=>this._handleThemeChange(g))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(g){this._viewportElement.style.backgroundColor=g.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(g){if(g)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;let g=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==g&&(this._lastRecordedBufferHeight=g,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}let g=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==g&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=g),this._refreshAnimationFrame=null}syncScrollArea(g=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(g);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(g)}_handleScroll(g){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});let m=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:m,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||-1===this._smoothScrollState.origin||-1===this._smoothScrollState.target)return;let g=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(g*(this._smoothScrollState.target-this._smoothScrollState.origin)),g<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(g,m){let C=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(m<0&&0!==this._viewportElement.scrollTop||m>0&&C<this._lastRecordedBufferHeight)||(g.cancelable&&g.preventDefault(),!1)}handleWheel(g){let m=this._getPixelsScrolled(g);return 0!==m&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),1>this._smoothScrollPercent()?(this._smoothScrollState.origin=this._viewportElement.scrollTop,-1===this._smoothScrollState.target?this._smoothScrollState.target=this._viewportElement.scrollTop+m:this._smoothScrollState.target+=m,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=m,this._bubbleScroll(g,m))}scrollLines(g){if(0!==g){if(this._optionsService.rawOptions.smoothScrollDuration){let m=g*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),1>this._smoothScrollPercent()?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+m,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:g,suppressScrollEvent:!1})}}_getPixelsScrolled(g){if(0===g.deltaY||g.shiftKey)return 0;let m=this._applyScrollModifier(g.deltaY,g);return g.deltaMode===WheelEvent.DOM_DELTA_LINE?m*=this._currentRowHeight:g.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(m*=this._currentRowHeight*this._bufferService.rows),m}getBufferElements(g,m){var C;let y,w="",k=[],x=null!=m?m:this._bufferService.buffer.lines.length,D=this._bufferService.buffer.lines;for(let m=g;m<x;m++){let g=D.get(m);if(!g)continue;let x=null===(C=D.get(m+1))||void 0===C?void 0:C.isWrapped;if(w+=g.translateToString(!x),!x||m===D.length-1){let g=document.createElement("div");g.textContent=w,k.push(g),w.length>0&&(y=g),w=""}}return{bufferElements:k,cursorElement:y}}getLinesScrolled(g){if(0===g.deltaY||g.shiftKey)return 0;let m=this._applyScrollModifier(g.deltaY,g);return g.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(m/=this._currentRowHeight+0,this._wheelPartialScroll+=m,m=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):g.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(m*=this._bufferService.rows),m}_applyScrollModifier(g,m){let C=this._optionsService.rawOptions.fastScrollModifier;return"alt"===C&&m.altKey||"ctrl"===C&&m.ctrlKey||"shift"===C&&m.shiftKey?g*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:g*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(g){this._lastTouchY=g.touches[0].pageY}handleTouchMove(g){let m=this._lastTouchY-g.touches[0].pageY;return this._lastTouchY=g.touches[0].pageY,0!==m&&(this._viewportElement.scrollTop+=m,this._bubbleScroll(g,m))}};m.Viewport=y([w(2,A.IBufferService),w(3,A.IOptionsService),w(4,x.ICharSizeService),w(5,x.IRenderService),w(6,x.ICoreBrowserService),w(7,x.IThemeService)],B)},3107:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.BufferDecorationRenderer=void 0;let k=C(3656),x=C(4725),D=C(844),R=C(2585),A=m.BufferDecorationRenderer=class extends D.Disposable{constructor(g,m,C,y){super(),this._screenElement=g,this._bufferService=m,this._decorationService=C,this._renderService=y,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,k.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(g=>this._removeDecoration(g))),this.register((0,D.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let g of this._decorationService.decorations)this._renderDecoration(g);this._dimensionsChanged=!1}_renderDecoration(g){this._refreshStyle(g),this._dimensionsChanged&&this._refreshXPosition(g)}_createElement(g){var m,C;let y=document.createElement("div");y.classList.add("xterm-decoration"),y.classList.toggle("xterm-decoration-top-layer","top"===(null===(m=null==g?void 0:g.options)||void 0===m?void 0:m.layer)),y.style.width=`${Math.round((g.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,y.style.height=(g.options.height||1)*this._renderService.dimensions.css.cell.height+"px",y.style.top=(g.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",y.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let w=null!==(C=g.options.x)&&void 0!==C?C:0;return w&&w>this._bufferService.cols&&(y.style.display="none"),this._refreshXPosition(g,y),y}_refreshStyle(g){let m=g.marker.line-this._bufferService.buffers.active.ydisp;if(m<0||m>=this._bufferService.rows)g.element&&(g.element.style.display="none",g.onRenderEmitter.fire(g.element));else{let C=this._decorationElements.get(g);C||(C=this._createElement(g),g.element=C,this._decorationElements.set(g,C),this._container.appendChild(C),g.onDispose(()=>{this._decorationElements.delete(g),C.remove()})),C.style.top=m*this._renderService.dimensions.css.cell.height+"px",C.style.display=this._altBufferIsActive?"none":"block",g.onRenderEmitter.fire(C)}}_refreshXPosition(g,m=g.element){var C;if(!m)return;let y=null!==(C=g.options.x)&&void 0!==C?C:0;"right"===(g.options.anchor||"left")?m.style.right=y?y*this._renderService.dimensions.css.cell.width+"px":"":m.style.left=y?y*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(g){var m;null===(m=this._decorationElements.get(g))||void 0===m||m.remove(),this._decorationElements.delete(g),g.dispose()}};m.BufferDecorationRenderer=y([w(1,R.IBufferService),w(2,R.IDecorationService),w(3,x.IRenderService)],A)},5871:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.ColorZoneStore=void 0,m.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(g){if(g.options.overviewRulerOptions){for(let m of this._zones)if(m.color===g.options.overviewRulerOptions.color&&m.position===g.options.overviewRulerOptions.position){if(this._lineIntersectsZone(m,g.marker.line))return;if(this._lineAdjacentToZone(m,g.marker.line,g.options.overviewRulerOptions.position))return void this._addLineToZone(m,g.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=g.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=g.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=g.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=g.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:g.options.overviewRulerOptions.color,position:g.options.overviewRulerOptions.position,startBufferLine:g.marker.line,endBufferLine:g.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(g){this._linePadding=g}_lineIntersectsZone(g,m){return m>=g.startBufferLine&&m<=g.endBufferLine}_lineAdjacentToZone(g,m,C){return m>=g.startBufferLine-this._linePadding[C||"full"]&&m<=g.endBufferLine+this._linePadding[C||"full"]}_addLineToZone(g,m){g.startBufferLine=Math.min(g.startBufferLine,m),g.endBufferLine=Math.max(g.endBufferLine,m)}}},5744:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.OverviewRulerRenderer=void 0;let k=C(5871),x=C(3656),D=C(4725),R=C(844),A=C(2585),B={full:0,left:0,center:0,right:0},T={full:0,left:0,center:0,right:0},M={full:0,left:0,center:0,right:0},O=m.OverviewRulerRenderer=class extends R.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(g,m,C,y,w,x,D){var A;super(),this._viewportElement=g,this._screenElement=m,this._bufferService=C,this._decorationService=y,this._renderService=w,this._optionsService=x,this._coreBrowseService=D,this._colorZoneStore=new k.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),null===(A=this._viewportElement.parentElement)||void 0===A||A.insertBefore(this._canvas,this._viewportElement);let B=this._canvas.getContext("2d");if(!B)throw Error("Ctx cannot be null");this._ctx=B,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,R.toDisposable)(()=>{var g;null===(g=this._canvas)||void 0===g||g.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,x.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){let g=Math.floor(this._canvas.width/3),m=Math.ceil(this._canvas.width/3);T.full=this._canvas.width,T.left=g,T.center=m,T.right=g,this._refreshDrawHeightConstants(),M.full=0,M.left=0,M.center=T.left,M.right=T.left+T.center}_refreshDrawHeightConstants(){B.full=Math.round(2*this._coreBrowseService.dpr);let g=this._canvas.height/this._bufferService.buffer.lines.length,m=Math.round(Math.max(Math.min(g,12),6)*this._coreBrowseService.dpr);B.left=m,B.center=m,B.right=m}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*B.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*B.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*B.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*B.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){for(let g of(this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear(),this._decorationService.decorations))this._colorZoneStore.addDecoration(g);this._ctx.lineWidth=1;let g=this._colorZoneStore.zones;for(let m of g)"full"!==m.position&&this._renderColorZone(m);for(let m of g)"full"===m.position&&this._renderColorZone(m);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(g){this._ctx.fillStyle=g.color,this._ctx.fillRect(M[g.position||"full"],Math.round((this._canvas.height-1)*(g.startBufferLine/this._bufferService.buffers.active.lines.length)-B[g.position||"full"]/2),T[g.position||"full"],Math.round((this._canvas.height-1)*((g.endBufferLine-g.startBufferLine)/this._bufferService.buffers.active.lines.length)+B[g.position||"full"]))}_queueRefresh(g,m){this._shouldUpdateDimensions=g||this._shouldUpdateDimensions,this._shouldUpdateAnchor=m||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};m.OverviewRulerRenderer=y([w(2,A.IBufferService),w(3,A.IDecorationService),w(4,D.IRenderService),w(5,A.IOptionsService),w(6,D.ICoreBrowserService)],O)},2950:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.CompositionHelper=void 0;let k=C(4725),x=C(2585),D=C(2584),R=m.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(g,m,C,y,w,k){this._textarea=g,this._compositionView=m,this._bufferService=C,this._optionsService=y,this._coreService=w,this._renderService=k,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(g){this._compositionView.textContent=g.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(g){if(this._isComposing||this._isSendingComposition){if(229===g.keyCode||16===g.keyCode||17===g.keyCode||18===g.keyCode)return!1;this._finalizeComposition(!1)}return 229!==g.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(g){if(this._compositionView.classList.remove("active"),this._isComposing=!1,g){let g={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let m;this._isSendingComposition=!1,g.start+=this._dataAlreadySent.length,(m=this._isComposing?this._textarea.value.substring(g.start,g.end):this._textarea.value.substring(g.start)).length>0&&this._coreService.triggerDataEvent(m,!0)}},0)}else{this._isSendingComposition=!1;let g=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(g,!0)}}_handleAnyTextareaChanges(){let g=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let m=this._textarea.value,C=m.replace(g,"");this._dataAlreadySent=C,m.length>g.length?this._coreService.triggerDataEvent(C,!0):m.length<g.length?this._coreService.triggerDataEvent(`${D.C0.DEL}`,!0):m.length===g.length&&m!==g&&this._coreService.triggerDataEvent(m,!0)}},0)}updateCompositionElements(g){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let g=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),m=this._renderService.dimensions.css.cell.height,C=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,y=g*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=y+"px",this._compositionView.style.top=C+"px",this._compositionView.style.height=m+"px",this._compositionView.style.lineHeight=m+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let w=this._compositionView.getBoundingClientRect();this._textarea.style.left=y+"px",this._textarea.style.top=C+"px",this._textarea.style.width=Math.max(w.width,1)+"px",this._textarea.style.height=Math.max(w.height,1)+"px",this._textarea.style.lineHeight=w.height+"px"}g||setTimeout(()=>this.updateCompositionElements(!0),0)}}};m.CompositionHelper=y([w(2,x.IBufferService),w(3,x.IOptionsService),w(4,x.ICoreService),w(5,k.IRenderService)],R)},9806:(g,m)=>{function i(g,m,C){let y=C.getBoundingClientRect(),w=g.getComputedStyle(C),k=parseInt(w.getPropertyValue("padding-left")),x=parseInt(w.getPropertyValue("padding-top"));return[m.clientX-y.left-k,m.clientY-y.top-x]}Object.defineProperty(m,"__esModule",{value:!0}),m.getCoords=m.getCoordsRelativeToElement=void 0,m.getCoordsRelativeToElement=i,m.getCoords=function(g,m,C,y,w,k,x,D,R){if(!k)return;let A=i(g,m,C);return A?(A[0]=Math.ceil((A[0]+(R?x/2:0))/x),A[1]=Math.ceil(A[1]/D),A[0]=Math.min(Math.max(A[0],1),y+(R?1:0)),A[1]=Math.min(Math.max(A[1],1),w),A):void 0}},9504:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.moveToCellSequence=void 0;let y=C(2584);function r(g,m,C,y){let w=g-n(g,C),k=m-n(m,C),x=Math.abs(w-k)-function(g,m,C){let y=0,w=g-n(g,C),k=m-n(m,C);for(let x=0;x<Math.abs(w-k);x++){let k="A"==(g>m?"A":"B")?-1:1,D=C.buffer.lines.get(w+k*x);(null==D?void 0:D.isWrapped)&&y++}return y}(g,m,C);return c(x,h(g>m?"A":"B",y))}function n(g,m){let C=0,y=m.buffer.lines.get(g),w=null==y?void 0:y.isWrapped;for(;w&&g>=0&&g<m.rows;)C++,w=null==(y=m.buffer.lines.get(--g))?void 0:y.isWrapped;return C}function a(g,m,C,y,w,k){let x=g,D=m,R="";for(;x!==C||D!==y;)x+=w?1:-1,w&&x>k.cols-1?(R+=k.buffer.translateBufferLineToString(D,!1,g,x),x=0,g=0,D++):!w&&x<0&&(R+=k.buffer.translateBufferLineToString(D,!1,0,g+1),g=x=k.cols-1,D--);return R+k.buffer.translateBufferLineToString(D,!1,g,x)}function h(g,m){return y.C0.ESC+(m?"O":"[")+g}function c(g,m){g=Math.floor(g);let C="";for(let y=0;y<g;y++)C+=m;return C}m.moveToCellSequence=function(g,m,C,y){var w;let k;let x=C.buffer.x,D=C.buffer.y;if(!C.buffer.hasScrollback)return(0===r(D,m,C,y).length?"":c(a(x,D,x,D-n(D,C),!1,C).length,h("D",y)))+r(D,m,C,y)+function(g,m,C,y,w,k){let x,D;x=r(m,y,w,k).length>0?y-n(y,w):m;let R=(D=r(C,y,w,k).length>0?y-n(y,w):m,g<C&&D<=y||g>=C&&D<y?"C":"D");return c(a(g,x,C,y,"C"===R,w).length,h(R,k))}(x,D,g,m,C,y);if(D===m)return k=x>g?"D":"C",c(Math.abs(x-g),h(k,y));k=D>m?"D":"C";let R=Math.abs(D-m);return c((w=D>m?g:x,C.cols-w+(R-1)*C.cols+1+((D>m?x:g)-1)),h(k,y))}},1296:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.DomRenderer=void 0;let k=C(3787),x=C(2550),D=C(2223),R=C(6171),A=C(4725),B=C(8055),T=C(8460),M=C(844),O=C(2585),I="xterm-dom-renderer-owner-",H="xterm-rows",F="xterm-fg-",W="xterm-bg-",U="xterm-focus",N="xterm-selection",$=1,j=m.DomRenderer=class extends M.Disposable{constructor(g,m,C,y,w,D,A,B,O,F){super(),this._element=g,this._screenElement=m,this._viewportElement=C,this._linkifier2=y,this._charSizeService=D,this._optionsService=A,this._bufferService=B,this._coreBrowserService=O,this._themeService=F,this._terminalClass=$++,this._rowElements=[],this.onRequestRedraw=this.register(new T.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add(H),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add(N),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,R.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(g=>this._injectCss(g))),this._injectCss(this._themeService.colors),this._rowFactory=w.createInstance(k.DomRendererRowFactory,document),this._element.classList.add(I+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(g=>this._handleLinkHover(g))),this.register(this._linkifier2.onHideLinkUnderline(g=>this._handleLinkLeave(g))),this.register((0,M.toDisposable)(()=>{this._element.classList.remove(I+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new x.WidthCache(document),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let g=this._coreBrowserService.dpr;for(let m of(this.dimensions.device.char.width=this._charSizeService.width*g,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*g),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/g),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/g),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows,this._rowElements))m.style.width=`${this.dimensions.css.canvas.width}px`,m.style.height=`${this.dimensions.css.cell.height}px`,m.style.lineHeight=`${this.dimensions.css.cell.height}px`,m.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let m=`${this._terminalSelector} .${H} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=m,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(g){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let m=`${this._terminalSelector} .${H} { color: ${g.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;for(let[C,y]of(m+=`${this._terminalSelector} .${H} .xterm-dim { color: ${B.color.multiplyOpacity(g.foreground,.5).css};}${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}@keyframes blink_box_shadow_`+this._terminalClass+" { 50% {  border-bottom-style: hidden; }}"+("@keyframes blink_block_"+this._terminalClass+" { 0% {")+`  background-color: ${g.cursor.css};`+`  color: ${g.cursorAccent.css}; } 50% {  background-color: inherit;`+`  color: ${g.cursor.css}; }}`+(`${this._terminalSelector} .${H}.${U} .xterm-cursor.xterm-cursor-blink:not(.xterm-cursor-block) { animation: blink_box_shadow_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .${H}.${U} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: blink_block_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .${H} .xterm-cursor.xterm-cursor-block {`+` background-color: ${g.cursor.css};`+` color: ${g.cursorAccent.css};}`+`${this._terminalSelector} .${H} .xterm-cursor.xterm-cursor-outline {`+` outline: 1px solid ${g.cursor.css}; outline-offset: -1px;}`+`${this._terminalSelector} .${H} .xterm-cursor.xterm-cursor-bar {`)+` box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${g.cursor.css} inset;}`+`${this._terminalSelector} .${H} .xterm-cursor.xterm-cursor-underline {`+` border-bottom: 1px ${g.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`+`${this._terminalSelector} .${N} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${N} div { position: absolute; background-color: ${g.selectionBackgroundOpaque.css};}${this._terminalSelector} .${N} div { position: absolute; background-color: ${g.selectionInactiveBackgroundOpaque.css};}`,g.ansi.entries()))m+=`${this._terminalSelector} .${F}${C} { color: ${y.css}; }${this._terminalSelector} .${F}${C}.xterm-dim { color: ${B.color.multiplyOpacity(y,.5).css}; }${this._terminalSelector} .${W}${C} { background-color: ${y.css}; }`;m+=`${this._terminalSelector} .${F}${D.INVERTED_DEFAULT_COLOR} { color: ${B.color.opaque(g.background).css}; }${this._terminalSelector} .${F}${D.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${B.color.multiplyOpacity(B.color.opaque(g.background),.5).css}; }${this._terminalSelector} .${W}${D.INVERTED_DEFAULT_COLOR} { background-color: ${g.foreground.css}; }`,this._themeStyleElement.textContent=m}_setDefaultSpacing(){let g=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${g}px`,this._rowFactory.defaultSpacing=g}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(g,m){for(let g=this._rowElements.length;g<=m;g++){let g=document.createElement("div");this._rowContainer.appendChild(g),this._rowElements.push(g)}for(;this._rowElements.length>m;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(g,m){this._refreshRowElements(g,m),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(U)}handleFocus(){this._rowContainer.classList.add(U),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(g,m,C){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(g,m,C),this.renderRows(0,this._bufferService.rows-1),!g||!m)return;let y=g[1]-this._bufferService.buffer.ydisp,w=m[1]-this._bufferService.buffer.ydisp,k=Math.max(y,0),x=Math.min(w,this._bufferService.rows-1);if(k>=this._bufferService.rows||x<0)return;let D=document.createDocumentFragment();if(C){let C=g[0]>m[0];D.appendChild(this._createSelectionElement(k,C?m[0]:g[0],C?g[0]:m[0],x-k+1))}else{let C=y===k?g[0]:0,R=k===w?m[0]:this._bufferService.cols;D.appendChild(this._createSelectionElement(k,C,R));let A=x-k-1;if(D.appendChild(this._createSelectionElement(k+1,0,this._bufferService.cols,A)),k!==x){let g=w===x?m[0]:this._bufferService.cols;D.appendChild(this._createSelectionElement(x,0,g))}}this._selectionContainer.appendChild(D)}_createSelectionElement(g,m,C,y=1){let w=document.createElement("div");return w.style.height=y*this.dimensions.css.cell.height+"px",w.style.top=g*this.dimensions.css.cell.height+"px",w.style.left=m*this.dimensions.css.cell.width+"px",w.style.width=this.dimensions.css.cell.width*(C-m)+"px",w}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let g of this._rowElements)g.replaceChildren()}renderRows(g,m){let C=this._bufferService.buffer,y=C.ybase+C.y,w=Math.min(C.x,this._bufferService.cols-1),k=this._optionsService.rawOptions.cursorBlink,x=this._optionsService.rawOptions.cursorStyle,D=this._optionsService.rawOptions.cursorInactiveStyle;for(let R=g;R<=m;R++){let g=R+C.ydisp,m=this._rowElements[R],A=C.lines.get(g);if(!m||!A)break;m.replaceChildren(...this._rowFactory.createRow(A,g,g===y,x,D,w,k,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${I}${this._terminalClass}`}_handleLinkHover(g){this._setCellUnderline(g.x1,g.x2,g.y1,g.y2,g.cols,!0)}_handleLinkLeave(g){this._setCellUnderline(g.x1,g.x2,g.y1,g.y2,g.cols,!1)}_setCellUnderline(g,m,C,y,w,k){C<0&&(g=0),y<0&&(m=0);let x=this._bufferService.rows-1;C=Math.max(Math.min(C,x),0),y=Math.max(Math.min(y,x),0),w=Math.min(w,this._bufferService.cols);let D=this._bufferService.buffer,R=D.ybase+D.y,A=Math.min(D.x,w-1),B=this._optionsService.rawOptions.cursorBlink,T=this._optionsService.rawOptions.cursorStyle,M=this._optionsService.rawOptions.cursorInactiveStyle;for(let x=C;x<=y;++x){let O=x+D.ydisp,I=this._rowElements[x],H=D.lines.get(O);if(!I||!H)break;I.replaceChildren(...this._rowFactory.createRow(H,O,O===R,T,M,A,B,this.dimensions.css.cell.width,this._widthCache,k?x===C?g:0:-1,k?(x===y?m:w)-1:-1))}}};m.DomRenderer=y([w(4,O.IInstantiationService),w(5,A.ICharSizeService),w(6,O.IOptionsService),w(7,O.IBufferService),w(8,A.ICoreBrowserService),w(9,A.IThemeService)],j)},3787:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.DomRendererRowFactory=void 0;let k=C(2223),x=C(643),D=C(511),R=C(2585),A=C(8055),B=C(4725),T=C(4269),M=C(6171),O=C(3734),I=m.DomRendererRowFactory=class{constructor(g,m,C,y,w,k,x){this._document=g,this._characterJoinerService=m,this._optionsService=C,this._coreBrowserService=y,this._coreService=w,this._decorationService=k,this._themeService=x,this._workCell=new D.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(g,m,C){this._selectionStart=g,this._selectionEnd=m,this._columnSelectMode=C}createRow(g,m,C,y,w,D,R,B,M,I,H){let F=[],W=this._characterJoinerService.getJoinedCharacters(m),U=this._themeService.colors,N,$=g.getNoBgTrimmedLength();C&&$<D+1&&($=D+1);let j=0,z="",K=0,q=0,V=0,G=!1,X=0,J=!1,Y=0,Z=[],Q=-1!==I&&-1!==H;for(let ee=0;ee<$;ee++){g.loadCell(ee,this._workCell);let $=this._workCell.getWidth();if(0===$)continue;let et=!1,ei=ee,es=this._workCell;if(W.length>0&&ee===W[0][0]){et=!0;let m=W.shift();es=new T.JoinedCellData(this._workCell,g.translateToString(!0,m[0],m[1]),m[1]-m[0]),ei=m[1]-1,$=es.getWidth()}let er=this._isCellInSelection(ee,m),en=C&&ee===D,eo=Q&&ee>=I&&ee<=H,ea=!1;this._decorationService.forEachDecorationAtCell(ee,m,void 0,g=>{ea=!0});let eh=es.getChars()||x.WHITESPACE_CELL_CHAR;if(" "===eh&&(es.isUnderline()||es.isOverline())&&(eh="\xa0"),Y=$*B-M.get(eh,es.isBold(),es.isItalic()),N){if(j&&(er&&J||!er&&!J&&es.bg===K)&&(er&&J&&U.selectionForeground||es.fg===q)&&es.extended.ext===V&&eo===G&&Y===X&&!en&&!et&&!ea){z+=eh,j++;continue}j&&(N.textContent=z),N=this._document.createElement("span"),j=0,z=""}else N=this._document.createElement("span");if(K=es.bg,q=es.fg,V=es.extended.ext,G=eo,X=Y,J=er,et&&D>=ee&&D<=ei&&(D=ee),!this._coreService.isCursorHidden&&en){if(Z.push("xterm-cursor"),this._coreBrowserService.isFocused)R&&Z.push("xterm-cursor-blink"),Z.push("bar"===y?"xterm-cursor-bar":"underline"===y?"xterm-cursor-underline":"xterm-cursor-block");else if(w)switch(w){case"outline":Z.push("xterm-cursor-outline");break;case"block":Z.push("xterm-cursor-block");break;case"bar":Z.push("xterm-cursor-bar");break;case"underline":Z.push("xterm-cursor-underline")}}if(es.isBold()&&Z.push("xterm-bold"),es.isItalic()&&Z.push("xterm-italic"),es.isDim()&&Z.push("xterm-dim"),z=es.isInvisible()?x.WHITESPACE_CELL_CHAR:es.getChars()||x.WHITESPACE_CELL_CHAR,es.isUnderline()&&(Z.push(`xterm-underline-${es.extended.underlineStyle}`)," "===z&&(z="\xa0"),!es.isUnderlineColorDefault())){if(es.isUnderlineColorRGB())N.style.textDecorationColor=`rgb(${O.AttributeData.toColorRGB(es.getUnderlineColor()).join(",")})`;else{let g=es.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&es.isBold()&&g<8&&(g+=8),N.style.textDecorationColor=U.ansi[g].css}}es.isOverline()&&(Z.push("xterm-overline")," "===z&&(z="\xa0")),es.isStrikethrough()&&Z.push("xterm-strikethrough"),eo&&(N.style.textDecoration="underline");let el=es.getFgColor(),ec=es.getFgColorMode(),ed=es.getBgColor(),e_=es.getBgColorMode(),eu=!!es.isInverse();if(eu){let g=el;el=ed,ed=g;let m=ec;ec=e_,e_=m}let ef,ev,ep,eg=!1;switch(this._decorationService.forEachDecorationAtCell(ee,m,void 0,g=>{"top"!==g.options.layer&&eg||(g.backgroundColorRGB&&(e_=50331648,ed=g.backgroundColorRGB.rgba>>8&16777215,ef=g.backgroundColorRGB),g.foregroundColorRGB&&(ec=50331648,el=g.foregroundColorRGB.rgba>>8&16777215,ev=g.foregroundColorRGB),eg="top"===g.options.layer)}),!eg&&er&&(ed=(ef=this._coreBrowserService.isFocused?U.selectionBackgroundOpaque:U.selectionInactiveBackgroundOpaque).rgba>>8&16777215,e_=50331648,eg=!0,U.selectionForeground&&(ec=50331648,el=U.selectionForeground.rgba>>8&16777215,ev=U.selectionForeground)),eg&&Z.push("xterm-decoration-top"),e_){case 16777216:case 33554432:ep=U.ansi[ed],Z.push(`xterm-bg-${ed}`);break;case 50331648:ep=A.rgba.toColor(ed>>16,ed>>8&255,255&ed),this._addStyle(N,`background-color:#${v((ed>>>0).toString(16),"0",6)}`);break;default:eu?(ep=U.foreground,Z.push(`xterm-bg-${k.INVERTED_DEFAULT_COLOR}`)):ep=U.background}switch(ef||es.isDim()&&(ef=A.color.multiplyOpacity(ep,.5)),ec){case 16777216:case 33554432:es.isBold()&&el<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(el+=8),this._applyMinimumContrast(N,ep,U.ansi[el],es,ef,void 0)||Z.push(`xterm-fg-${el}`);break;case 50331648:let em=A.rgba.toColor(el>>16&255,el>>8&255,255&el);this._applyMinimumContrast(N,ep,em,es,ef,ev)||this._addStyle(N,`color:#${v(el.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(N,ep,U.foreground,es,ef,void 0)||eu&&Z.push(`xterm-fg-${k.INVERTED_DEFAULT_COLOR}`)}Z.length&&(N.className=Z.join(" "),Z.length=0),en||et||ea?N.textContent=z:j++,Y!==this.defaultSpacing&&(N.style.letterSpacing=`${Y}px`),F.push(N),ee=ei}return N&&j&&(N.textContent=z),F}_applyMinimumContrast(g,m,C,y,w,k){let x;if(1===this._optionsService.rawOptions.minimumContrastRatio||(0,M.excludeFromContrastRatioDemands)(y.getCode()))return!1;let D=this._getContrastCache(y);if(w||k||(x=D.getColor(m.rgba,C.rgba)),void 0===x){let g=this._optionsService.rawOptions.minimumContrastRatio/(y.isDim()?2:1);x=A.color.ensureContrastRatio(w||m,k||C,g),D.setColor((w||m).rgba,(k||C).rgba,null!=x?x:null)}return!!x&&(this._addStyle(g,`color:${x.css}`),!0)}_getContrastCache(g){return g.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(g,m){g.setAttribute("style",`${g.getAttribute("style")||""}${m};`)}_isCellInSelection(g,m){let C=this._selectionStart,y=this._selectionEnd;return!(!C||!y)&&(this._columnSelectMode?C[0]<=y[0]?g>=C[0]&&m>=C[1]&&g<y[0]&&m<=y[1]:g<C[0]&&m>=C[1]&&g>=y[0]&&m<=y[1]:m>C[1]&&m<y[1]||C[1]===y[1]&&m===C[1]&&g>=C[0]&&g<y[0]||C[1]<y[1]&&m===y[1]&&g<y[0]||C[1]<y[1]&&m===C[1]&&g>=C[0])}};function v(g,m,C){for(;g.length<C;)g=m+g;return g}m.DomRendererRowFactory=y([w(1,B.ICharacterJoinerService),w(2,R.IOptionsService),w(3,B.ICoreBrowserService),w(4,R.ICoreService),w(5,R.IDecorationService),w(6,B.IThemeService)],I)},2550:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.WidthCache=void 0,m.WidthCache=class{constructor(g){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=g.createElement("div"),this._container.style.position="absolute",this._container.style.top="-50000px",this._container.style.width="50000px",this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let m=g.createElement("span"),C=g.createElement("span");C.style.fontWeight="bold";let y=g.createElement("span");y.style.fontStyle="italic";let w=g.createElement("span");w.style.fontWeight="bold",w.style.fontStyle="italic",this._measureElements=[m,C,y,w],this._container.appendChild(m),this._container.appendChild(C),this._container.appendChild(y),this._container.appendChild(w),g.body.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(g,m,C,y){g===this._font&&m===this._fontSize&&C===this._weight&&y===this._weightBold||(this._font=g,this._fontSize=m,this._weight=C,this._weightBold=y,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${C}`,this._measureElements[1].style.fontWeight=`${y}`,this._measureElements[2].style.fontWeight=`${C}`,this._measureElements[3].style.fontWeight=`${y}`,this.clear())}get(g,m,C){let y=0;if(!m&&!C&&1===g.length&&(y=g.charCodeAt(0))<256)return -9999!==this._flat[y]?this._flat[y]:this._flat[y]=this._measure(g,0);let w=g;m&&(w+="B"),C&&(w+="I");let k=this._holey.get(w);if(void 0===k){let y=0;m&&(y|=1),C&&(y|=2),k=this._measure(g,y),this._holey.set(w,k)}return k}_measure(g,m){let C=this._measureElements[m];return C.textContent=g.repeat(32),C.offsetWidth/32}}},2223:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.TEXT_BASELINE=m.DIM_OPACITY=m.INVERTED_DEFAULT_COLOR=void 0;let y=C(6114);m.INVERTED_DEFAULT_COLOR=257,m.DIM_OPACITY=.5,m.TEXT_BASELINE=y.isFirefox||y.isLegacyEdge?"bottom":"ideographic"},6171:(g,m)=>{function i(g){return 57508<=g&&g<=57558}Object.defineProperty(m,"__esModule",{value:!0}),m.createRenderDimensions=m.excludeFromContrastRatioDemands=m.isRestrictedPowerlineGlyph=m.isPowerlineGlyph=m.throwIfFalsy=void 0,m.throwIfFalsy=function(g){if(!g)throw Error("value must not be falsy");return g},m.isPowerlineGlyph=i,m.isRestrictedPowerlineGlyph=function(g){return 57520<=g&&g<=57527},m.excludeFromContrastRatioDemands=function(g){return i(g)||9472<=g&&g<=9631},m.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.SelectionModel=void 0,m.SelectionModel=class{constructor(g){this._bufferService=g,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let g=this.selectionStart[0]+this.selectionStartLength;return g>this._bufferService.cols?g%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(g/this._bufferService.cols)-1]:[g%this._bufferService.cols,this.selectionStart[1]+Math.floor(g/this._bufferService.cols)]:[g,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let g=this.selectionStart[0]+this.selectionStartLength;return g>this._bufferService.cols?[g%this._bufferService.cols,this.selectionStart[1]+Math.floor(g/this._bufferService.cols)]:[Math.max(g,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let g=this.selectionStart,m=this.selectionEnd;return!(!g||!m)&&(g[1]>m[1]||g[1]===m[1]&&g[0]>m[0])}handleTrim(g){return this.selectionStart&&(this.selectionStart[1]-=g),this.selectionEnd&&(this.selectionEnd[1]-=g),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.CharSizeService=void 0;let k=C(2585),x=C(8460),D=C(844),R=m.CharSizeService=class extends D.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(g,m,C){super(),this._optionsService=C,this.width=0,this.height=0,this._onCharSizeChange=this.register(new x.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new c(g,m,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){let g=this._measureStrategy.measure();g.width===this.width&&g.height===this.height||(this.width=g.width,this.height=g.height,this._onCharSizeChange.fire())}};m.CharSizeService=R=y([w(2,k.IOptionsService)],R);let c=class c{constructor(g,m,C){this._document=g,this._parentElement=m,this._optionsService=C,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;let g={height:Number(this._measureElement.offsetHeight),width:Number(this._measureElement.offsetWidth)};return 0!==g.width&&0!==g.height&&(this._result.width=g.width/32,this._result.height=Math.ceil(g.height)),this._result}}},4269:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.CharacterJoinerService=m.JoinedCellData=void 0;let k=C(3734),x=C(643),D=C(511),R=C(2585);let c=class c extends k.AttributeData{constructor(g,m,C){super(),this.content=0,this.combinedData="",this.fg=g.fg,this.bg=g.bg,this.combinedData=m,this._width=C}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(g){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};m.JoinedCellData=c;let A=m.CharacterJoinerService=class e{constructor(g){this._bufferService=g,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new D.CellData}register(g){let m={id:this._nextCharacterJoinerId++,handler:g};return this._characterJoiners.push(m),m.id}deregister(g){for(let m=0;m<this._characterJoiners.length;m++)if(this._characterJoiners[m].id===g)return this._characterJoiners.splice(m,1),!0;return!1}getJoinedCharacters(g){if(0===this._characterJoiners.length)return[];let m=this._bufferService.buffer.lines.get(g);if(!m||0===m.length)return[];let C=[],y=m.translateToString(!0),w=0,k=0,D=0,R=m.getFg(0),A=m.getBg(0);for(let g=0;g<m.getTrimmedLength();g++)if(m.loadCell(g,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==R||this._workCell.bg!==A){if(g-w>1){let g=this._getJoinedRanges(y,D,k,m,w);for(let m=0;m<g.length;m++)C.push(g[m])}w=g,D=k,R=this._workCell.fg,A=this._workCell.bg}k+=this._workCell.getChars().length||x.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-w>1){let g=this._getJoinedRanges(y,D,k,m,w);for(let m=0;m<g.length;m++)C.push(g[m])}return C}_getJoinedRanges(g,m,C,y,w){let k=g.substring(m,C),x=[];try{x=this._characterJoiners[0].handler(k)}catch(g){console.error(g)}for(let g=1;g<this._characterJoiners.length;g++)try{let m=this._characterJoiners[g].handler(k);for(let g=0;g<m.length;g++)e._mergeRanges(x,m[g])}catch(g){console.error(g)}return this._stringRangesToCellRanges(x,y,w),x}_stringRangesToCellRanges(g,m,C){let y=0,w=!1,k=0,D=g[0];if(D){for(let R=C;R<this._bufferService.cols;R++){let C=m.getWidth(R),A=m.getString(R).length||x.WHITESPACE_CELL_CHAR.length;if(0!==C){if(!w&&D[0]<=k&&(D[0]=R,w=!0),D[1]<=k){if(D[1]=R,!(D=g[++y]))break;D[0]<=k?(D[0]=R,w=!0):w=!1}k+=A}}D&&(D[1]=this._bufferService.cols)}}static _mergeRanges(g,m){let C=!1;for(let y=0;y<g.length;y++){let w=g[y];if(C){if(m[1]<=w[0])return g[y-1][1]=m[1],g;if(m[1]<=w[1])return g[y-1][1]=Math.max(m[1],w[1]),g.splice(y,1),g;g.splice(y,1),y--}else{if(m[1]<=w[0])return g.splice(y,0,m),g;if(m[1]<=w[1])return w[0]=Math.min(m[0],w[0]),g;m[0]<w[1]&&(w[0]=Math.min(m[0],w[0]),C=!0)}}return C?g[g.length-1][1]=m[1]:g.push(m),g}};m.CharacterJoinerService=y([w(0,R.IBufferService)],A)},5114:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.CoreBrowserService=void 0,m.CoreBrowserService=class{constructor(g,m){this._textarea=g,this.window=m,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.MouseService=void 0;let k=C(4725),x=C(9806),D=m.MouseService=class{constructor(g,m){this._renderService=g,this._charSizeService=m}getCoords(g,m,C,y,w){return(0,x.getCoords)(window,g,m,C,y,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,w)}getMouseReportCoords(g,m){let C=(0,x.getCoordsRelativeToElement)(window,g,m);if(this._charSizeService.hasValidSize)return C[0]=Math.min(Math.max(C[0],0),this._renderService.dimensions.css.canvas.width-1),C[1]=Math.min(Math.max(C[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(C[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(C[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(C[0]),y:Math.floor(C[1])}}};m.MouseService=y([w(0,k.IRenderService),w(1,k.ICharSizeService)],D)},3230:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.RenderService=void 0;let k=C(3656),x=C(6193),D=C(5596),R=C(4725),A=C(8460),B=C(844),T=C(7226),M=C(2585),O=m.RenderService=class extends B.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(g,m,C,y,w,R,M,O){if(super(),this._rowCount=g,this._charSizeService=y,this._renderer=this.register(new B.MutableDisposable),this._pausedResizeTask=new T.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new A.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new A.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new A.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new A.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new x.RenderDebouncer(M.window,(g,m)=>this._renderRows(g,m)),this.register(this._renderDebouncer),this._screenDprMonitor=new D.ScreenDprMonitor(M.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(R.onResize(()=>this._fullRefresh())),this.register(R.buffers.onBufferActivate(()=>{var g;return null===(g=this._renderer.value)||void 0===g?void 0:g.clear()})),this.register(C.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(w.onDecorationRegistered(()=>this._fullRefresh())),this.register(w.onDecorationRemoved(()=>this._fullRefresh())),this.register(C.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(R.cols,R.rows),this._fullRefresh()})),this.register(C.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(R.buffer.y,R.buffer.y,!0))),this.register((0,k.addDisposableDomListener)(M.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(O.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in M.window){let g=new M.window.IntersectionObserver(g=>this._handleIntersectionChange(g[g.length-1]),{threshold:0});g.observe(m),this.register({dispose:()=>g.disconnect()})}}_handleIntersectionChange(g){this._isPaused=void 0===g.isIntersecting?0===g.intersectionRatio:!g.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(g,m,C=!1){this._isPaused?this._needsFullRefresh=!0:(C||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(g,m,this._rowCount))}_renderRows(g,m){this._renderer.value&&(g=Math.min(g,this._rowCount-1),m=Math.min(m,this._rowCount-1),this._renderer.value.renderRows(g,m),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:g,end:m}),this._onRender.fire({start:g,end:m}),this._isNextRenderRedrawOnly=!0)}resize(g,m){this._rowCount=m,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(g){this._renderer.value=g,this._renderer.value.onRequestRedraw(g=>this.refreshRows(g.start,g.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(g){return this._renderDebouncer.addRefreshCallback(g)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var g,m;this._renderer.value&&(null===(m=(g=this._renderer.value).clearTextureAtlas)||void 0===m||m.call(g),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(g,m){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value.handleResize(g,m)):this._renderer.value.handleResize(g,m),this._fullRefresh())}handleCharSizeChanged(){var g;null===(g=this._renderer.value)||void 0===g||g.handleCharSizeChanged()}handleBlur(){var g;null===(g=this._renderer.value)||void 0===g||g.handleBlur()}handleFocus(){var g;null===(g=this._renderer.value)||void 0===g||g.handleFocus()}handleSelectionChanged(g,m,C){var y;this._selectionState.start=g,this._selectionState.end=m,this._selectionState.columnSelectMode=C,null===(y=this._renderer.value)||void 0===y||y.handleSelectionChanged(g,m,C)}handleCursorMove(){var g;null===(g=this._renderer.value)||void 0===g||g.handleCursorMove()}clear(){var g;null===(g=this._renderer.value)||void 0===g||g.clear()}};m.RenderService=y([w(2,M.IOptionsService),w(3,R.ICharSizeService),w(4,M.IDecorationService),w(5,M.IBufferService),w(6,R.ICoreBrowserService),w(7,R.IThemeService)],O)},9312:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.SelectionService=void 0;let k=C(9806),x=C(9504),D=C(456),R=C(4725),A=C(8460),B=C(844),T=C(6114),M=C(4841),O=C(511),I=C(2585),H=String.fromCharCode(160),F=RegExp(H,"g"),W=m.SelectionService=class extends B.Disposable{constructor(g,m,C,y,w,k,x,R,T){super(),this._element=g,this._screenElement=m,this._linkifier=C,this._bufferService=y,this._coreService=w,this._mouseService=k,this._optionsService=x,this._renderService=R,this._coreBrowserService=T,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new O.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new A.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new A.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new A.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new A.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=g=>this._handleMouseMove(g),this._mouseUpListener=g=>this._handleMouseUp(g),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(g=>this._handleTrim(g)),this.register(this._bufferService.buffers.onBufferActivate(g=>this._handleBufferActivate(g))),this.enable(),this._model=new D.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,B.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let g=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;return!(!g||!m||g[0]===m[0]&&g[1]===m[1])}get selectionText(){let g=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;if(!g||!m)return"";let C=this._bufferService.buffer,y=[];if(3===this._activeSelectionMode){if(g[0]===m[0])return"";let w=g[0]<m[0]?g[0]:m[0],k=g[0]<m[0]?m[0]:g[0];for(let x=g[1];x<=m[1];x++){let g=C.translateBufferLineToString(x,!0,w,k);y.push(g)}}else{let w=g[1]===m[1]?m[0]:void 0;y.push(C.translateBufferLineToString(g[1],!0,g[0],w));for(let w=g[1]+1;w<=m[1]-1;w++){let g=C.lines.get(w),m=C.translateBufferLineToString(w,!0);(null==g?void 0:g.isWrapped)?y[y.length-1]+=m:y.push(m)}if(g[1]!==m[1]){let g=C.lines.get(m[1]),w=C.translateBufferLineToString(m[1],!0,0,m[0]);g&&g.isWrapped?y[y.length-1]+=w:y.push(w)}}return y.map(g=>g.replace(F," ")).join(T.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(g){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),T.isLinux&&g&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(g){let m=this._getMouseBufferCoords(g),C=this._model.finalSelectionStart,y=this._model.finalSelectionEnd;return!!(C&&y&&m)&&this._areCoordsInSelection(m,C,y)}isCellInSelection(g,m){let C=this._model.finalSelectionStart,y=this._model.finalSelectionEnd;return!(!C||!y)&&this._areCoordsInSelection([g,m],C,y)}_areCoordsInSelection(g,m,C){return g[1]>m[1]&&g[1]<C[1]||m[1]===C[1]&&g[1]===m[1]&&g[0]>=m[0]&&g[0]<C[0]||m[1]<C[1]&&g[1]===C[1]&&g[0]<C[0]||m[1]<C[1]&&g[1]===m[1]&&g[0]>=m[0]}_selectWordAtCursor(g,m){var C,y;let w=null===(y=null===(C=this._linkifier.currentLink)||void 0===C?void 0:C.link)||void 0===y?void 0:y.range;if(w)return this._model.selectionStart=[w.start.x-1,w.start.y-1],this._model.selectionStartLength=(0,M.getRangeLength)(w,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let k=this._getMouseBufferCoords(g);return!!k&&(this._selectWordAt(k,m),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(g,m){this._model.clearSelection(),g=Math.max(g,0),m=Math.min(m,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,g],this._model.selectionEnd=[this._bufferService.cols,m],this.refresh(),this._onSelectionChange.fire()}_handleTrim(g){this._model.handleTrim(g)&&this.refresh()}_getMouseBufferCoords(g){let m=this._mouseService.getCoords(g,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(m)return m[0]--,m[1]--,m[1]+=this._bufferService.buffer.ydisp,m}_getMouseEventScrollAmount(g){let m=(0,k.getCoordsRelativeToElement)(this._coreBrowserService.window,g,this._screenElement)[1],C=this._renderService.dimensions.css.canvas.height;return m>=0&&m<=C?0:(m>C&&(m-=C),(m=Math.min(Math.max(m,-50),50)/50)/Math.abs(m)+Math.round(14*m))}shouldForceSelection(g){return T.isMac?g.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:g.shiftKey}handleMouseDown(g){if(this._mouseDownTimeStamp=g.timeStamp,(2!==g.button||!this.hasSelection)&&0===g.button){if(!this._enabled){if(!this.shouldForceSelection(g))return;g.stopPropagation()}g.preventDefault(),this._dragScrollAmount=0,this._enabled&&g.shiftKey?this._handleIncrementalClick(g):1===g.detail?this._handleSingleClick(g):2===g.detail?this._handleDoubleClick(g):3===g.detail&&this._handleTripleClick(g),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(g){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(g))}_handleSingleClick(g){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(g)?3:0,this._model.selectionStart=this._getMouseBufferCoords(g),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let m=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);m&&m.length!==this._model.selectionStart[0]&&0===m.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_handleDoubleClick(g){this._selectWordAtCursor(g,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(g){let m=this._getMouseBufferCoords(g);m&&(this._activeSelectionMode=2,this._selectLineAt(m[1]))}shouldColumnSelect(g){return g.altKey&&!(T.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(g){if(g.stopImmediatePropagation(),!this._model.selectionStart)return;let m=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(g),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(g),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let C=this._bufferService.buffer;if(this._model.selectionEnd[1]<C.lines.length){let g=C.lines.get(this._model.selectionEnd[1]);g&&0===g.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]++}m&&m[0]===this._model.selectionEnd[0]&&m[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let g=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(g.ydisp+this._bufferService.rows,g.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=g.ydisp),this.refresh()}}_handleMouseUp(g){let m=g.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&m<500&&g.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let m=this._mouseService.getCoords(g,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(m&&void 0!==m[0]&&void 0!==m[1]){let g=(0,x.moveToCellSequence)(m[0]-1,m[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(g,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let g=this._model.finalSelectionStart,m=this._model.finalSelectionEnd,C=!(!g||!m||g[0]===m[0]&&g[1]===m[1]);C?g&&m&&(this._oldSelectionStart&&this._oldSelectionEnd&&g[0]===this._oldSelectionStart[0]&&g[1]===this._oldSelectionStart[1]&&m[0]===this._oldSelectionEnd[0]&&m[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(g,m,C)):this._oldHasSelection&&this._fireOnSelectionChange(g,m,C)}_fireOnSelectionChange(g,m,C){this._oldSelectionStart=g,this._oldSelectionEnd=m,this._oldHasSelection=C,this._onSelectionChange.fire()}_handleBufferActivate(g){this.clearSelection(),this._trimListener.dispose(),this._trimListener=g.activeBuffer.lines.onTrim(g=>this._handleTrim(g))}_convertViewportColToCharacterIndex(g,m){let C=m;for(let y=0;m>=y;y++){let w=g.loadCell(y,this._workCell).getChars().length;0===this._workCell.getWidth()?C--:w>1&&m!==y&&(C+=w-1)}return C}setSelection(g,m,C){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[g,m],this._model.selectionStartLength=C,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(g){this._isClickInSelection(g)||(this._selectWordAtCursor(g,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(g,m,C=!0,y=!0){if(g[0]>=this._bufferService.cols)return;let w=this._bufferService.buffer,k=w.lines.get(g[1]);if(!k)return;let x=w.translateBufferLineToString(g[1],!1),D=this._convertViewportColToCharacterIndex(k,g[0]),R=D,A=g[0]-D,B=0,T=0,M=0,O=0;if(" "===x.charAt(D)){for(;D>0&&" "===x.charAt(D-1);)D--;for(;R<x.length&&" "===x.charAt(R+1);)R++}else{let m=g[0],C=g[0];0===k.getWidth(m)&&(B++,m--),2===k.getWidth(C)&&(T++,C++);let y=k.getString(C).length;for(y>1&&(O+=y-1,R+=y-1);m>0&&D>0&&!this._isCharWordSeparator(k.loadCell(m-1,this._workCell));){k.loadCell(m-1,this._workCell);let g=this._workCell.getChars().length;0===this._workCell.getWidth()?(B++,m--):g>1&&(M+=g-1,D-=g-1),D--,m--}for(;C<k.length&&R+1<x.length&&!this._isCharWordSeparator(k.loadCell(C+1,this._workCell));){k.loadCell(C+1,this._workCell);let g=this._workCell.getChars().length;2===this._workCell.getWidth()?(T++,C++):g>1&&(O+=g-1,R+=g-1),R++,C++}}R++;let I=D+A-B+M,H=Math.min(this._bufferService.cols,R-D+B+T-M-O);if(m||""!==x.slice(D,R).trim()){if(C&&0===I&&32!==k.getCodePoint(0)){let m=w.lines.get(g[1]-1);if(m&&k.isWrapped&&32!==m.getCodePoint(this._bufferService.cols-1)){let m=this._getWordAt([this._bufferService.cols-1,g[1]-1],!1,!0,!1);if(m){let g=this._bufferService.cols-m.start;I-=g,H+=g}}}if(y&&I+H===this._bufferService.cols&&32!==k.getCodePoint(this._bufferService.cols-1)){let m=w.lines.get(g[1]+1);if((null==m?void 0:m.isWrapped)&&32!==m.getCodePoint(0)){let m=this._getWordAt([0,g[1]+1],!1,!1,!0);m&&(H+=m.length)}}return{start:I,length:H}}}_selectWordAt(g,m){let C=this._getWordAt(g,m);if(C){for(;C.start<0;)C.start+=this._bufferService.cols,g[1]--;this._model.selectionStart=[C.start,g[1]],this._model.selectionStartLength=C.length}}_selectToWordAt(g){let m=this._getWordAt(g,!0);if(m){let C=g[1];for(;m.start<0;)m.start+=this._bufferService.cols,C--;if(!this._model.areSelectionValuesReversed())for(;m.start+m.length>this._bufferService.cols;)m.length-=this._bufferService.cols,C++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?m.start:m.start+m.length,C]}}_isCharWordSeparator(g){return 0!==g.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(g.getChars())>=0}_selectLineAt(g){let m=this._bufferService.buffer.getWrappedRangeForLine(g),C={start:{x:0,y:m.first},end:{x:this._bufferService.cols-1,y:m.last}};this._model.selectionStart=[0,m.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,M.getRangeLength)(C,this._bufferService.cols)}};m.SelectionService=y([w(3,I.IBufferService),w(4,I.ICoreService),w(5,R.IMouseService),w(6,I.IOptionsService),w(7,R.IRenderService),w(8,R.ICoreBrowserService)],W)},4725:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.IThemeService=m.ICharacterJoinerService=m.ISelectionService=m.IRenderService=m.IMouseService=m.ICoreBrowserService=m.ICharSizeService=void 0;let y=C(8343);m.ICharSizeService=(0,y.createDecorator)("CharSizeService"),m.ICoreBrowserService=(0,y.createDecorator)("CoreBrowserService"),m.IMouseService=(0,y.createDecorator)("MouseService"),m.IRenderService=(0,y.createDecorator)("RenderService"),m.ISelectionService=(0,y.createDecorator)("SelectionService"),m.ICharacterJoinerService=(0,y.createDecorator)("CharacterJoinerService"),m.IThemeService=(0,y.createDecorator)("ThemeService")},6731:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.ThemeService=m.DEFAULT_ANSI_COLORS=void 0;let k=C(7239),x=C(8055),D=C(8460),R=C(844),A=C(2585),B=x.css.toColor("#ffffff"),T=x.css.toColor("#000000"),M=x.css.toColor("#ffffff"),O=x.css.toColor("#000000"),I={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};m.DEFAULT_ANSI_COLORS=Object.freeze((()=>{let g=[x.css.toColor("#2e3436"),x.css.toColor("#cc0000"),x.css.toColor("#4e9a06"),x.css.toColor("#c4a000"),x.css.toColor("#3465a4"),x.css.toColor("#75507b"),x.css.toColor("#06989a"),x.css.toColor("#d3d7cf"),x.css.toColor("#555753"),x.css.toColor("#ef2929"),x.css.toColor("#8ae234"),x.css.toColor("#fce94f"),x.css.toColor("#729fcf"),x.css.toColor("#ad7fa8"),x.css.toColor("#34e2e2"),x.css.toColor("#eeeeec")],m=[0,95,135,175,215,255];for(let C=0;C<216;C++){let y=m[C/36%6|0],w=m[C/6%6|0],k=m[C%6];g.push({css:x.channels.toCss(y,w,k),rgba:x.channels.toRgba(y,w,k)})}for(let m=0;m<24;m++){let C=8+10*m;g.push({css:x.channels.toCss(C,C,C),rgba:x.channels.toRgba(C,C,C)})}return g})());let H=m.ThemeService=class extends R.Disposable{get colors(){return this._colors}constructor(g){super(),this._optionsService=g,this._contrastCache=new k.ColorContrastCache,this._halfContrastCache=new k.ColorContrastCache,this._onChangeColors=this.register(new D.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:B,background:T,cursor:M,cursorAccent:O,selectionForeground:void 0,selectionBackgroundTransparent:I,selectionBackgroundOpaque:x.color.blend(T,I),selectionInactiveBackgroundTransparent:I,selectionInactiveBackgroundOpaque:x.color.blend(T,I),ansi:m.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(g={}){let C=this._colors;if(C.foreground=p(g.foreground,B),C.background=p(g.background,T),C.cursor=p(g.cursor,M),C.cursorAccent=p(g.cursorAccent,O),C.selectionBackgroundTransparent=p(g.selectionBackground,I),C.selectionBackgroundOpaque=x.color.blend(C.background,C.selectionBackgroundTransparent),C.selectionInactiveBackgroundTransparent=p(g.selectionInactiveBackground,C.selectionBackgroundTransparent),C.selectionInactiveBackgroundOpaque=x.color.blend(C.background,C.selectionInactiveBackgroundTransparent),C.selectionForeground=g.selectionForeground?p(g.selectionForeground,x.NULL_COLOR):void 0,C.selectionForeground===x.NULL_COLOR&&(C.selectionForeground=void 0),x.color.isOpaque(C.selectionBackgroundTransparent)&&(C.selectionBackgroundTransparent=x.color.opacity(C.selectionBackgroundTransparent,.3)),x.color.isOpaque(C.selectionInactiveBackgroundTransparent)&&(C.selectionInactiveBackgroundTransparent=x.color.opacity(C.selectionInactiveBackgroundTransparent,.3)),C.ansi=m.DEFAULT_ANSI_COLORS.slice(),C.ansi[0]=p(g.black,m.DEFAULT_ANSI_COLORS[0]),C.ansi[1]=p(g.red,m.DEFAULT_ANSI_COLORS[1]),C.ansi[2]=p(g.green,m.DEFAULT_ANSI_COLORS[2]),C.ansi[3]=p(g.yellow,m.DEFAULT_ANSI_COLORS[3]),C.ansi[4]=p(g.blue,m.DEFAULT_ANSI_COLORS[4]),C.ansi[5]=p(g.magenta,m.DEFAULT_ANSI_COLORS[5]),C.ansi[6]=p(g.cyan,m.DEFAULT_ANSI_COLORS[6]),C.ansi[7]=p(g.white,m.DEFAULT_ANSI_COLORS[7]),C.ansi[8]=p(g.brightBlack,m.DEFAULT_ANSI_COLORS[8]),C.ansi[9]=p(g.brightRed,m.DEFAULT_ANSI_COLORS[9]),C.ansi[10]=p(g.brightGreen,m.DEFAULT_ANSI_COLORS[10]),C.ansi[11]=p(g.brightYellow,m.DEFAULT_ANSI_COLORS[11]),C.ansi[12]=p(g.brightBlue,m.DEFAULT_ANSI_COLORS[12]),C.ansi[13]=p(g.brightMagenta,m.DEFAULT_ANSI_COLORS[13]),C.ansi[14]=p(g.brightCyan,m.DEFAULT_ANSI_COLORS[14]),C.ansi[15]=p(g.brightWhite,m.DEFAULT_ANSI_COLORS[15]),g.extendedAnsi){let y=Math.min(C.ansi.length-16,g.extendedAnsi.length);for(let w=0;w<y;w++)C.ansi[w+16]=p(g.extendedAnsi[w],m.DEFAULT_ANSI_COLORS[w+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(g){this._restoreColor(g),this._onChangeColors.fire(this.colors)}_restoreColor(g){if(void 0!==g)switch(g){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[g]=this._restoreColors.ansi[g]}else for(let g=0;g<this._restoreColors.ansi.length;++g)this._colors.ansi[g]=this._restoreColors.ansi[g]}modifyColors(g){g(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function p(g,m){if(void 0!==g)try{return x.css.toColor(g)}catch(g){}return m}m.ThemeService=y([w(0,A.IOptionsService)],H)},6349:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.CircularList=void 0;let y=C(8460),w=C(844);let n=class n extends w.Disposable{constructor(g){super(),this._maxLength=g,this.onDeleteEmitter=this.register(new y.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new y.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new y.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(g){if(this._maxLength===g)return;let m=Array(g);for(let C=0;C<Math.min(g,this.length);C++)m[C]=this._array[this._getCyclicIndex(C)];this._array=m,this._maxLength=g,this._startIndex=0}get length(){return this._length}set length(g){if(g>this._length)for(let m=this._length;m<g;m++)this._array[m]=void 0;this._length=g}get(g){return this._array[this._getCyclicIndex(g)]}set(g,m){this._array[this._getCyclicIndex(g)]=m}push(g){this._array[this._getCyclicIndex(this._length)]=g,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(g,m,...C){if(m){for(let C=g;C<this._length-m;C++)this._array[this._getCyclicIndex(C)]=this._array[this._getCyclicIndex(C+m)];this._length-=m,this.onDeleteEmitter.fire({index:g,amount:m})}for(let m=this._length-1;m>=g;m--)this._array[this._getCyclicIndex(m+C.length)]=this._array[this._getCyclicIndex(m)];for(let m=0;m<C.length;m++)this._array[this._getCyclicIndex(g+m)]=C[m];if(C.length&&this.onInsertEmitter.fire({index:g,amount:C.length}),this._length+C.length>this._maxLength){let g=this._length+C.length-this._maxLength;this._startIndex+=g,this._length=this._maxLength,this.onTrimEmitter.fire(g)}else this._length+=C.length}trimStart(g){g>this._length&&(g=this._length),this._startIndex+=g,this._length-=g,this.onTrimEmitter.fire(g)}shiftElements(g,m,C){if(!(m<=0)){if(g<0||g>=this._length)throw Error("start argument out of range");if(g+C<0)throw Error("Cannot shift elements in list beyond index 0");if(C>0){for(let y=m-1;y>=0;y--)this.set(g+y+C,this.get(g+y));let y=g+m+C-this._length;if(y>0)for(this._length+=y;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let y=0;y<m;y++)this.set(g+y+C,this.get(g+y))}}_getCyclicIndex(g){return(this._startIndex+g)%this._maxLength}};m.CircularList=n},1439:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.clone=void 0,m.clone=function e(g,m=5){if("object"!=typeof g)return g;let C=Array.isArray(g)?[]:{};for(let y in g)C[y]=m<=1?g[y]:g[y]&&e(g[y],m-1);return C}},8055:(g,m,C)=>{var y,w,k,x,D,R;Object.defineProperty(m,"__esModule",{value:!0}),m.contrastRatio=m.toPaddedHex=m.rgba=m.rgb=m.css=m.color=m.channels=m.NULL_COLOR=void 0;let A=C(6114),B=0,T=0,M=0,O=0;function u(g){let m=g.toString(16);return m.length<2?"0"+m:m}function f(g,m){return g<m?(m+.05)/(g+.05):(g+.05)/(m+.05)}m.NULL_COLOR={css:"#00000000",rgba:0},(R=y||(m.channels=y={})).toCss=function(g,m,C,y){return void 0!==y?`#${u(g)}${u(m)}${u(C)}${u(y)}`:`#${u(g)}${u(m)}${u(C)}`},R.toRgba=function(g,m,C,y=255){return(g<<24|m<<16|C<<8|y)>>>0},function(g){function t(g,m){return O=Math.round(255*m),[B,T,M]=D.toChannels(g.rgba),{css:y.toCss(B,T,M,O),rgba:y.toRgba(B,T,M,O)}}g.blend=function(g,m){if(1==(O=(255&m.rgba)/255))return{css:m.css,rgba:m.rgba};let C=m.rgba>>24&255,w=m.rgba>>16&255,k=m.rgba>>8&255,x=g.rgba>>24&255,D=g.rgba>>16&255,R=g.rgba>>8&255;return B=x+Math.round((C-x)*O),T=D+Math.round((w-D)*O),M=R+Math.round((k-R)*O),{css:y.toCss(B,T,M),rgba:y.toRgba(B,T,M)}},g.isOpaque=function(g){return 255==(255&g.rgba)},g.ensureContrastRatio=function(g,m,C){let y=D.ensureContrastRatio(g.rgba,m.rgba,C);if(y)return D.toColor(y>>24&255,y>>16&255,y>>8&255)},g.opaque=function(g){let m=(255|g.rgba)>>>0;return[B,T,M]=D.toChannels(m),{css:y.toCss(B,T,M),rgba:m}},g.opacity=t,g.multiplyOpacity=function(g,m){return O=255&g.rgba,t(g,O*m/255)},g.toColorRGB=function(g){return[g.rgba>>24&255,g.rgba>>16&255,g.rgba>>8&255]}}(w||(m.color=w={})),function(g){let m,C;if(!A.isNode){let g=document.createElement("canvas");g.width=1,g.height=1;let y=g.getContext("2d",{willReadFrequently:!0});y&&((m=y).globalCompositeOperation="copy",C=m.createLinearGradient(0,0,1,1))}g.toColor=function(g){if(g.match(/#[\da-f]{3,8}/i))switch(g.length){case 4:return B=parseInt(g.slice(1,2).repeat(2),16),T=parseInt(g.slice(2,3).repeat(2),16),M=parseInt(g.slice(3,4).repeat(2),16),D.toColor(B,T,M);case 5:return B=parseInt(g.slice(1,2).repeat(2),16),T=parseInt(g.slice(2,3).repeat(2),16),M=parseInt(g.slice(3,4).repeat(2),16),O=parseInt(g.slice(4,5).repeat(2),16),D.toColor(B,T,M,O);case 7:return{css:g,rgba:(parseInt(g.slice(1),16)<<8|255)>>>0};case 9:return{css:g,rgba:parseInt(g.slice(1),16)>>>0}}let w=g.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(w)return B=parseInt(w[1]),T=parseInt(w[2]),M=parseInt(w[3]),O=Math.round(255*(void 0===w[5]?1:parseFloat(w[5]))),D.toColor(B,T,M,O);if(!m||!C||(m.fillStyle=C,m.fillStyle=g,"string"!=typeof m.fillStyle)||(m.fillRect(0,0,1,1),[B,T,M,O]=m.getImageData(0,0,1,1).data,255!==O))throw Error("css.toColor: Unsupported css format");return{rgba:y.toRgba(B,T,M,O),css:g}}}(k||(m.css=k={})),function(g){function t(g,m,C){let y=g/255,w=m/255,k=C/255;return .2126*(y<=.03928?y/12.92:Math.pow((y+.055)/1.055,2.4))+.7152*(w<=.03928?w/12.92:Math.pow((w+.055)/1.055,2.4))+.0722*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))}g.relativeLuminance=function(g){return t(g>>16&255,g>>8&255,255&g)},g.relativeLuminance2=t}(x||(m.rgb=x={})),function(g){function t(g,m,C){let y=g>>24&255,w=g>>16&255,k=g>>8&255,D=m>>24&255,R=m>>16&255,A=m>>8&255,B=f(x.relativeLuminance2(D,R,A),x.relativeLuminance2(y,w,k));for(;B<C&&(D>0||R>0||A>0);)D-=Math.max(0,Math.ceil(.1*D)),R-=Math.max(0,Math.ceil(.1*R)),A-=Math.max(0,Math.ceil(.1*A)),B=f(x.relativeLuminance2(D,R,A),x.relativeLuminance2(y,w,k));return(D<<24|R<<16|A<<8|255)>>>0}function i(g,m,C){let y=g>>24&255,w=g>>16&255,k=g>>8&255,D=m>>24&255,R=m>>16&255,A=m>>8&255,B=f(x.relativeLuminance2(D,R,A),x.relativeLuminance2(y,w,k));for(;B<C&&(D<255||R<255||A<255);)D=Math.min(255,D+Math.ceil(.1*(255-D))),R=Math.min(255,R+Math.ceil(.1*(255-R))),A=Math.min(255,A+Math.ceil(.1*(255-A))),B=f(x.relativeLuminance2(D,R,A),x.relativeLuminance2(y,w,k));return(D<<24|R<<16|A<<8|255)>>>0}g.ensureContrastRatio=function(g,m,C){let y=x.relativeLuminance(g>>8),w=x.relativeLuminance(m>>8);if(f(y,w)<C){if(w<y){let w=t(g,m,C),k=f(y,x.relativeLuminance(w>>8));if(k<C){let D=i(g,m,C);return k>f(y,x.relativeLuminance(D>>8))?w:D}return w}let k=i(g,m,C),D=f(y,x.relativeLuminance(k>>8));if(D<C){let w=t(g,m,C);return D>f(y,x.relativeLuminance(w>>8))?k:w}return k}},g.reduceLuminance=t,g.increaseLuminance=i,g.toChannels=function(g){return[g>>24&255,g>>16&255,g>>8&255,255&g]},g.toColor=function(g,m,C,w){return{css:y.toCss(g,m,C,w),rgba:y.toRgba(g,m,C,w)}}}(D||(m.rgba=D={})),m.toPaddedHex=u,m.contrastRatio=f},8969:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.CoreTerminal=void 0;let y=C(844),w=C(2585),k=C(4348),x=C(7866),D=C(744),R=C(7302),A=C(6975),B=C(8460),T=C(1753),M=C(1480),O=C(7994),I=C(9282),H=C(5435),F=C(5981),W=C(2660),U=!1;let S=class S extends y.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new B.EventEmitter),this._onScroll.event(g=>{var m;null===(m=this._onScrollApi)||void 0===m||m.fire(g.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(g){for(let m in g)this.optionsService.options[m]=g[m]}constructor(g){super(),this._windowsWrappingHeuristics=this.register(new y.MutableDisposable),this._onBinary=this.register(new B.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new B.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new B.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new B.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new B.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new B.EventEmitter),this._instantiationService=new k.InstantiationService,this.optionsService=this.register(new R.OptionsService(g)),this._instantiationService.setService(w.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(D.BufferService)),this._instantiationService.setService(w.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(x.LogService)),this._instantiationService.setService(w.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(A.CoreService)),this._instantiationService.setService(w.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(T.CoreMouseService)),this._instantiationService.setService(w.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(M.UnicodeService)),this._instantiationService.setService(w.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(O.CharsetService),this._instantiationService.setService(w.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(W.OscLinkService),this._instantiationService.setService(w.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new H.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,B.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,B.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,B.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,B.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(g=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(g=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new F.WriteBuffer((g,m)=>this._inputHandler.parse(g,m))),this.register((0,B.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(g,m){this._writeBuffer.write(g,m)}writeSync(g,m){this._logService.logLevel<=w.LogLevelEnum.WARN&&!U&&(this._logService.warn("writeSync is unreliable and will be removed soon."),U=!0),this._writeBuffer.writeSync(g,m)}resize(g,m){isNaN(g)||isNaN(m)||(g=Math.max(g,D.MINIMUM_COLS),m=Math.max(m,D.MINIMUM_ROWS),this._bufferService.resize(g,m))}scroll(g,m=!1){this._bufferService.scroll(g,m)}scrollLines(g,m,C){this._bufferService.scrollLines(g,m,C)}scrollPages(g){this.scrollLines(g*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(g){let m=g-this._bufferService.buffer.ydisp;0!==m&&this.scrollLines(m)}registerEscHandler(g,m){return this._inputHandler.registerEscHandler(g,m)}registerDcsHandler(g,m){return this._inputHandler.registerDcsHandler(g,m)}registerCsiHandler(g,m){return this._inputHandler.registerCsiHandler(g,m)}registerOscHandler(g,m){return this._inputHandler.registerOscHandler(g,m)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let g=!1,m=this.optionsService.rawOptions.windowsPty;m&&void 0!==m.buildNumber&&void 0!==m.buildNumber?g=!!("conpty"===m.backend&&m.buildNumber<21376):this.optionsService.rawOptions.windowsMode&&(g=!0),g?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let g=[];g.push(this.onLineFeed(I.updateWindowsModeWrappedState.bind(null,this._bufferService))),g.push(this.registerCsiHandler({final:"H"},()=>((0,I.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,y.toDisposable)(()=>{for(let m of g)m.dispose()})}}};m.CoreTerminal=S},8460:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.forwardEvent=m.EventEmitter=void 0,m.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=g=>(this._listeners.push(g),{dispose:()=>{if(!this._disposed){for(let m=0;m<this._listeners.length;m++)if(this._listeners[m]===g)return void this._listeners.splice(m,1)}}})),this._event}fire(g,m){let C=[];for(let g=0;g<this._listeners.length;g++)C.push(this._listeners[g]);for(let y=0;y<C.length;y++)C[y].call(void 0,g,m)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},m.forwardEvent=function(g,m){return g(g=>m.fire(g))}},5435:function(g,m,C){var y,w,k=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},x=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.InputHandler=m.WindowsOptionsReportType=void 0;let D=C(2584),R=C(7116),A=C(2015),B=C(844),T=C(482),M=C(8437),O=C(8460),I=C(643),H=C(511),F=C(3734),W=C(2585),U=C(6242),N=C(6351),$=C(5941),j={"(":0,")":1,"*":2,"+":3,"-":1,".":2};function b(g,m){if(g>24)return m.setWinLines||!1;switch(g){case 1:return!!m.restoreWin;case 2:return!!m.minimizeWin;case 3:return!!m.setWinPosition;case 4:return!!m.setWinSizePixels;case 5:return!!m.raiseWin;case 6:return!!m.lowerWin;case 7:return!!m.refreshWin;case 8:return!!m.setWinSizeChars;case 9:return!!m.maximizeWin;case 10:return!!m.fullscreenWin;case 11:return!!m.getWinState;case 13:return!!m.getWinPosition;case 14:return!!m.getWinSizePixels;case 15:return!!m.getScreenSizePixels;case 16:return!!m.getCellSizePixels;case 18:return!!m.getWinSizeChars;case 19:return!!m.getScreenSizeChars;case 20:return!!m.getIconTitle;case 21:return!!m.getWinTitle;case 22:return!!m.pushTitle;case 23:return!!m.popTitle;case 24:return!!m.setWinLines}return!1}(y=w||(m.WindowsOptionsReportType=w={}))[y.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",y[y.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS";let z=0;let E=class E extends B.Disposable{getAttrData(){return this._curAttrData}constructor(g,m,C,y,w,k,x,B,I=new A.EscapeSequenceParser){for(let A in super(),this._bufferService=g,this._charsetService=m,this._coreService=C,this._logService=y,this._optionsService=w,this._oscLinkService=k,this._coreMouseService=x,this._unicodeService=B,this._parser=I,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new T.StringToUtf32,this._utf8Decoder=new T.Utf8ToUtf32,this._workCell=new H.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=M.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=M.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new O.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new O.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new O.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new O.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new O.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new O.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new O.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new O.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new O.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new O.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new O.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new O.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new O.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new K(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(g=>this._activeBuffer=g.activeBuffer)),this._parser.setCsiHandlerFallback((g,m)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(g),params:m.toArray()})}),this._parser.setEscHandlerFallback(g=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(g)})}),this._parser.setExecuteHandlerFallback(g=>{this._logService.debug("Unknown EXECUTE code: ",{code:g})}),this._parser.setOscHandlerFallback((g,m,C)=>{this._logService.debug("Unknown OSC code: ",{identifier:g,action:m,data:C})}),this._parser.setDcsHandlerFallback((g,m,C)=>{"HOOK"===m&&(C=C.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(g),action:m,payload:C})}),this._parser.setPrintHandler((g,m,C)=>this.print(g,m,C)),this._parser.registerCsiHandler({final:"@"},g=>this.insertChars(g)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},g=>this.scrollLeft(g)),this._parser.registerCsiHandler({final:"A"},g=>this.cursorUp(g)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},g=>this.scrollRight(g)),this._parser.registerCsiHandler({final:"B"},g=>this.cursorDown(g)),this._parser.registerCsiHandler({final:"C"},g=>this.cursorForward(g)),this._parser.registerCsiHandler({final:"D"},g=>this.cursorBackward(g)),this._parser.registerCsiHandler({final:"E"},g=>this.cursorNextLine(g)),this._parser.registerCsiHandler({final:"F"},g=>this.cursorPrecedingLine(g)),this._parser.registerCsiHandler({final:"G"},g=>this.cursorCharAbsolute(g)),this._parser.registerCsiHandler({final:"H"},g=>this.cursorPosition(g)),this._parser.registerCsiHandler({final:"I"},g=>this.cursorForwardTab(g)),this._parser.registerCsiHandler({final:"J"},g=>this.eraseInDisplay(g,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},g=>this.eraseInDisplay(g,!0)),this._parser.registerCsiHandler({final:"K"},g=>this.eraseInLine(g,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},g=>this.eraseInLine(g,!0)),this._parser.registerCsiHandler({final:"L"},g=>this.insertLines(g)),this._parser.registerCsiHandler({final:"M"},g=>this.deleteLines(g)),this._parser.registerCsiHandler({final:"P"},g=>this.deleteChars(g)),this._parser.registerCsiHandler({final:"S"},g=>this.scrollUp(g)),this._parser.registerCsiHandler({final:"T"},g=>this.scrollDown(g)),this._parser.registerCsiHandler({final:"X"},g=>this.eraseChars(g)),this._parser.registerCsiHandler({final:"Z"},g=>this.cursorBackwardTab(g)),this._parser.registerCsiHandler({final:"`"},g=>this.charPosAbsolute(g)),this._parser.registerCsiHandler({final:"a"},g=>this.hPositionRelative(g)),this._parser.registerCsiHandler({final:"b"},g=>this.repeatPrecedingCharacter(g)),this._parser.registerCsiHandler({final:"c"},g=>this.sendDeviceAttributesPrimary(g)),this._parser.registerCsiHandler({prefix:">",final:"c"},g=>this.sendDeviceAttributesSecondary(g)),this._parser.registerCsiHandler({final:"d"},g=>this.linePosAbsolute(g)),this._parser.registerCsiHandler({final:"e"},g=>this.vPositionRelative(g)),this._parser.registerCsiHandler({final:"f"},g=>this.hVPosition(g)),this._parser.registerCsiHandler({final:"g"},g=>this.tabClear(g)),this._parser.registerCsiHandler({final:"h"},g=>this.setMode(g)),this._parser.registerCsiHandler({prefix:"?",final:"h"},g=>this.setModePrivate(g)),this._parser.registerCsiHandler({final:"l"},g=>this.resetMode(g)),this._parser.registerCsiHandler({prefix:"?",final:"l"},g=>this.resetModePrivate(g)),this._parser.registerCsiHandler({final:"m"},g=>this.charAttributes(g)),this._parser.registerCsiHandler({final:"n"},g=>this.deviceStatus(g)),this._parser.registerCsiHandler({prefix:"?",final:"n"},g=>this.deviceStatusPrivate(g)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},g=>this.softReset(g)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},g=>this.setCursorStyle(g)),this._parser.registerCsiHandler({final:"r"},g=>this.setScrollRegion(g)),this._parser.registerCsiHandler({final:"s"},g=>this.saveCursor(g)),this._parser.registerCsiHandler({final:"t"},g=>this.windowOptions(g)),this._parser.registerCsiHandler({final:"u"},g=>this.restoreCursor(g)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},g=>this.insertColumns(g)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},g=>this.deleteColumns(g)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},g=>this.selectProtected(g)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},g=>this.requestMode(g,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},g=>this.requestMode(g,!1)),this._parser.setExecuteHandler(D.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(D.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(D.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(D.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(D.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(D.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(D.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(D.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(D.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(D.C1.IND,()=>this.index()),this._parser.setExecuteHandler(D.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(D.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new U.OscHandler(g=>(this.setTitle(g),this.setIconName(g),!0))),this._parser.registerOscHandler(1,new U.OscHandler(g=>this.setIconName(g))),this._parser.registerOscHandler(2,new U.OscHandler(g=>this.setTitle(g))),this._parser.registerOscHandler(4,new U.OscHandler(g=>this.setOrReportIndexedColor(g))),this._parser.registerOscHandler(8,new U.OscHandler(g=>this.setHyperlink(g))),this._parser.registerOscHandler(10,new U.OscHandler(g=>this.setOrReportFgColor(g))),this._parser.registerOscHandler(11,new U.OscHandler(g=>this.setOrReportBgColor(g))),this._parser.registerOscHandler(12,new U.OscHandler(g=>this.setOrReportCursorColor(g))),this._parser.registerOscHandler(104,new U.OscHandler(g=>this.restoreIndexedColor(g))),this._parser.registerOscHandler(110,new U.OscHandler(g=>this.restoreFgColor(g))),this._parser.registerOscHandler(111,new U.OscHandler(g=>this.restoreBgColor(g))),this._parser.registerOscHandler(112,new U.OscHandler(g=>this.restoreCursorColor(g))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset()),R.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:A},()=>this.selectCharset("("+A)),this._parser.registerEscHandler({intermediates:")",final:A},()=>this.selectCharset(")"+A)),this._parser.registerEscHandler({intermediates:"*",final:A},()=>this.selectCharset("*"+A)),this._parser.registerEscHandler({intermediates:"+",final:A},()=>this.selectCharset("+"+A)),this._parser.registerEscHandler({intermediates:"-",final:A},()=>this.selectCharset("-"+A)),this._parser.registerEscHandler({intermediates:".",final:A},()=>this.selectCharset("."+A)),this._parser.registerEscHandler({intermediates:"/",final:A},()=>this.selectCharset("/"+A));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(g=>(this._logService.error("Parsing error: ",g),g)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new N.DcsHandler((g,m)=>this.requestStatusString(g,m)))}_preserveStack(g,m,C,y){this._parseStack.paused=!0,this._parseStack.cursorStartX=g,this._parseStack.cursorStartY=m,this._parseStack.decodedLength=C,this._parseStack.position=y}_logSlowResolvingAsync(g){this._logService.logLevel<=W.LogLevelEnum.WARN&&Promise.race([g,new Promise((g,m)=>setTimeout(()=>m("#SLOW_TIMEOUT"),5e3))]).catch(g=>{if("#SLOW_TIMEOUT"!==g)throw g;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(g,m){let C,y=this._activeBuffer.x,w=this._activeBuffer.y,k=0,x=this._parseStack.paused;if(x){if(C=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,m))return this._logSlowResolvingAsync(C),C;y=this._parseStack.cursorStartX,w=this._parseStack.cursorStartY,this._parseStack.paused=!1,g.length>131072&&(k=this._parseStack.position+131072)}if(this._logService.logLevel<=W.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+("string"==typeof g?` "${g}"`:` "${Array.prototype.map.call(g,g=>String.fromCharCode(g)).join("")}"`),"string"==typeof g?g.split("").map(g=>g.charCodeAt(0)):g),this._parseBuffer.length<g.length&&this._parseBuffer.length<131072&&(this._parseBuffer=new Uint32Array(Math.min(g.length,131072))),x||this._dirtyRowTracker.clearRange(),g.length>131072)for(let m=k;m<g.length;m+=131072){let k=m+131072<g.length?m+131072:g.length,x="string"==typeof g?this._stringDecoder.decode(g.substring(m,k),this._parseBuffer):this._utf8Decoder.decode(g.subarray(m,k),this._parseBuffer);if(C=this._parser.parse(this._parseBuffer,x))return this._preserveStack(y,w,x,m),this._logSlowResolvingAsync(C),C}else if(!x){let m="string"==typeof g?this._stringDecoder.decode(g,this._parseBuffer):this._utf8Decoder.decode(g,this._parseBuffer);if(C=this._parser.parse(this._parseBuffer,m))return this._preserveStack(y,w,m,0),this._logSlowResolvingAsync(C),C}this._activeBuffer.x===y&&this._activeBuffer.y===w||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(g,m,C){let y,w;let k=this._charsetService.charset,x=this._optionsService.rawOptions.screenReaderMode,D=this._bufferService.cols,R=this._coreService.decPrivateModes.wraparound,A=this._coreService.modes.insertMode,B=this._curAttrData,M=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&C-m>0&&2===M.getWidth(this._activeBuffer.x-1)&&M.setCellFromCodePoint(this._activeBuffer.x-1,0,1,B.fg,B.bg,B.extended);for(let O=m;O<C;++O){if(y=g[O],w=this._unicodeService.wcwidth(y),y<127&&k){let g=k[String.fromCharCode(y)];g&&(y=g.charCodeAt(0))}if(x&&this._onA11yChar.fire((0,T.stringFromCodePoint)(y)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),w||!this._activeBuffer.x){if(this._activeBuffer.x+w-1>=D){if(R){for(;this._activeBuffer.x<D;)M.setCellFromCodePoint(this._activeBuffer.x++,0,1,B.fg,B.bg,B.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),M=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=D-1,2===w)continue}if(A&&(M.insertCells(this._activeBuffer.x,w,this._activeBuffer.getNullCell(B),B),2===M.getWidth(D-1)&&M.setCellFromCodePoint(D-1,I.NULL_CELL_CODE,I.NULL_CELL_WIDTH,B.fg,B.bg,B.extended)),M.setCellFromCodePoint(this._activeBuffer.x++,y,w,B.fg,B.bg,B.extended),w>0)for(;--w;)M.setCellFromCodePoint(this._activeBuffer.x++,0,0,B.fg,B.bg,B.extended)}else M.getWidth(this._activeBuffer.x-1)?M.addCodepointToCell(this._activeBuffer.x-1,y):M.addCodepointToCell(this._activeBuffer.x-2,y)}C-m>0&&(M.loadCell(this._activeBuffer.x-1,this._workCell),2===this._workCell.getWidth()||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<D&&C-m>0&&0===M.getWidth(this._activeBuffer.x)&&!M.hasContent(this._activeBuffer.x)&&M.setCellFromCodePoint(this._activeBuffer.x,0,1,B.fg,B.bg,B.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(g,m){return"t"!==g.final||g.prefix||g.intermediates?this._parser.registerCsiHandler(g,m):this._parser.registerCsiHandler(g,g=>!b(g.params[0],this._optionsService.rawOptions.windowOptions)||m(g))}registerDcsHandler(g,m){return this._parser.registerDcsHandler(g,new N.DcsHandler(m))}registerEscHandler(g,m){return this._parser.registerEscHandler(g,m)}registerOscHandler(g,m){return this._parser.registerOscHandler(g,new U.OscHandler(m))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var g;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(null===(g=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))||void 0===g?void 0:g.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let g=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);g.hasWidth(this._activeBuffer.x)&&!g.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let g=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-g),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(g=this._bufferService.cols-1){this._activeBuffer.x=Math.min(g,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(g,m){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=g,this._activeBuffer.y=this._activeBuffer.scrollTop+m):(this._activeBuffer.x=g,this._activeBuffer.y=m),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(g,m){this._restrictCursor(),this._setCursor(this._activeBuffer.x+g,this._activeBuffer.y+m)}cursorUp(g){let m=this._activeBuffer.y-this._activeBuffer.scrollTop;return m>=0?this._moveCursor(0,-Math.min(m,g.params[0]||1)):this._moveCursor(0,-(g.params[0]||1)),!0}cursorDown(g){let m=this._activeBuffer.scrollBottom-this._activeBuffer.y;return m>=0?this._moveCursor(0,Math.min(m,g.params[0]||1)):this._moveCursor(0,g.params[0]||1),!0}cursorForward(g){return this._moveCursor(g.params[0]||1,0),!0}cursorBackward(g){return this._moveCursor(-(g.params[0]||1),0),!0}cursorNextLine(g){return this.cursorDown(g),this._activeBuffer.x=0,!0}cursorPrecedingLine(g){return this.cursorUp(g),this._activeBuffer.x=0,!0}cursorCharAbsolute(g){return this._setCursor((g.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(g){return this._setCursor(g.length>=2?(g.params[1]||1)-1:0,(g.params[0]||1)-1),!0}charPosAbsolute(g){return this._setCursor((g.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(g){return this._moveCursor(g.params[0]||1,0),!0}linePosAbsolute(g){return this._setCursor(this._activeBuffer.x,(g.params[0]||1)-1),!0}vPositionRelative(g){return this._moveCursor(0,g.params[0]||1),!0}hVPosition(g){return this.cursorPosition(g),!0}tabClear(g){let m=g.params[0];return 0===m?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===m&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(g){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let m=g.params[0]||1;for(;m--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(g){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let m=g.params[0]||1;for(;m--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(g){let m=g.params[0];return 1===m&&(this._curAttrData.bg|=536870912),2!==m&&0!==m||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(g,m,C,y=!1,w=!1){let k=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);k.replaceCells(m,C,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),w),y&&(k.isWrapped=!1)}_resetBufferLine(g,m=!1){let C=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);C&&(C.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),m),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+g),C.isWrapped=!1)}eraseInDisplay(g,m=!1){let C;switch(this._restrictCursor(this._bufferService.cols),g.params[0]){case 0:for(C=this._activeBuffer.y,this._dirtyRowTracker.markDirty(C),this._eraseInBufferLine(C++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,m);C<this._bufferService.rows;C++)this._resetBufferLine(C,m);this._dirtyRowTracker.markDirty(C);break;case 1:for(C=this._activeBuffer.y,this._dirtyRowTracker.markDirty(C),this._eraseInBufferLine(C,0,this._activeBuffer.x+1,!0,m),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(C+1).isWrapped=!1);C--;)this._resetBufferLine(C,m);this._dirtyRowTracker.markDirty(0);break;case 2:for(C=this._bufferService.rows,this._dirtyRowTracker.markDirty(C-1);C--;)this._resetBufferLine(C,m);this._dirtyRowTracker.markDirty(0);break;case 3:let y=this._activeBuffer.lines.length-this._bufferService.rows;y>0&&(this._activeBuffer.lines.trimStart(y),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-y,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-y,0),this._onScroll.fire(0))}return!0}eraseInLine(g,m=!1){switch(this._restrictCursor(this._bufferService.cols),g.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,m);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,m);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,m)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(g){this._restrictCursor();let m=g.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let C=this._activeBuffer.ybase+this._activeBuffer.y,y=this._bufferService.rows-1-this._activeBuffer.scrollBottom,w=this._bufferService.rows-1+this._activeBuffer.ybase-y+1;for(;m--;)this._activeBuffer.lines.splice(w-1,1),this._activeBuffer.lines.splice(C,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(g){let m;this._restrictCursor();let C=g.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let y=this._activeBuffer.ybase+this._activeBuffer.y;for(m=this._bufferService.rows-1-this._activeBuffer.scrollBottom,m=this._bufferService.rows-1+this._activeBuffer.ybase-m;C--;)this._activeBuffer.lines.splice(y,1),this._activeBuffer.lines.splice(m,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(g){this._restrictCursor();let m=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return m&&(m.insertCells(this._activeBuffer.x,g.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(g){this._restrictCursor();let m=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return m&&(m.deleteCells(this._activeBuffer.x,g.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(g){let m=g.params[0]||1;for(;m--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(g){let m=g.params[0]||1;for(;m--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(M.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let m=g.params[0]||1;for(let g=this._activeBuffer.scrollTop;g<=this._activeBuffer.scrollBottom;++g){let C=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);C.deleteCells(0,m,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),C.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let m=g.params[0]||1;for(let g=this._activeBuffer.scrollTop;g<=this._activeBuffer.scrollBottom;++g){let C=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);C.insertCells(0,m,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),C.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let m=g.params[0]||1;for(let g=this._activeBuffer.scrollTop;g<=this._activeBuffer.scrollBottom;++g){let C=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);C.insertCells(this._activeBuffer.x,m,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),C.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let m=g.params[0]||1;for(let g=this._activeBuffer.scrollTop;g<=this._activeBuffer.scrollBottom;++g){let C=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);C.deleteCells(this._activeBuffer.x,m,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),C.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(g){this._restrictCursor();let m=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return m&&(m.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(g.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(g){if(!this._parser.precedingCodepoint)return!0;let m=g.params[0]||1,C=new Uint32Array(m);for(let g=0;g<m;++g)C[g]=this._parser.precedingCodepoint;return this.print(C,0,C.length),!0}sendDeviceAttributesPrimary(g){return g.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(D.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(D.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(g){return g.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(D.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(D.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(g.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(D.C0.ESC+"[>83;40003;0c")),!0}_is(g){return 0===(this._optionsService.rawOptions.termName+"").indexOf(g)}setMode(g){for(let m=0;m<g.length;m++)switch(g.params[m]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(g){for(let m=0;m<g.length;m++)switch(g.params[m]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,R.DEFAULT_CHARSET),this._charsetService.setgCharset(1,R.DEFAULT_CHARSET),this._charsetService.setgCharset(2,R.DEFAULT_CHARSET),this._charsetService.setgCharset(3,R.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(g){for(let m=0;m<g.length;m++)switch(g.params[m]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(g){for(let m=0;m<g.length;m++)switch(g.params[m]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===g.params[m]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(g,m){var C;let y=this._coreService.decPrivateModes,{activeProtocol:w,activeEncoding:k}=this._coreMouseService,x=this._coreService,{buffers:R,cols:A}=this._bufferService,{active:B,alt:T}=R,M=this._optionsService.rawOptions,_=g=>g?1:2,O=g.params[0];return C=m?2===O?4:4===O?_(x.modes.insertMode):12===O?3:20===O?_(M.convertEol):0:1===O?_(y.applicationCursorKeys):3===O?M.windowOptions.setWinLines?80===A?2:132===A?1:0:0:6===O?_(y.origin):7===O?_(y.wraparound):8===O?3:9===O?_("X10"===w):12===O?_(M.cursorBlink):25===O?_(!x.isCursorHidden):45===O?_(y.reverseWraparound):66===O?_(y.applicationKeypad):67===O?4:1e3===O?_("VT200"===w):1002===O?_("DRAG"===w):1003===O?_("ANY"===w):1004===O?_(y.sendFocus):1005===O?4:1006===O?_("SGR"===k):1015===O?4:1016===O?_("SGR_PIXELS"===k):1048===O?1:47===O||1047===O||1049===O?_(B===T):2004===O?_(y.bracketedPasteMode):0,x.triggerDataEvent(`${D.C0.ESC}[${m?"":"?"}${O};${C}$y`),!0}_updateAttrColor(g,m,C,y,w){return 2===m?(g|=50331648,g&=-16777216,g|=F.AttributeData.fromColorRGB([C,y,w])):5===m&&(g&=-50331904,g|=33554432|255&C),g}_extractColor(g,m,C){let y=[0,0,-1,0,0,0],w=0,k=0;do{if(y[k+w]=g.params[m+k],g.hasSubParams(m+k)){let C=g.getSubParams(m+k),x=0;do 5===y[1]&&(w=1),y[k+x+1+w]=C[x];while(++x<C.length&&x+k+1+w<y.length);break}if(5===y[1]&&k+w>=2||2===y[1]&&k+w>=5)break;y[1]&&(w=1)}while(++k+m<g.length&&k+w<y.length);for(let g=2;g<y.length;++g)-1===y[g]&&(y[g]=0);switch(y[0]){case 38:C.fg=this._updateAttrColor(C.fg,y[1],y[3],y[4],y[5]);break;case 48:C.bg=this._updateAttrColor(C.bg,y[1],y[3],y[4],y[5]);break;case 58:C.extended=C.extended.clone(),C.extended.underlineColor=this._updateAttrColor(C.extended.underlineColor,y[1],y[3],y[4],y[5])}return k}_processUnderline(g,m){m.extended=m.extended.clone(),(!~g||g>5)&&(g=1),m.extended.underlineStyle=g,m.fg|=268435456,0===g&&(m.fg&=-268435457),m.updateExtended()}_processSGR0(g){g.fg=M.DEFAULT_ATTR_DATA.fg,g.bg=M.DEFAULT_ATTR_DATA.bg,g.extended=g.extended.clone(),g.extended.underlineStyle=0,g.extended.underlineColor&=-67108864,g.updateExtended()}charAttributes(g){let m;if(1===g.length&&0===g.params[0])return this._processSGR0(this._curAttrData),!0;let C=g.length,y=this._curAttrData;for(let w=0;w<C;w++)(m=g.params[w])>=30&&m<=37?(y.fg&=-50331904,y.fg|=16777216|m-30):m>=40&&m<=47?(y.bg&=-50331904,y.bg|=16777216|m-40):m>=90&&m<=97?(y.fg&=-50331904,y.fg|=16777224|m-90):m>=100&&m<=107?(y.bg&=-50331904,y.bg|=16777224|m-100):0===m?this._processSGR0(y):1===m?y.fg|=134217728:3===m?y.bg|=67108864:4===m?(y.fg|=268435456,this._processUnderline(g.hasSubParams(w)?g.getSubParams(w)[0]:1,y)):5===m?y.fg|=536870912:7===m?y.fg|=67108864:8===m?y.fg|=1073741824:9===m?y.fg|=2147483648:2===m?y.bg|=134217728:21===m?this._processUnderline(2,y):22===m?(y.fg&=-134217729,y.bg&=-134217729):23===m?y.bg&=-67108865:24===m?(y.fg&=-268435457,this._processUnderline(0,y)):25===m?y.fg&=-536870913:27===m?y.fg&=-67108865:28===m?y.fg&=-1073741825:29===m?y.fg&=2147483647:39===m?(y.fg&=-67108864,y.fg|=16777215&M.DEFAULT_ATTR_DATA.fg):49===m?(y.bg&=-67108864,y.bg|=16777215&M.DEFAULT_ATTR_DATA.bg):38===m||48===m||58===m?w+=this._extractColor(g,w,y):53===m?y.bg|=1073741824:55===m?y.bg&=-1073741825:59===m?(y.extended=y.extended.clone(),y.extended.underlineColor=-1,y.updateExtended()):100===m?(y.fg&=-67108864,y.fg|=16777215&M.DEFAULT_ATTR_DATA.fg,y.bg&=-67108864,y.bg|=16777215&M.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",m);return!0}deviceStatus(g){switch(g.params[0]){case 5:this._coreService.triggerDataEvent(`${D.C0.ESC}[0n`);break;case 6:let m=this._activeBuffer.y+1,C=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${D.C0.ESC}[${m};${C}R`)}return!0}deviceStatusPrivate(g){if(6===g.params[0]){let g=this._activeBuffer.y+1,m=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${D.C0.ESC}[?${g};${m}R`)}return!0}softReset(g){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=M.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(g){let m=g.params[0]||1;switch(m){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}return this._optionsService.options.cursorBlink=m%2==1,!0}setScrollRegion(g){let m;let C=g.params[0]||1;return(g.length<2||(m=g.params[1])>this._bufferService.rows||0===m)&&(m=this._bufferService.rows),m>C&&(this._activeBuffer.scrollTop=C-1,this._activeBuffer.scrollBottom=m-1,this._setCursor(0,0)),!0}windowOptions(g){if(!b(g.params[0],this._optionsService.rawOptions.windowOptions))return!0;let m=g.length>1?g.params[1]:0;switch(g.params[0]){case 14:2!==m&&this._onRequestWindowsOptionsReport.fire(w.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(w.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${D.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:0!==m&&2!==m||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),0!==m&&1!==m||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:0!==m&&2!==m||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),0!==m&&1!==m||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(g){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(g){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(g){return this._windowTitle=g,this._onTitleChange.fire(g),!0}setIconName(g){return this._iconName=g,!0}setOrReportIndexedColor(g){let m=[],C=g.split(";");for(;C.length>1;){let g=C.shift(),y=C.shift();if(/^\d+$/.exec(g)){let C=parseInt(g);if(L(C)){if("?"===y)m.push({type:0,index:C});else{let g=(0,$.parseColor)(y);g&&m.push({type:1,index:C,color:g})}}}}return m.length&&this._onColor.fire(m),!0}setHyperlink(g){let m=g.split(";");return!(m.length<2)&&(m[1]?this._createHyperlink(m[0],m[1]):!m[0]&&this._finishHyperlink())}_createHyperlink(g,m){let C;this._getCurrentLinkId()&&this._finishHyperlink();let y=g.split(":"),w=y.findIndex(g=>g.startsWith("id="));return -1!==w&&(C=y[w].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:C,uri:m}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(g,m){let C=g.split(";");for(let g=0;g<C.length&&!(m>=this._specialColors.length);++g,++m)if("?"===C[g])this._onColor.fire([{type:0,index:this._specialColors[m]}]);else{let y=(0,$.parseColor)(C[g]);y&&this._onColor.fire([{type:1,index:this._specialColors[m],color:y}])}return!0}setOrReportFgColor(g){return this._setOrReportSpecialColor(g,0)}setOrReportBgColor(g){return this._setOrReportSpecialColor(g,1)}setOrReportCursorColor(g){return this._setOrReportSpecialColor(g,2)}restoreIndexedColor(g){if(!g)return this._onColor.fire([{type:2}]),!0;let m=[],C=g.split(";");for(let g=0;g<C.length;++g)if(/^\d+$/.exec(C[g])){let y=parseInt(C[g]);L(y)&&m.push({type:2,index:y})}return m.length&&this._onColor.fire(m),!0}restoreFgColor(g){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(g){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(g){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,R.DEFAULT_CHARSET),!0}selectCharset(g){return 2!==g.length?this.selectDefaultCharset():"/"===g[0]||this._charsetService.setgCharset(j[g[0]],R.CHARSETS[g[1]]||R.DEFAULT_CHARSET),!0}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let g=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,g,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=M.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=M.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(g){return this._charsetService.setgLevel(g),!0}screenAlignmentPattern(){let g=new H.CellData;g.content=4194373,g.fg=this._curAttrData.fg,g.bg=this._curAttrData.bg,this._setCursor(0,0);for(let m=0;m<this._bufferService.rows;++m){let C=this._activeBuffer.ybase+this._activeBuffer.y+m,y=this._activeBuffer.lines.get(C);y&&(y.fill(g),y.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(g,m){var C;let y=this._bufferService.buffer,w=this._optionsService.rawOptions;return C='"q'===g?`P1$r${this._curAttrData.isProtected()?1:0}"q`:'"p'===g?'P1$r61;1"p':"r"===g?`P1$r${y.scrollTop+1};${y.scrollBottom+1}r`:"m"===g?"P1$r0m":" q"===g?`P1$r${({block:2,underline:4,bar:6})[w.cursorStyle]-(w.cursorBlink?1:0)} q`:"P0$r",this._coreService.triggerDataEvent(`${D.C0.ESC}${C}${D.C0.ESC}\\`),!0}markRangeDirty(g,m){this._dirtyRowTracker.markRangeDirty(g,m)}};m.InputHandler=E;let K=class{constructor(g){this._bufferService=g,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(g){g<this.start?this.start=g:g>this.end&&(this.end=g)}markRangeDirty(g,m){g>m&&(z=g,g=m,m=z),g<this.start&&(this.start=g),m>this.end&&(this.end=m)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function L(g){return 0<=g&&g<256}K=k([x(0,W.IBufferService)],K)},844:(g,m)=>{function i(g){for(let m of g)m.dispose();g.length=0}Object.defineProperty(m,"__esModule",{value:!0}),m.getDisposeArrayDisposable=m.disposeArray=m.toDisposable=m.MutableDisposable=m.Disposable=void 0,m.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){for(let g of(this._isDisposed=!0,this._disposables))g.dispose();this._disposables.length=0}register(g){return this._disposables.push(g),g}unregister(g){let m=this._disposables.indexOf(g);-1!==m&&this._disposables.splice(m,1)}},m.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(g){var m;this._isDisposed||g===this._value||(null===(m=this._value)||void 0===m||m.dispose(),this._value=g)}clear(){this.value=void 0}dispose(){var g;this._isDisposed=!0,null===(g=this._value)||void 0===g||g.dispose(),this._value=void 0}},m.toDisposable=function(g){return{dispose:g}},m.disposeArray=i,m.getDisposeArrayDisposable=function(g){return{dispose:()=>i(g)}}},1505:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.FourKeyMap=m.TwoKeyMap=void 0;let i=class i{constructor(){this._data={}}set(g,m,C){this._data[g]||(this._data[g]={}),this._data[g][m]=C}get(g,m){return this._data[g]?this._data[g][m]:void 0}clear(){this._data={}}};m.TwoKeyMap=i,m.FourKeyMap=class{constructor(){this._data=new i}set(g,m,C,y,w){this._data.get(g,m)||this._data.set(g,m,new i),this._data.get(g,m).set(C,y,w)}get(g,m,C,y){var w;return null===(w=this._data.get(g,m))||void 0===w?void 0:w.get(C,y)}clear(){this._data.clear()}}},6114:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.isChromeOS=m.isLinux=m.isWindows=m.isIphone=m.isIpad=m.isMac=m.getSafariVersion=m.isSafari=m.isLegacyEdge=m.isFirefox=m.isNode=void 0,m.isNode="undefined"==typeof navigator;let C=m.isNode?"node":navigator.userAgent,y=m.isNode?"node":navigator.platform;m.isFirefox=C.includes("Firefox"),m.isLegacyEdge=C.includes("Edge"),m.isSafari=/^((?!chrome|android).)*safari/i.test(C),m.getSafariVersion=function(){if(!m.isSafari)return 0;let g=C.match(/Version\/(\d+)/);return null===g||g.length<2?0:parseInt(g[1])},m.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(y),m.isIpad="iPad"===y,m.isIphone="iPhone"===y,m.isWindows=["Windows","Win16","Win32","WinCE"].includes(y),m.isLinux=y.indexOf("Linux")>=0,m.isChromeOS=/\bCrOS\b/.test(C)},6106:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.SortedList=void 0;let C=0;m.SortedList=class{constructor(g){this._getKey=g,this._array=[]}clear(){this._array.length=0}insert(g){0!==this._array.length?(C=this._search(this._getKey(g)),this._array.splice(C,0,g)):this._array.push(g)}delete(g){if(0===this._array.length)return!1;let m=this._getKey(g);if(void 0===m||-1===(C=this._search(m))||this._getKey(this._array[C])!==m)return!1;do if(this._array[C]===g)return this._array.splice(C,1),!0;while(++C<this._array.length&&this._getKey(this._array[C])===m);return!1}*getKeyIterator(g){if(0!==this._array.length&&!((C=this._search(g))<0||C>=this._array.length)&&this._getKey(this._array[C])===g)do yield this._array[C];while(++C<this._array.length&&this._getKey(this._array[C])===g)}forEachByKey(g,m){if(0!==this._array.length&&!((C=this._search(g))<0||C>=this._array.length)&&this._getKey(this._array[C])===g)do m(this._array[C]);while(++C<this._array.length&&this._getKey(this._array[C])===g)}values(){return[...this._array].values()}_search(g){let m=0,C=this._array.length-1;for(;C>=m;){let y=m+C>>1,w=this._getKey(this._array[y]);if(w>g)C=y-1;else{if(!(w<g)){for(;y>0&&this._getKey(this._array[y-1])===g;)y--;return y}m=y+1}}return m}}},7226:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.DebouncedIdleTask=m.IdleTaskQueue=m.PriorityTaskQueue=void 0;let y=C(6114);let r=class r{constructor(){this._tasks=[],this._i=0}enqueue(g){this._tasks.push(g),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(g){this._idleCallback=void 0;let m=0,C=0,y=g.timeRemaining(),w=0;for(;this._i<this._tasks.length;){if(m=Date.now(),this._tasks[this._i]()||this._i++,1.5*(C=Math.max(m=Math.max(1,Date.now()-m),C))>(w=g.timeRemaining()))return y-m<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(y-m))}ms`),void this._start();y=w}this.clear()}};let n=class n extends r{_requestCallback(g){return setTimeout(()=>g(this._createDeadline(16)))}_cancelCallback(g){clearTimeout(g)}_createDeadline(g){let m=Date.now()+g;return{timeRemaining:()=>Math.max(0,m-Date.now())}}};m.PriorityTaskQueue=n,m.IdleTaskQueue=!y.isNode&&"requestIdleCallback"in window?class extends r{_requestCallback(g){return requestIdleCallback(g)}_cancelCallback(g){cancelIdleCallback(g)}}:n,m.DebouncedIdleTask=class{constructor(){this._queue=new m.IdleTaskQueue}set(g){this._queue.clear(),this._queue.enqueue(g)}flush(){this._queue.flush()}}},9282:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.updateWindowsModeWrappedState=void 0;let y=C(643);m.updateWindowsModeWrappedState=function(g){let m=g.buffer.lines.get(g.buffer.ybase+g.buffer.y-1),C=null==m?void 0:m.get(g.cols-1),w=g.buffer.lines.get(g.buffer.ybase+g.buffer.y);w&&C&&(w.isWrapped=C[y.CHAR_DATA_CODE_INDEX]!==y.NULL_CELL_CODE&&C[y.CHAR_DATA_CODE_INDEX]!==y.WHITESPACE_CELL_CODE)}},3734:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.ExtendedAttrs=m.AttributeData=void 0;let i=class i{constructor(){this.fg=0,this.bg=0,this.extended=new s}static toColorRGB(g){return[g>>>16&255,g>>>8&255,255&g]}static fromColorRGB(g){return(255&g[0])<<16|(255&g[1])<<8|255&g[2]}clone(){let g=new i;return g.fg=this.fg,g.bg=this.bg,g.extended=this.extended.clone(),g}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return 50331648==(50331648&this.fg)}isBgRGB(){return 50331648==(50331648&this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return 0==(50331648&this.fg)}isBgDefault(){return 0==(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return -1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return -1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?50331648==(50331648&this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?0==(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}};m.AttributeData=i;let s=class s{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(g){this._ext=g}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(g){this._ext&=-469762049,this._ext|=g<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(g){this._ext&=-67108864,this._ext|=67108863&g}get urlId(){return this._urlId}set urlId(g){this._urlId=g}constructor(g=0,m=0){this._ext=0,this._urlId=0,this._ext=g,this._urlId=m}clone(){return new s(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}};m.ExtendedAttrs=s},9092:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.Buffer=m.MAX_BUFFER_SIZE=void 0;let y=C(6349),w=C(7226),k=C(3734),x=C(8437),D=C(4634),R=C(511),A=C(643),B=C(4863),T=C(7116);m.MAX_BUFFER_SIZE=4294967295,m.Buffer=class{constructor(g,m,C){this._hasScrollback=g,this._optionsService=m,this._bufferService=C,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=x.DEFAULT_ATTR_DATA.clone(),this.savedCharset=T.DEFAULT_CHARSET,this.markers=[],this._nullCell=R.CellData.fromCharData([0,A.NULL_CELL_CHAR,A.NULL_CELL_WIDTH,A.NULL_CELL_CODE]),this._whitespaceCell=R.CellData.fromCharData([0,A.WHITESPACE_CELL_CHAR,A.WHITESPACE_CELL_WIDTH,A.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new w.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new y.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(g){return g?(this._nullCell.fg=g.fg,this._nullCell.bg=g.bg,this._nullCell.extended=g.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new k.ExtendedAttrs),this._nullCell}getWhitespaceCell(g){return g?(this._whitespaceCell.fg=g.fg,this._whitespaceCell.bg=g.bg,this._whitespaceCell.extended=g.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new k.ExtendedAttrs),this._whitespaceCell}getBlankLine(g,m){return new x.BufferLine(this._bufferService.cols,this.getNullCell(g),m)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let g=this.ybase+this.y-this.ydisp;return g>=0&&g<this._rows}_getCorrectBufferLength(g){if(!this._hasScrollback)return g;let C=g+this._optionsService.rawOptions.scrollback;return C>m.MAX_BUFFER_SIZE?m.MAX_BUFFER_SIZE:C}fillViewportRows(g){if(0===this.lines.length){void 0===g&&(g=x.DEFAULT_ATTR_DATA);let m=this._rows;for(;m--;)this.lines.push(this.getBlankLine(g))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new y.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(g,m){let C=this.getNullCell(x.DEFAULT_ATTR_DATA),y=0,w=this._getCorrectBufferLength(m);if(w>this.lines.maxLength&&(this.lines.maxLength=w),this.lines.length>0){if(this._cols<g)for(let m=0;m<this.lines.length;m++)y+=+this.lines.get(m).resize(g,C);let k=0;if(this._rows<m)for(let y=this._rows;y<m;y++)this.lines.length<m+this.ybase&&(this._optionsService.rawOptions.windowsMode||void 0!==this._optionsService.rawOptions.windowsPty.backend||void 0!==this._optionsService.rawOptions.windowsPty.buildNumber?this.lines.push(new x.BufferLine(g,C)):this.ybase>0&&this.lines.length<=this.ybase+this.y+k+1?(this.ybase--,k++,this.ydisp>0&&this.ydisp--):this.lines.push(new x.BufferLine(g,C)));else for(let g=this._rows;g>m;g--)this.lines.length>m+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(w<this.lines.maxLength){let g=this.lines.length-w;g>0&&(this.lines.trimStart(g),this.ybase=Math.max(this.ybase-g,0),this.ydisp=Math.max(this.ydisp-g,0),this.savedY=Math.max(this.savedY-g,0)),this.lines.maxLength=w}this.x=Math.min(this.x,g-1),this.y=Math.min(this.y,m-1),k&&(this.y+=k),this.savedX=Math.min(this.savedX,g-1),this.scrollTop=0}if(this.scrollBottom=m-1,this._isReflowEnabled&&(this._reflow(g,m),this._cols>g))for(let m=0;m<this.lines.length;m++)y+=+this.lines.get(m).resize(g,C);this._cols=g,this._rows=m,this._memoryCleanupQueue.clear(),y>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let g=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,g=!1);let m=0;for(;this._memoryCleanupPosition<this.lines.length;)if((m+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory())>100)return!0;return g}get _isReflowEnabled(){let g=this._optionsService.rawOptions.windowsPty;return g&&g.buildNumber?this._hasScrollback&&"conpty"===g.backend&&g.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(g,m){this._cols!==g&&(g>this._cols?this._reflowLarger(g,m):this._reflowSmaller(g,m))}_reflowLarger(g,m){let C=(0,D.reflowLargerGetLinesToRemove)(this.lines,this._cols,g,this.ybase+this.y,this.getNullCell(x.DEFAULT_ATTR_DATA));if(C.length>0){let y=(0,D.reflowLargerCreateNewLayout)(this.lines,C);(0,D.reflowLargerApplyNewLayout)(this.lines,y.layout),this._reflowLargerAdjustViewport(g,m,y.countRemoved)}}_reflowLargerAdjustViewport(g,m,C){let y=this.getNullCell(x.DEFAULT_ATTR_DATA),w=C;for(;w-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<m&&this.lines.push(new x.BufferLine(g,y))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-C,0)}_reflowSmaller(g,m){let C=this.getNullCell(x.DEFAULT_ATTR_DATA),y=[],w=0;for(let k=this.lines.length-1;k>=0;k--){let R,A=this.lines.get(k);if(!A||!A.isWrapped&&A.getTrimmedLength()<=g)continue;let B=[A];for(;A.isWrapped&&k>0;)A=this.lines.get(--k),B.unshift(A);let T=this.ybase+this.y;if(T>=k&&T<k+B.length)continue;let M=B[B.length-1].getTrimmedLength(),O=(0,D.reflowSmallerGetNewLineLengths)(B,this._cols,g),I=O.length-B.length;R=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+I):Math.max(0,this.lines.length-this.lines.maxLength+I);let H=[];for(let g=0;g<I;g++){let g=this.getBlankLine(x.DEFAULT_ATTR_DATA,!0);H.push(g)}H.length>0&&(y.push({start:k+B.length+w,newLines:H}),w+=H.length),B.push(...H);let F=O.length-1,W=O[F];0===W&&(W=O[--F]);let U=B.length-I-1,N=M;for(;U>=0;){let g=Math.min(N,W);if(void 0===B[F])break;if(B[F].copyCellsFrom(B[U],N-g,W-g,g,!0),0==(W-=g)&&(W=O[--F]),0==(N-=g)){U--;let g=Math.max(U,0);N=(0,D.getWrappedLineTrimmedLength)(B,g,this._cols)}}for(let m=0;m<B.length;m++)O[m]<g&&B[m].setCell(O[m],C);let $=I-R;for(;$-- >0;)0===this.ybase?this.y<m-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+w)-m&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+I,this.ybase+m-1)}if(y.length>0){let g=[],m=[];for(let g=0;g<this.lines.length;g++)m.push(this.lines.get(g));let C=this.lines.length,k=C-1,x=0,D=y[0];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+w);let R=0;for(let A=Math.min(this.lines.maxLength-1,C+w-1);A>=0;A--)if(D&&D.start>k+R){for(let g=D.newLines.length-1;g>=0;g--)this.lines.set(A--,D.newLines[g]);A++,g.push({index:k+1,amount:D.newLines.length}),R+=D.newLines.length,D=y[++x]}else this.lines.set(A,m[k--]);let A=0;for(let m=g.length-1;m>=0;m--)g[m].index+=A,this.lines.onInsertEmitter.fire(g[m]),A+=g[m].amount;let B=Math.max(0,C+w-this.lines.maxLength);B>0&&this.lines.onTrimEmitter.fire(B)}}translateBufferLineToString(g,m,C=0,y){let w=this.lines.get(g);return w?w.translateToString(m,C,y):""}getWrappedRangeForLine(g){let m=g,C=g;for(;m>0&&this.lines.get(m).isWrapped;)m--;for(;C+1<this.lines.length&&this.lines.get(C+1).isWrapped;)C++;return{first:m,last:C}}setupTabStops(g){for(null!=g?this.tabs[g]||(g=this.prevStop(g)):(this.tabs={},g=0);g<this._cols;g+=this._optionsService.rawOptions.tabStopWidth)this.tabs[g]=!0}prevStop(g){for(null==g&&(g=this.x);!this.tabs[--g]&&g>0;);return g>=this._cols?this._cols-1:g<0?0:g}nextStop(g){for(null==g&&(g=this.x);!this.tabs[++g]&&g<this._cols;);return g>=this._cols?this._cols-1:g<0?0:g}clearMarkers(g){this._isClearing=!0;for(let m=0;m<this.markers.length;m++)this.markers[m].line===g&&(this.markers[m].dispose(),this.markers.splice(m--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let g=0;g<this.markers.length;g++)this.markers[g].dispose(),this.markers.splice(g--,1);this._isClearing=!1}addMarker(g){let m=new B.Marker(g);return this.markers.push(m),m.register(this.lines.onTrim(g=>{m.line-=g,m.line<0&&m.dispose()})),m.register(this.lines.onInsert(g=>{m.line>=g.index&&(m.line+=g.amount)})),m.register(this.lines.onDelete(g=>{m.line>=g.index&&m.line<g.index+g.amount&&m.dispose(),m.line>g.index&&(m.line-=g.amount)})),m.register(m.onDispose(()=>this._removeMarker(m))),m}_removeMarker(g){this._isClearing||this.markers.splice(this.markers.indexOf(g),1)}}},8437:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.BufferLine=m.DEFAULT_ATTR_DATA=void 0;let y=C(3734),w=C(511),k=C(643),x=C(482);m.DEFAULT_ATTR_DATA=Object.freeze(new y.AttributeData);let D=0;let h=class h{constructor(g,m,C=!1){this.isWrapped=C,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*g);let y=m||w.CellData.fromCharData([0,k.NULL_CELL_CHAR,k.NULL_CELL_WIDTH,k.NULL_CELL_CODE]);for(let m=0;m<g;++m)this.setCell(m,y);this.length=g}get(g){let m=this._data[3*g+0],C=2097151&m;return[this._data[3*g+1],2097152&m?this._combined[g]:C?(0,x.stringFromCodePoint)(C):"",m>>22,2097152&m?this._combined[g].charCodeAt(this._combined[g].length-1):C]}set(g,m){this._data[3*g+1]=m[k.CHAR_DATA_ATTR_INDEX],m[k.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[g]=m[1],this._data[3*g+0]=2097152|g|m[k.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*g+0]=m[k.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|m[k.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(g){return this._data[3*g+0]>>22}hasWidth(g){return 12582912&this._data[3*g+0]}getFg(g){return this._data[3*g+1]}getBg(g){return this._data[3*g+2]}hasContent(g){return 4194303&this._data[3*g+0]}getCodePoint(g){let m=this._data[3*g+0];return 2097152&m?this._combined[g].charCodeAt(this._combined[g].length-1):2097151&m}isCombined(g){return 2097152&this._data[3*g+0]}getString(g){let m=this._data[3*g+0];return 2097152&m?this._combined[g]:2097151&m?(0,x.stringFromCodePoint)(2097151&m):""}isProtected(g){return 536870912&this._data[3*g+2]}loadCell(g,m){return D=3*g,m.content=this._data[D+0],m.fg=this._data[D+1],m.bg=this._data[D+2],2097152&m.content&&(m.combinedData=this._combined[g]),268435456&m.bg&&(m.extended=this._extendedAttrs[g]),m}setCell(g,m){2097152&m.content&&(this._combined[g]=m.combinedData),268435456&m.bg&&(this._extendedAttrs[g]=m.extended),this._data[3*g+0]=m.content,this._data[3*g+1]=m.fg,this._data[3*g+2]=m.bg}setCellFromCodePoint(g,m,C,y,w,k){268435456&w&&(this._extendedAttrs[g]=k),this._data[3*g+0]=m|C<<22,this._data[3*g+1]=y,this._data[3*g+2]=w}addCodepointToCell(g,m){let C=this._data[3*g+0];2097152&C?this._combined[g]+=(0,x.stringFromCodePoint)(m):(2097151&C?(this._combined[g]=(0,x.stringFromCodePoint)(2097151&C)+(0,x.stringFromCodePoint)(m),C&=-2097152,C|=2097152):C=4194304|m,this._data[3*g+0]=C)}insertCells(g,m,C,k){if((g%=this.length)&&2===this.getWidth(g-1)&&this.setCellFromCodePoint(g-1,0,1,(null==k?void 0:k.fg)||0,(null==k?void 0:k.bg)||0,(null==k?void 0:k.extended)||new y.ExtendedAttrs),m<this.length-g){let y=new w.CellData;for(let C=this.length-g-m-1;C>=0;--C)this.setCell(g+m+C,this.loadCell(g+C,y));for(let y=0;y<m;++y)this.setCell(g+y,C)}else for(let m=g;m<this.length;++m)this.setCell(m,C);2===this.getWidth(this.length-1)&&this.setCellFromCodePoint(this.length-1,0,1,(null==k?void 0:k.fg)||0,(null==k?void 0:k.bg)||0,(null==k?void 0:k.extended)||new y.ExtendedAttrs)}deleteCells(g,m,C,k){if(g%=this.length,m<this.length-g){let y=new w.CellData;for(let C=0;C<this.length-g-m;++C)this.setCell(g+C,this.loadCell(g+m+C,y));for(let g=this.length-m;g<this.length;++g)this.setCell(g,C)}else for(let m=g;m<this.length;++m)this.setCell(m,C);g&&2===this.getWidth(g-1)&&this.setCellFromCodePoint(g-1,0,1,(null==k?void 0:k.fg)||0,(null==k?void 0:k.bg)||0,(null==k?void 0:k.extended)||new y.ExtendedAttrs),0!==this.getWidth(g)||this.hasContent(g)||this.setCellFromCodePoint(g,0,1,(null==k?void 0:k.fg)||0,(null==k?void 0:k.bg)||0,(null==k?void 0:k.extended)||new y.ExtendedAttrs)}replaceCells(g,m,C,w,k=!1){if(k)for(g&&2===this.getWidth(g-1)&&!this.isProtected(g-1)&&this.setCellFromCodePoint(g-1,0,1,(null==w?void 0:w.fg)||0,(null==w?void 0:w.bg)||0,(null==w?void 0:w.extended)||new y.ExtendedAttrs),m<this.length&&2===this.getWidth(m-1)&&!this.isProtected(m)&&this.setCellFromCodePoint(m,0,1,(null==w?void 0:w.fg)||0,(null==w?void 0:w.bg)||0,(null==w?void 0:w.extended)||new y.ExtendedAttrs);g<m&&g<this.length;)this.isProtected(g)||this.setCell(g,C),g++;else for(g&&2===this.getWidth(g-1)&&this.setCellFromCodePoint(g-1,0,1,(null==w?void 0:w.fg)||0,(null==w?void 0:w.bg)||0,(null==w?void 0:w.extended)||new y.ExtendedAttrs),m<this.length&&2===this.getWidth(m-1)&&this.setCellFromCodePoint(m,0,1,(null==w?void 0:w.fg)||0,(null==w?void 0:w.bg)||0,(null==w?void 0:w.extended)||new y.ExtendedAttrs);g<m&&g<this.length;)this.setCell(g++,C)}resize(g,m){if(g===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let C=3*g;if(g>this.length){if(this._data.buffer.byteLength>=4*C)this._data=new Uint32Array(this._data.buffer,0,C);else{let g=new Uint32Array(C);g.set(this._data),this._data=g}for(let C=this.length;C<g;++C)this.setCell(C,m)}else{this._data=this._data.subarray(0,C);let m=Object.keys(this._combined);for(let C=0;C<m.length;C++){let y=parseInt(m[C],10);y>=g&&delete this._combined[y]}let y=Object.keys(this._extendedAttrs);for(let m=0;m<y.length;m++){let C=parseInt(y[m],10);C>=g&&delete this._extendedAttrs[C]}}return this.length=g,4*C*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let g=new Uint32Array(this._data.length);return g.set(this._data),this._data=g,1}return 0}fill(g,m=!1){if(m)for(let m=0;m<this.length;++m)this.isProtected(m)||this.setCell(m,g);else{this._combined={},this._extendedAttrs={};for(let m=0;m<this.length;++m)this.setCell(m,g)}}copyFrom(g){for(let m in this.length!==g.length?this._data=new Uint32Array(g._data):this._data.set(g._data),this.length=g.length,this._combined={},g._combined)this._combined[m]=g._combined[m];for(let m in this._extendedAttrs={},g._extendedAttrs)this._extendedAttrs[m]=g._extendedAttrs[m];this.isWrapped=g.isWrapped}clone(){let g=new h(0);for(let m in g._data=new Uint32Array(this._data),g.length=this.length,this._combined)g._combined[m]=this._combined[m];for(let m in this._extendedAttrs)g._extendedAttrs[m]=this._extendedAttrs[m];return g.isWrapped=this.isWrapped,g}getTrimmedLength(){for(let g=this.length-1;g>=0;--g)if(4194303&this._data[3*g+0])return g+(this._data[3*g+0]>>22);return 0}getNoBgTrimmedLength(){for(let g=this.length-1;g>=0;--g)if(4194303&this._data[3*g+0]||50331648&this._data[3*g+2])return g+(this._data[3*g+0]>>22);return 0}copyCellsFrom(g,m,C,y,w){let k=g._data;if(w)for(let w=y-1;w>=0;w--){for(let g=0;g<3;g++)this._data[3*(C+w)+g]=k[3*(m+w)+g];268435456&k[3*(m+w)+2]&&(this._extendedAttrs[C+w]=g._extendedAttrs[m+w])}else for(let w=0;w<y;w++){for(let g=0;g<3;g++)this._data[3*(C+w)+g]=k[3*(m+w)+g];268435456&k[3*(m+w)+2]&&(this._extendedAttrs[C+w]=g._extendedAttrs[m+w])}let x=Object.keys(g._combined);for(let y=0;y<x.length;y++){let w=parseInt(x[y],10);w>=m&&(this._combined[w-m+C]=g._combined[w])}}translateToString(g=!1,m=0,C=this.length){g&&(C=Math.min(C,this.getTrimmedLength()));let y="";for(;m<C;){let g=this._data[3*m+0],C=2097151&g;y+=2097152&g?this._combined[m]:C?(0,x.stringFromCodePoint)(C):k.WHITESPACE_CELL_CHAR,m+=g>>22||1}return y}};m.BufferLine=h},4841:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.getRangeLength=void 0,m.getRangeLength=function(g,m){if(g.start.y>g.end.y)throw Error(`Buffer range end (${g.end.x}, ${g.end.y}) cannot be before start (${g.start.x}, ${g.start.y})`);return m*(g.end.y-g.start.y)+(g.end.x-g.start.x+1)}},4634:(g,m)=>{function i(g,m,C){if(m===g.length-1)return g[m].getTrimmedLength();let y=!g[m].hasContent(C-1)&&1===g[m].getWidth(C-1),w=2===g[m+1].getWidth(0);return y&&w?C-1:C}Object.defineProperty(m,"__esModule",{value:!0}),m.getWrappedLineTrimmedLength=m.reflowSmallerGetNewLineLengths=m.reflowLargerApplyNewLayout=m.reflowLargerCreateNewLayout=m.reflowLargerGetLinesToRemove=void 0,m.reflowLargerGetLinesToRemove=function(g,m,C,y,w){let k=[];for(let x=0;x<g.length-1;x++){let D=x,R=g.get(++D);if(!R.isWrapped)continue;let A=[g.get(x)];for(;D<g.length&&R.isWrapped;)A.push(R),R=g.get(++D);if(y>=x&&y<D){x+=A.length-1;continue}let B=0,T=i(A,0,m),M=1,O=0;for(;M<A.length;){let g=i(A,M,m),y=g-O,k=C-T,x=Math.min(y,k);A[B].copyCellsFrom(A[M],O,T,x,!1),(T+=x)===C&&(B++,T=0),(O+=x)===g&&(M++,O=0),0===T&&0!==B&&2===A[B-1].getWidth(C-1)&&(A[B].copyCellsFrom(A[B-1],C-1,T++,1,!1),A[B-1].setCell(C-1,w))}A[B].replaceCells(T,C,w);let I=0;for(let g=A.length-1;g>0&&(g>B||0===A[g].getTrimmedLength());g--)I++;I>0&&(k.push(x+A.length-I),k.push(I)),x+=A.length-1}return k},m.reflowLargerCreateNewLayout=function(g,m){let C=[],y=0,w=m[0],k=0;for(let x=0;x<g.length;x++)if(w===x){let C=m[++y];g.onDeleteEmitter.fire({index:x-k,amount:C}),x+=C-1,k+=C,w=m[++y]}else C.push(x);return{layout:C,countRemoved:k}},m.reflowLargerApplyNewLayout=function(g,m){let C=[];for(let y=0;y<m.length;y++)C.push(g.get(m[y]));for(let m=0;m<C.length;m++)g.set(m,C[m]);g.length=m.length},m.reflowSmallerGetNewLineLengths=function(g,m,C){let y=[],w=g.map((C,y)=>i(g,y,m)).reduce((g,m)=>g+m),k=0,x=0,D=0;for(;D<w;){if(w-D<C){y.push(w-D);break}k+=C;let R=i(g,x,m);k>R&&(k-=R,x++);let A=2===g[x].getWidth(k-1);A&&k--;let B=A?C-1:C;y.push(B),D+=B}return y},m.getWrappedLineTrimmedLength=i},5295:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.BufferSet=void 0;let y=C(8460),w=C(844),k=C(9092);let o=class o extends w.Disposable{constructor(g,m){super(),this._optionsService=g,this._bufferService=m,this._onBufferActivate=this.register(new y.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new k.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new k.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(g){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(g),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(g,m){this._normal.resize(g,m),this._alt.resize(g,m),this.setupTabStops(g)}setupTabStops(g){this._normal.setupTabStops(g),this._alt.setupTabStops(g)}};m.BufferSet=o},511:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.CellData=void 0;let y=C(482),w=C(643),k=C(3734);let o=class o extends k.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new k.ExtendedAttrs,this.combinedData=""}static fromCharData(g){let m=new o;return m.setFromCharData(g),m}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,y.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(g){this.fg=g[w.CHAR_DATA_ATTR_INDEX],this.bg=0;let m=!1;if(g[w.CHAR_DATA_CHAR_INDEX].length>2)m=!0;else if(2===g[w.CHAR_DATA_CHAR_INDEX].length){let C=g[w.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=C&&C<=56319){let y=g[w.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=y&&y<=57343?this.content=1024*(C-55296)+y-56320+65536|g[w.CHAR_DATA_WIDTH_INDEX]<<22:m=!0}else m=!0}else this.content=g[w.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|g[w.CHAR_DATA_WIDTH_INDEX]<<22;m&&(this.combinedData=g[w.CHAR_DATA_CHAR_INDEX],this.content=2097152|g[w.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};m.CellData=o},643:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.WHITESPACE_CELL_CODE=m.WHITESPACE_CELL_WIDTH=m.WHITESPACE_CELL_CHAR=m.NULL_CELL_CODE=m.NULL_CELL_WIDTH=m.NULL_CELL_CHAR=m.CHAR_DATA_CODE_INDEX=m.CHAR_DATA_WIDTH_INDEX=m.CHAR_DATA_CHAR_INDEX=m.CHAR_DATA_ATTR_INDEX=m.DEFAULT_EXT=m.DEFAULT_ATTR=m.DEFAULT_COLOR=void 0,m.DEFAULT_COLOR=0,m.DEFAULT_ATTR=256|m.DEFAULT_COLOR<<9,m.DEFAULT_EXT=0,m.CHAR_DATA_ATTR_INDEX=0,m.CHAR_DATA_CHAR_INDEX=1,m.CHAR_DATA_WIDTH_INDEX=2,m.CHAR_DATA_CODE_INDEX=3,m.NULL_CELL_CHAR="",m.NULL_CELL_WIDTH=1,m.NULL_CELL_CODE=0,m.WHITESPACE_CELL_CHAR=" ",m.WHITESPACE_CELL_WIDTH=1,m.WHITESPACE_CELL_CODE=32},4863:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.Marker=void 0;let y=C(8460),w=C(844);let n=class n{get id(){return this._id}constructor(g){this.line=g,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new y.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,w.disposeArray)(this._disposables),this._disposables.length=0)}register(g){return this._disposables.push(g),g}};m.Marker=n,n._nextId=1},7116:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.DEFAULT_CHARSET=m.CHARSETS=void 0,m.CHARSETS={},m.DEFAULT_CHARSET=m.CHARSETS.B,m.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"\xb0",g:"\xb1",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"\xa3","~":"\xb7"},m.CHARSETS.A={"#":"\xa3"},m.CHARSETS.B=void 0,m.CHARSETS[4]={"#":"\xa3","@":"\xbe","[":"ij","\\":"\xbd","]":"|","{":"\xa8","|":"f","}":"\xbc","~":"\xb4"},m.CHARSETS.C=m.CHARSETS[5]={"[":"\xc4","\\":"\xd6","]":"\xc5","^":"\xdc","`":"\xe9","{":"\xe4","|":"\xf6","}":"\xe5","~":"\xfc"},m.CHARSETS.R={"#":"\xa3","@":"\xe0","[":"\xb0","\\":"\xe7","]":"\xa7","{":"\xe9","|":"\xf9","}":"\xe8","~":"\xa8"},m.CHARSETS.Q={"@":"\xe0","[":"\xe2","\\":"\xe7","]":"\xea","^":"\xee","`":"\xf4","{":"\xe9","|":"\xf9","}":"\xe8","~":"\xfb"},m.CHARSETS.K={"@":"\xa7","[":"\xc4","\\":"\xd6","]":"\xdc","{":"\xe4","|":"\xf6","}":"\xfc","~":"\xdf"},m.CHARSETS.Y={"#":"\xa3","@":"\xa7","[":"\xb0","\\":"\xe7","]":"\xe9","`":"\xf9","{":"\xe0","|":"\xf2","}":"\xe8","~":"\xec"},m.CHARSETS.E=m.CHARSETS[6]={"@":"\xc4","[":"\xc6","\\":"\xd8","]":"\xc5","^":"\xdc","`":"\xe4","{":"\xe6","|":"\xf8","}":"\xe5","~":"\xfc"},m.CHARSETS.Z={"#":"\xa3","@":"\xa7","[":"\xa1","\\":"\xd1","]":"\xbf","{":"\xb0","|":"\xf1","}":"\xe7"},m.CHARSETS.H=m.CHARSETS[7]={"@":"\xc9","[":"\xc4","\\":"\xd6","]":"\xc5","^":"\xdc","`":"\xe9","{":"\xe4","|":"\xf6","}":"\xe5","~":"\xfc"},m.CHARSETS["="]={"#":"\xf9","@":"\xe0","[":"\xe9","\\":"\xe7","]":"\xea","^":"\xee",_:"\xe8","`":"\xf4","{":"\xe4","|":"\xf6","}":"\xfc","~":"\xfb"}},2584:(g,m)=>{var C,y,w,k,x;Object.defineProperty(m,"__esModule",{value:!0}),m.C1_ESCAPED=m.C1=m.C0=void 0,(k=C||(m.C0=C={})).NUL="\x00",k.SOH="\x01",k.STX="\x02",k.ETX="\x03",k.EOT="\x04",k.ENQ="\x05",k.ACK="\x06",k.BEL="\x07",k.BS="\b",k.HT="	",k.LF="\n",k.VT="\v",k.FF="\f",k.CR="\r",k.SO="\x0e",k.SI="\x0f",k.DLE="\x10",k.DC1="\x11",k.DC2="\x12",k.DC3="\x13",k.DC4="\x14",k.NAK="\x15",k.SYN="\x16",k.ETB="\x17",k.CAN="\x18",k.EM="\x19",k.SUB="\x1a",k.ESC="\x1b",k.FS="\x1c",k.GS="\x1d",k.RS="\x1e",k.US="\x1f",k.SP=" ",k.DEL="\x7f",(x=y||(m.C1=y={})).PAD="\x80",x.HOP="\x81",x.BPH="\x82",x.NBH="\x83",x.IND="\x84",x.NEL="\x85",x.SSA="\x86",x.ESA="\x87",x.HTS="\x88",x.HTJ="\x89",x.VTS="\x8a",x.PLD="\x8b",x.PLU="\x8c",x.RI="\x8d",x.SS2="\x8e",x.SS3="\x8f",x.DCS="\x90",x.PU1="\x91",x.PU2="\x92",x.STS="\x93",x.CCH="\x94",x.MW="\x95",x.SPA="\x96",x.EPA="\x97",x.SOS="\x98",x.SGCI="\x99",x.SCI="\x9a",x.CSI="\x9b",x.ST="\x9c",x.OSC="\x9d",x.PM="\x9e",x.APC="\x9f",(w||(m.C1_ESCAPED=w={})).ST=`${C.ESC}\\`},7399:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.evaluateKeyboardEvent=void 0;let y=C(2584),w={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};m.evaluateKeyboardEvent=function(g,m,C,k){let x={type:0,cancel:!1,key:void 0},D=(g.shiftKey?1:0)|(g.altKey?2:0)|(g.ctrlKey?4:0)|(g.metaKey?8:0);switch(g.keyCode){case 0:"UIKeyInputUpArrow"===g.key?x.key=m?y.C0.ESC+"OA":y.C0.ESC+"[A":"UIKeyInputLeftArrow"===g.key?x.key=m?y.C0.ESC+"OD":y.C0.ESC+"[D":"UIKeyInputRightArrow"===g.key?x.key=m?y.C0.ESC+"OC":y.C0.ESC+"[C":"UIKeyInputDownArrow"===g.key&&(x.key=m?y.C0.ESC+"OB":y.C0.ESC+"[B");break;case 8:if(g.altKey){x.key=y.C0.ESC+y.C0.DEL;break}x.key=y.C0.DEL;break;case 9:if(g.shiftKey){x.key=y.C0.ESC+"[Z";break}x.key=y.C0.HT,x.cancel=!0;break;case 13:x.key=g.altKey?y.C0.ESC+y.C0.CR:y.C0.CR,x.cancel=!0;break;case 27:x.key=y.C0.ESC,g.altKey&&(x.key=y.C0.ESC+y.C0.ESC),x.cancel=!0;break;case 37:if(g.metaKey)break;D?(x.key=y.C0.ESC+"[1;"+(D+1)+"D",x.key===y.C0.ESC+"[1;3D"&&(x.key=y.C0.ESC+(C?"b":"[1;5D"))):x.key=m?y.C0.ESC+"OD":y.C0.ESC+"[D";break;case 39:if(g.metaKey)break;D?(x.key=y.C0.ESC+"[1;"+(D+1)+"C",x.key===y.C0.ESC+"[1;3C"&&(x.key=y.C0.ESC+(C?"f":"[1;5C"))):x.key=m?y.C0.ESC+"OC":y.C0.ESC+"[C";break;case 38:if(g.metaKey)break;D?(x.key=y.C0.ESC+"[1;"+(D+1)+"A",C||x.key!==y.C0.ESC+"[1;3A"||(x.key=y.C0.ESC+"[1;5A")):x.key=m?y.C0.ESC+"OA":y.C0.ESC+"[A";break;case 40:if(g.metaKey)break;D?(x.key=y.C0.ESC+"[1;"+(D+1)+"B",C||x.key!==y.C0.ESC+"[1;3B"||(x.key=y.C0.ESC+"[1;5B")):x.key=m?y.C0.ESC+"OB":y.C0.ESC+"[B";break;case 45:g.shiftKey||g.ctrlKey||(x.key=y.C0.ESC+"[2~");break;case 46:x.key=D?y.C0.ESC+"[3;"+(D+1)+"~":y.C0.ESC+"[3~";break;case 36:x.key=D?y.C0.ESC+"[1;"+(D+1)+"H":m?y.C0.ESC+"OH":y.C0.ESC+"[H";break;case 35:x.key=D?y.C0.ESC+"[1;"+(D+1)+"F":m?y.C0.ESC+"OF":y.C0.ESC+"[F";break;case 33:g.shiftKey?x.type=2:g.ctrlKey?x.key=y.C0.ESC+"[5;"+(D+1)+"~":x.key=y.C0.ESC+"[5~";break;case 34:g.shiftKey?x.type=3:g.ctrlKey?x.key=y.C0.ESC+"[6;"+(D+1)+"~":x.key=y.C0.ESC+"[6~";break;case 112:x.key=D?y.C0.ESC+"[1;"+(D+1)+"P":y.C0.ESC+"OP";break;case 113:x.key=D?y.C0.ESC+"[1;"+(D+1)+"Q":y.C0.ESC+"OQ";break;case 114:x.key=D?y.C0.ESC+"[1;"+(D+1)+"R":y.C0.ESC+"OR";break;case 115:x.key=D?y.C0.ESC+"[1;"+(D+1)+"S":y.C0.ESC+"OS";break;case 116:x.key=D?y.C0.ESC+"[15;"+(D+1)+"~":y.C0.ESC+"[15~";break;case 117:x.key=D?y.C0.ESC+"[17;"+(D+1)+"~":y.C0.ESC+"[17~";break;case 118:x.key=D?y.C0.ESC+"[18;"+(D+1)+"~":y.C0.ESC+"[18~";break;case 119:x.key=D?y.C0.ESC+"[19;"+(D+1)+"~":y.C0.ESC+"[19~";break;case 120:x.key=D?y.C0.ESC+"[20;"+(D+1)+"~":y.C0.ESC+"[20~";break;case 121:x.key=D?y.C0.ESC+"[21;"+(D+1)+"~":y.C0.ESC+"[21~";break;case 122:x.key=D?y.C0.ESC+"[23;"+(D+1)+"~":y.C0.ESC+"[23~";break;case 123:x.key=D?y.C0.ESC+"[24;"+(D+1)+"~":y.C0.ESC+"[24~";break;default:if(!g.ctrlKey||g.shiftKey||g.altKey||g.metaKey){if(C&&!k||!g.altKey||g.metaKey)!C||g.altKey||g.ctrlKey||g.shiftKey||!g.metaKey?!g.key||g.ctrlKey||g.altKey||g.metaKey||!(g.keyCode>=48)||1!==g.key.length?g.key&&g.ctrlKey&&("_"===g.key&&(x.key=y.C0.US),"@"===g.key&&(x.key=y.C0.NUL)):x.key=g.key:65===g.keyCode&&(x.type=1);else{let m=w[g.keyCode],C=null==m?void 0:m[g.shiftKey?1:0];if(C)x.key=y.C0.ESC+C;else if(g.keyCode>=65&&g.keyCode<=90){let m=g.ctrlKey?g.keyCode-64:g.keyCode+32,C=String.fromCharCode(m);g.shiftKey&&(C=C.toUpperCase()),x.key=y.C0.ESC+C}else if(32===g.keyCode)x.key=y.C0.ESC+(g.ctrlKey?y.C0.NUL:" ");else if("Dead"===g.key&&g.code.startsWith("Key")){let m=g.code.slice(3,4);g.shiftKey||(m=m.toLowerCase()),x.key=y.C0.ESC+m,x.cancel=!0}}}else g.keyCode>=65&&g.keyCode<=90?x.key=String.fromCharCode(g.keyCode-64):32===g.keyCode?x.key=y.C0.NUL:g.keyCode>=51&&g.keyCode<=55?x.key=String.fromCharCode(g.keyCode-51+27):56===g.keyCode?x.key=y.C0.DEL:219===g.keyCode?x.key=y.C0.ESC:220===g.keyCode?x.key=y.C0.FS:221===g.keyCode&&(x.key=y.C0.GS)}return x}},482:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.Utf8ToUtf32=m.StringToUtf32=m.utf32ToString=m.stringFromCodePoint=void 0,m.stringFromCodePoint=function(g){return g>65535?String.fromCharCode(55296+((g-=65536)>>10))+String.fromCharCode(g%1024+56320):String.fromCharCode(g)},m.utf32ToString=function(g,m=0,C=g.length){let y="";for(let w=m;w<C;++w){let m=g[w];m>65535?(m-=65536,y+=String.fromCharCode(55296+(m>>10))+String.fromCharCode(m%1024+56320)):y+=String.fromCharCode(m)}return y},m.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(g,m){let C=g.length;if(!C)return 0;let y=0,w=0;if(this._interim){let C=g.charCodeAt(w++);56320<=C&&C<=57343?m[y++]=1024*(this._interim-55296)+C-56320+65536:(m[y++]=this._interim,m[y++]=C),this._interim=0}for(let k=w;k<C;++k){let w=g.charCodeAt(k);if(55296<=w&&w<=56319){if(++k>=C)return this._interim=w,y;let x=g.charCodeAt(k);56320<=x&&x<=57343?m[y++]=1024*(w-55296)+x-56320+65536:(m[y++]=w,m[y++]=x)}else 65279!==w&&(m[y++]=w)}return y}},m.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(g,m){let C=g.length;if(!C)return 0;let y,w,k,x,D=0,R=0,A=0;if(this.interim[0]){let y=!1,w=this.interim[0];w&=192==(224&w)?31:224==(240&w)?15:7;let k,x=0;for(;(k=63&this.interim[++x])&&x<4;)w<<=6,w|=k;let R=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,B=R-x;for(;A<B;){if(A>=C)return 0;if(128!=(192&(k=g[A++]))){A--,y=!0;break}this.interim[x++]=k,w<<=6,w|=63&k}y||(2===R?w<128?A--:m[D++]=w:3===R?w<2048||w>=55296&&w<=57343||65279===w||(m[D++]=w):w<65536||w>1114111||(m[D++]=w)),this.interim.fill(0)}let B=C-4,T=A;for(;T<C;){for(;!(!(T<B)||128&(y=g[T])||128&(w=g[T+1])||128&(k=g[T+2])||128&(x=g[T+3]));)m[D++]=y,m[D++]=w,m[D++]=k,m[D++]=x,T+=4;if((y=g[T++])<128)m[D++]=y;else if(192==(224&y)){if(T>=C)return this.interim[0]=y,D;if(128!=(192&(w=g[T++]))||(R=(31&y)<<6|63&w)<128){T--;continue}m[D++]=R}else if(224==(240&y)){if(T>=C)return this.interim[0]=y,D;if(128!=(192&(w=g[T++]))){T--;continue}if(T>=C)return this.interim[0]=y,this.interim[1]=w,D;if(128!=(192&(k=g[T++]))){T--;continue}if((R=(15&y)<<12|(63&w)<<6|63&k)<2048||R>=55296&&R<=57343||65279===R)continue;m[D++]=R}else if(240==(248&y)){if(T>=C)return this.interim[0]=y,D;if(128!=(192&(w=g[T++]))){T--;continue}if(T>=C)return this.interim[0]=y,this.interim[1]=w,D;if(128!=(192&(k=g[T++]))){T--;continue}if(T>=C)return this.interim[0]=y,this.interim[1]=w,this.interim[2]=k,D;if(128!=(192&(x=g[T++]))){T--;continue}if((R=(7&y)<<18|(63&w)<<12|(63&k)<<6|63&x)<65536||R>1114111)continue;m[D++]=R}}return D}}},225:(g,m)=>{let C;Object.defineProperty(m,"__esModule",{value:!0}),m.UnicodeV6=void 0;let y=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],w=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];m.UnicodeV6=class{constructor(){if(this.version="6",!C){(C=new Uint8Array(65536)).fill(1),C[0]=0,C.fill(0,1,32),C.fill(0,127,160),C.fill(2,4352,4448),C[9001]=2,C[9002]=2,C.fill(2,11904,42192),C[12351]=1,C.fill(2,44032,55204),C.fill(2,63744,64256),C.fill(2,65040,65050),C.fill(2,65072,65136),C.fill(2,65280,65377),C.fill(2,65504,65511);for(let g=0;g<y.length;++g)C.fill(0,y[g][0],y[g][1]+1)}}wcwidth(g){return g<32?0:g<127?1:g<65536?C[g]:!function(g,m){let C,y=0,w=m.length-1;if(g<m[0][0]||g>m[w][1])return!1;for(;w>=y;)if(g>m[C=y+w>>1][1])y=C+1;else{if(!(g<m[C][0]))return!0;w=C-1}return!1}(g,w)?g>=131072&&g<=196605||g>=196608&&g<=262141?2:1:0}}},5981:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.WriteBuffer=void 0;let y=C(8460),w=C(844);let n=class n extends w.Disposable{constructor(g){super(),this._action=g,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new y.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(g,m){let C;if(void 0!==m&&this._syncCalls>m)return void(this._syncCalls=0);if(this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(void 0),this._syncCalls++,!this._isSyncWriting){for(this._isSyncWriting=!0;C=this._writeBuffer.shift();){this._action(C);let g=this._callbacks.shift();g&&g()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}}write(g,m){if(this._pendingData>5e7)throw Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(m),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(m)}_innerWrite(g=0,m=!0){let C=g||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let g=this._writeBuffer[this._bufferOffset],y=this._action(g,m);if(y){let e=g=>Date.now()-C>=12?setTimeout(()=>this._innerWrite(0,g)):this._innerWrite(C,g);return void y.catch(g=>(queueMicrotask(()=>{throw g}),Promise.resolve(!1))).then(e)}let w=this._callbacks[this._bufferOffset];if(w&&w(),this._bufferOffset++,this._pendingData-=g.length,Date.now()-C>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}};m.WriteBuffer=n},5941:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.toRgbString=m.parseColor=void 0;let C=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,y=/^[\da-f]+$/;function r(g,m){let C=g.toString(16),y=C.length<2?"0"+C:C;switch(m){case 4:return C[0];case 8:return y;case 12:return(y+y).slice(0,3);default:return y+y}}m.parseColor=function(g){if(!g)return;let m=g.toLowerCase();if(0===m.indexOf("rgb:")){m=m.slice(4);let g=C.exec(m);if(g){let m=g[1]?15:g[4]?255:g[7]?4095:65535;return[Math.round(parseInt(g[1]||g[4]||g[7]||g[10],16)/m*255),Math.round(parseInt(g[2]||g[5]||g[8]||g[11],16)/m*255),Math.round(parseInt(g[3]||g[6]||g[9]||g[12],16)/m*255)]}}else if(0===m.indexOf("#")&&(m=m.slice(1),y.exec(m)&&[3,6,9,12].includes(m.length))){let g=m.length/3,C=[0,0,0];for(let y=0;y<3;++y){let w=parseInt(m.slice(g*y,g*y+g),16);C[y]=1===g?w<<4:2===g?w:3===g?w>>4:w>>8}return C}},m.toRgbString=function(g,m=16){let[C,y,w]=g;return`rgb:${r(C,m)}/${r(y,m)}/${r(w,m)}`}},5770:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.PAYLOAD_LIMIT=void 0,m.PAYLOAD_LIMIT=1e7},6351:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.DcsHandler=m.DcsParser=void 0;let y=C(482),w=C(8742),k=C(5770),x=[];m.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=x,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=x}registerHandler(g,m){void 0===this._handlers[g]&&(this._handlers[g]=[]);let C=this._handlers[g];return C.push(m),{dispose:()=>{let g=C.indexOf(m);-1!==g&&C.splice(g,1)}}}clearHandler(g){this._handlers[g]&&delete this._handlers[g]}setHandlerFallback(g){this._handlerFb=g}reset(){if(this._active.length)for(let g=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;g>=0;--g)this._active[g].unhook(!1);this._stack.paused=!1,this._active=x,this._ident=0}hook(g,m){if(this.reset(),this._ident=g,this._active=this._handlers[g]||x,this._active.length)for(let g=this._active.length-1;g>=0;g--)this._active[g].hook(m);else this._handlerFb(this._ident,"HOOK",m)}put(g,m,C){if(this._active.length)for(let y=this._active.length-1;y>=0;y--)this._active[y].put(g,m,C);else this._handlerFb(this._ident,"PUT",(0,y.utf32ToString)(g,m,C))}unhook(g,m=!0){if(this._active.length){let C=!1,y=this._active.length-1,w=!1;if(this._stack.paused&&(y=this._stack.loopPosition-1,C=m,w=this._stack.fallThrough,this._stack.paused=!1),!w&&!1===C){for(;y>=0&&!0!==(C=this._active[y].unhook(g));y--)if(C instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=y,this._stack.fallThrough=!1,C;y--}for(;y>=0;y--)if((C=this._active[y].unhook(!1))instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=y,this._stack.fallThrough=!0,C}else this._handlerFb(this._ident,"UNHOOK",g);this._active=x,this._ident=0}};let D=new w.Params;D.addParam(0),m.DcsHandler=class{constructor(g){this._handler=g,this._data="",this._params=D,this._hitLimit=!1}hook(g){this._params=g.length>1||g.params[0]?g.clone():D,this._data="",this._hitLimit=!1}put(g,m,C){this._hitLimit||(this._data+=(0,y.utf32ToString)(g,m,C),this._data.length>k.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(g){let m=!1;if(this._hitLimit)m=!1;else if(g&&(m=this._handler(this._data,this._params))instanceof Promise)return m.then(g=>(this._params=D,this._data="",this._hitLimit=!1,g));return this._params=D,this._data="",this._hitLimit=!1,m}}},2015:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.EscapeSequenceParser=m.VT500_TRANSITION_TABLE=m.TransitionTable=void 0;let y=C(844),w=C(8742),k=C(6242),x=C(6351);let a=class a{constructor(g){this.table=new Uint8Array(g)}setDefault(g,m){this.table.fill(g<<4|m)}add(g,m,C,y){this.table[m<<8|g]=C<<4|y}addMany(g,m,C,y){for(let w=0;w<g.length;w++)this.table[m<<8|g[w]]=C<<4|y}};m.TransitionTable=a,m.VT500_TRANSITION_TABLE=function(){let g;let m=new a(4095),C=Array.apply(null,Array(256)).map((g,m)=>m),i=(g,m)=>C.slice(g,m),y=i(32,127),w=i(0,24);w.push(25),w.push.apply(w,i(28,32));let k=i(0,14);for(g in m.setDefault(1,0),m.addMany(y,0,2,0),k)m.addMany([24,26,153,154],g,3,0),m.addMany(i(128,144),g,3,0),m.addMany(i(144,152),g,3,0),m.add(156,g,0,0),m.add(27,g,11,1),m.add(157,g,4,8),m.addMany([152,158,159],g,0,7),m.add(155,g,11,3),m.add(144,g,11,9);return m.addMany(w,0,3,0),m.addMany(w,1,3,1),m.add(127,1,0,1),m.addMany(w,8,0,8),m.addMany(w,3,3,3),m.add(127,3,0,3),m.addMany(w,4,3,4),m.add(127,4,0,4),m.addMany(w,6,3,6),m.addMany(w,5,3,5),m.add(127,5,0,5),m.addMany(w,2,3,2),m.add(127,2,0,2),m.add(93,1,4,8),m.addMany(y,8,5,8),m.add(127,8,5,8),m.addMany([156,27,24,26,7],8,6,0),m.addMany(i(28,32),8,0,8),m.addMany([88,94,95],1,0,7),m.addMany(y,7,0,7),m.addMany(w,7,0,7),m.add(156,7,0,0),m.add(127,7,0,7),m.add(91,1,11,3),m.addMany(i(64,127),3,7,0),m.addMany(i(48,60),3,8,4),m.addMany([60,61,62,63],3,9,4),m.addMany(i(48,60),4,8,4),m.addMany(i(64,127),4,7,0),m.addMany([60,61,62,63],4,0,6),m.addMany(i(32,64),6,0,6),m.add(127,6,0,6),m.addMany(i(64,127),6,0,0),m.addMany(i(32,48),3,9,5),m.addMany(i(32,48),5,9,5),m.addMany(i(48,64),5,0,6),m.addMany(i(64,127),5,7,0),m.addMany(i(32,48),4,9,5),m.addMany(i(32,48),1,9,2),m.addMany(i(32,48),2,9,2),m.addMany(i(48,127),2,10,0),m.addMany(i(48,80),1,10,0),m.addMany(i(81,88),1,10,0),m.addMany([89,90,92],1,10,0),m.addMany(i(96,127),1,10,0),m.add(80,1,11,9),m.addMany(w,9,0,9),m.add(127,9,0,9),m.addMany(i(28,32),9,0,9),m.addMany(i(32,48),9,9,12),m.addMany(i(48,60),9,8,10),m.addMany([60,61,62,63],9,9,10),m.addMany(w,11,0,11),m.addMany(i(32,128),11,0,11),m.addMany(i(28,32),11,0,11),m.addMany(w,10,0,10),m.add(127,10,0,10),m.addMany(i(28,32),10,0,10),m.addMany(i(48,60),10,8,10),m.addMany([60,61,62,63],10,0,11),m.addMany(i(32,48),10,9,12),m.addMany(w,12,0,12),m.add(127,12,0,12),m.addMany(i(28,32),12,0,12),m.addMany(i(32,48),12,9,12),m.addMany(i(48,64),12,0,11),m.addMany(i(64,127),12,12,13),m.addMany(i(64,127),10,12,13),m.addMany(i(64,127),9,12,13),m.addMany(w,13,13,13),m.addMany(y,13,13,13),m.add(127,13,0,13),m.addMany([27,156,24,26],13,14,0),m.add(160,0,2,0),m.add(160,8,5,8),m.add(160,6,0,6),m.add(160,11,0,11),m.add(160,13,13,13),m}();let c=class c extends y.Disposable{constructor(g=m.VT500_TRANSITION_TABLE){super(),this._transitions=g,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new w.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(g,m,C)=>{},this._executeHandlerFb=g=>{},this._csiHandlerFb=(g,m)=>{},this._escHandlerFb=g=>{},this._errorHandlerFb=g=>g,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,y.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new k.OscParser),this._dcsParser=this.register(new x.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(g,m=[64,126]){let C=0;if(g.prefix){if(g.prefix.length>1)throw Error("only one byte as prefix supported");if((C=g.prefix.charCodeAt(0))&&60>C||C>63)throw Error("prefix must be in range 0x3c .. 0x3f")}if(g.intermediates){if(g.intermediates.length>2)throw Error("only two bytes as intermediates are supported");for(let m=0;m<g.intermediates.length;++m){let y=g.intermediates.charCodeAt(m);if(32>y||y>47)throw Error("intermediate must be in range 0x20 .. 0x2f");C<<=8,C|=y}}if(1!==g.final.length)throw Error("final must be a single byte");let y=g.final.charCodeAt(0);if(m[0]>y||y>m[1])throw Error(`final must be in range ${m[0]} .. ${m[1]}`);return C<<=8,C|=y}identToString(g){let m=[];for(;g;)m.push(String.fromCharCode(255&g)),g>>=8;return m.reverse().join("")}setPrintHandler(g){this._printHandler=g}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(g,m){let C=this._identifier(g,[48,126]);void 0===this._escHandlers[C]&&(this._escHandlers[C]=[]);let y=this._escHandlers[C];return y.push(m),{dispose:()=>{let g=y.indexOf(m);-1!==g&&y.splice(g,1)}}}clearEscHandler(g){this._escHandlers[this._identifier(g,[48,126])]&&delete this._escHandlers[this._identifier(g,[48,126])]}setEscHandlerFallback(g){this._escHandlerFb=g}setExecuteHandler(g,m){this._executeHandlers[g.charCodeAt(0)]=m}clearExecuteHandler(g){this._executeHandlers[g.charCodeAt(0)]&&delete this._executeHandlers[g.charCodeAt(0)]}setExecuteHandlerFallback(g){this._executeHandlerFb=g}registerCsiHandler(g,m){let C=this._identifier(g);void 0===this._csiHandlers[C]&&(this._csiHandlers[C]=[]);let y=this._csiHandlers[C];return y.push(m),{dispose:()=>{let g=y.indexOf(m);-1!==g&&y.splice(g,1)}}}clearCsiHandler(g){this._csiHandlers[this._identifier(g)]&&delete this._csiHandlers[this._identifier(g)]}setCsiHandlerFallback(g){this._csiHandlerFb=g}registerDcsHandler(g,m){return this._dcsParser.registerHandler(this._identifier(g),m)}clearDcsHandler(g){this._dcsParser.clearHandler(this._identifier(g))}setDcsHandlerFallback(g){this._dcsParser.setHandlerFallback(g)}registerOscHandler(g,m){return this._oscParser.registerHandler(g,m)}clearOscHandler(g){this._oscParser.clearHandler(g)}setOscHandlerFallback(g){this._oscParser.setHandlerFallback(g)}setErrorHandler(g){this._errorHandler=g}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(g,m,C,y,w){this._parseStack.state=g,this._parseStack.handlers=m,this._parseStack.handlerPos=C,this._parseStack.transition=y,this._parseStack.chunkPos=w}parse(g,m,C){let y,w=0,k=0,x=0;if(this._parseStack.state){if(2===this._parseStack.state)this._parseStack.state=0,x=this._parseStack.chunkPos+1;else{if(void 0===C||1===this._parseStack.state)throw this._parseStack.state=1,Error("improper continuation due to previous async handler, giving up parsing");let m=this._parseStack.handlers,k=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===C&&k>-1){for(;k>=0&&!0!==(y=m[k](this._params));k--)if(y instanceof Promise)return this._parseStack.handlerPos=k,y}this._parseStack.handlers=[];break;case 4:if(!1===C&&k>-1){for(;k>=0&&!0!==(y=m[k]());k--)if(y instanceof Promise)return this._parseStack.handlerPos=k,y}this._parseStack.handlers=[];break;case 6:if(w=g[this._parseStack.chunkPos],y=this._dcsParser.unhook(24!==w&&26!==w,C))return y;27===w&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(w=g[this._parseStack.chunkPos],y=this._oscParser.end(24!==w&&26!==w,C))return y;27===w&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,x=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}}for(let C=x;C<m;++C){switch(w=g[C],(k=this._transitions.table[this.currentState<<8|(w<160?w:160)])>>4){case 2:for(let y=C+1;;++y)if(y>=m||(w=g[y])<32||w>126&&w<160||++y>=m||(w=g[y])<32||w>126&&w<160||++y>=m||(w=g[y])<32||w>126&&w<160||++y>=m||(w=g[y])<32||w>126&&w<160){this._printHandler(g,C,y),C=y-1;break}break;case 3:this._executeHandlers[w]?this._executeHandlers[w]():this._executeHandlerFb(w),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:C,code:w,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let x=this._csiHandlers[this._collect<<8|w],D=x?x.length-1:-1;for(;D>=0&&!0!==(y=x[D](this._params));D--)if(y instanceof Promise)return this._preserveStack(3,x,D,k,C),y;D<0&&this._csiHandlerFb(this._collect<<8|w,this._params),this.precedingCodepoint=0;break;case 8:do switch(w){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(w-48)}while(++C<m&&(w=g[C])>47&&w<60);C--;break;case 9:this._collect<<=8,this._collect|=w;break;case 10:let R=this._escHandlers[this._collect<<8|w],A=R?R.length-1:-1;for(;A>=0&&!0!==(y=R[A]());A--)if(y instanceof Promise)return this._preserveStack(4,R,A,k,C),y;A<0&&this._escHandlerFb(this._collect<<8|w),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|w,this._params);break;case 13:for(let y=C+1;;++y)if(y>=m||24===(w=g[y])||26===w||27===w||w>127&&w<160){this._dcsParser.put(g,C,y),C=y-1;break}break;case 14:if(y=this._dcsParser.unhook(24!==w&&26!==w))return this._preserveStack(6,[],0,k,C),y;27===w&&(k|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let y=C+1;;y++)if(y>=m||(w=g[y])<32||w>127&&w<160){this._oscParser.put(g,C,y),C=y-1;break}break;case 6:if(y=this._oscParser.end(24!==w&&26!==w))return this._preserveStack(5,[],0,k,C),y;27===w&&(k|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&k}}};m.EscapeSequenceParser=c},6242:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.OscHandler=m.OscParser=void 0;let y=C(5770),w=C(482),k=[];m.OscParser=class{constructor(){this._state=0,this._active=k,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(g,m){void 0===this._handlers[g]&&(this._handlers[g]=[]);let C=this._handlers[g];return C.push(m),{dispose:()=>{let g=C.indexOf(m);-1!==g&&C.splice(g,1)}}}clearHandler(g){this._handlers[g]&&delete this._handlers[g]}setHandlerFallback(g){this._handlerFb=g}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=k}reset(){if(2===this._state)for(let g=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;g>=0;--g)this._active[g].end(!1);this._stack.paused=!1,this._active=k,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||k,this._active.length)for(let g=this._active.length-1;g>=0;g--)this._active[g].start();else this._handlerFb(this._id,"START")}_put(g,m,C){if(this._active.length)for(let y=this._active.length-1;y>=0;y--)this._active[y].put(g,m,C);else this._handlerFb(this._id,"PUT",(0,w.utf32ToString)(g,m,C))}start(){this.reset(),this._state=1}put(g,m,C){if(3!==this._state){if(1===this._state)for(;m<C;){let C=g[m++];if(59===C){this._state=2,this._start();break}if(C<48||57<C)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+C-48}2===this._state&&C-m>0&&this._put(g,m,C)}}end(g,m=!0){if(0!==this._state){if(3!==this._state){if(1===this._state&&this._start(),this._active.length){let C=!1,y=this._active.length-1,w=!1;if(this._stack.paused&&(y=this._stack.loopPosition-1,C=m,w=this._stack.fallThrough,this._stack.paused=!1),!w&&!1===C){for(;y>=0&&!0!==(C=this._active[y].end(g));y--)if(C instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=y,this._stack.fallThrough=!1,C;y--}for(;y>=0;y--)if((C=this._active[y].end(!1))instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=y,this._stack.fallThrough=!0,C}else this._handlerFb(this._id,"END",g)}this._active=k,this._id=-1,this._state=0}}},m.OscHandler=class{constructor(g){this._handler=g,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(g,m,C){this._hitLimit||(this._data+=(0,w.utf32ToString)(g,m,C),this._data.length>y.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(g){let m=!1;if(this._hitLimit)m=!1;else if(g&&(m=this._handler(this._data))instanceof Promise)return m.then(g=>(this._data="",this._hitLimit=!1,g));return this._data="",this._hitLimit=!1,m}}},8742:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.Params=void 0;let s=class s{static fromArray(g){let m=new s;if(!g.length)return m;for(let C=Array.isArray(g[0])?1:0;C<g.length;++C){let y=g[C];if(Array.isArray(y))for(let g=0;g<y.length;++g)m.addSubParam(y[g]);else m.addParam(y)}return m}constructor(g=32,m=32){if(this.maxLength=g,this.maxSubParamsLength=m,m>256)throw Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(g),this.length=0,this._subParams=new Int32Array(m),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(g),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let g=new s(this.maxLength,this.maxSubParamsLength);return g.params.set(this.params),g.length=this.length,g._subParams.set(this._subParams),g._subParamsLength=this._subParamsLength,g._subParamsIdx.set(this._subParamsIdx),g._rejectDigits=this._rejectDigits,g._rejectSubDigits=this._rejectSubDigits,g._digitIsSub=this._digitIsSub,g}toArray(){let g=[];for(let m=0;m<this.length;++m){g.push(this.params[m]);let C=this._subParamsIdx[m]>>8,y=255&this._subParamsIdx[m];y-C>0&&g.push(Array.prototype.slice.call(this._subParams,C,y))}return g}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(g){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(g<-1)throw Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=g>2147483647?2147483647:g}}addSubParam(g){if(this._digitIsSub=!0,this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(g<-1)throw Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=g>2147483647?2147483647:g,this._subParamsIdx[this.length-1]++}}}hasSubParams(g){return(255&this._subParamsIdx[g])-(this._subParamsIdx[g]>>8)>0}getSubParams(g){let m=this._subParamsIdx[g]>>8,C=255&this._subParamsIdx[g];return C-m>0?this._subParams.subarray(m,C):null}getSubParamsAll(){let g={};for(let m=0;m<this.length;++m){let C=this._subParamsIdx[m]>>8,y=255&this._subParamsIdx[m];y-C>0&&(g[m]=this._subParams.slice(C,y))}return g}addDigit(g){let m;if(this._rejectDigits||!(m=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let C=this._digitIsSub?this._subParams:this.params,y=C[m-1];C[m-1]=~y?Math.min(10*y+g,2147483647):g}};m.Params=s},5741:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.AddonManager=void 0,m.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let g=this._addons.length-1;g>=0;g--)this._addons[g].instance.dispose()}loadAddon(g,m){let C={instance:m,dispose:m.dispose,isDisposed:!1};this._addons.push(C),m.dispose=()=>this._wrappedAddonDispose(C),m.activate(g)}_wrappedAddonDispose(g){if(g.isDisposed)return;let m=-1;for(let C=0;C<this._addons.length;C++)if(this._addons[C]===g){m=C;break}if(-1===m)throw Error("Could not dispose an addon that has not been loaded");g.isDisposed=!0,g.dispose.apply(g.instance),this._addons.splice(m,1)}}},8771:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.BufferApiView=void 0;let y=C(3785),w=C(511);m.BufferApiView=class{constructor(g,m){this._buffer=g,this.type=m}init(g){return this._buffer=g,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(g){let m=this._buffer.lines.get(g);if(m)return new y.BufferLineApiView(m)}getNullCell(){return new w.CellData}}},3785:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.BufferLineApiView=void 0;let y=C(511);m.BufferLineApiView=class{constructor(g){this._line=g}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(g,m){if(!(g<0||g>=this._line.length))return m?(this._line.loadCell(g,m),m):this._line.loadCell(g,new y.CellData)}translateToString(g,m,C){return this._line.translateToString(g,m,C)}}},8285:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.BufferNamespaceApi=void 0;let y=C(8771),w=C(8460),k=C(844);let o=class o extends k.Disposable{constructor(g){super(),this._core=g,this._onBufferChange=this.register(new w.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new y.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new y.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}};m.BufferNamespaceApi=o},7975:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.ParserApi=void 0,m.ParserApi=class{constructor(g){this._core=g}registerCsiHandler(g,m){return this._core.registerCsiHandler(g,g=>m(g.toArray()))}addCsiHandler(g,m){return this.registerCsiHandler(g,m)}registerDcsHandler(g,m){return this._core.registerDcsHandler(g,(g,C)=>m(g,C.toArray()))}addDcsHandler(g,m){return this.registerDcsHandler(g,m)}registerEscHandler(g,m){return this._core.registerEscHandler(g,m)}addEscHandler(g,m){return this.registerEscHandler(g,m)}registerOscHandler(g,m){return this._core.registerOscHandler(g,m)}addOscHandler(g,m){return this.registerOscHandler(g,m)}}},7090:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.UnicodeApi=void 0,m.UnicodeApi=class{constructor(g){this._core=g}register(g){this._core.unicodeService.register(g)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(g){this._core.unicodeService.activeVersion=g}}},744:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.BufferService=m.MINIMUM_ROWS=m.MINIMUM_COLS=void 0;let k=C(8460),x=C(844),D=C(5295),R=C(2585);m.MINIMUM_COLS=2,m.MINIMUM_ROWS=1;let A=m.BufferService=class extends x.Disposable{get buffer(){return this.buffers.active}constructor(g){super(),this.isUserScrolling=!1,this._onResize=this.register(new k.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new k.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(g.rawOptions.cols||0,m.MINIMUM_COLS),this.rows=Math.max(g.rawOptions.rows||0,m.MINIMUM_ROWS),this.buffers=this.register(new D.BufferSet(g,this))}resize(g,m){this.cols=g,this.rows=m,this.buffers.resize(g,m),this._onResize.fire({cols:g,rows:m})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(g,m=!1){let C;let y=this.buffer;(C=this._cachedBlankLine)&&C.length===this.cols&&C.getFg(0)===g.fg&&C.getBg(0)===g.bg||(C=y.getBlankLine(g,m),this._cachedBlankLine=C),C.isWrapped=m;let w=y.ybase+y.scrollTop,k=y.ybase+y.scrollBottom;if(0===y.scrollTop){let g=y.lines.isFull;k===y.lines.length-1?g?y.lines.recycle().copyFrom(C):y.lines.push(C.clone()):y.lines.splice(k+1,0,C.clone()),g?this.isUserScrolling&&(y.ydisp=Math.max(y.ydisp-1,0)):(y.ybase++,this.isUserScrolling||y.ydisp++)}else{let g=k-w+1;y.lines.shiftElements(w+1,g-1,-1),y.lines.set(k,C.clone())}this.isUserScrolling||(y.ydisp=y.ybase),this._onScroll.fire(y.ydisp)}scrollLines(g,m,C){let y=this.buffer;if(g<0){if(0===y.ydisp)return;this.isUserScrolling=!0}else g+y.ydisp>=y.ybase&&(this.isUserScrolling=!1);let w=y.ydisp;y.ydisp=Math.max(Math.min(y.ydisp+g,y.ybase),0),w!==y.ydisp&&(m||this._onScroll.fire(y.ydisp))}};m.BufferService=y([w(0,R.IOptionsService)],A)},7994:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.CharsetService=void 0,m.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(g){this.glevel=g,this.charset=this._charsets[g]}setgCharset(g,m){this._charsets[g]=m,this.glevel===g&&(this.charset=m)}}},1753:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.CoreMouseService=void 0;let k=C(2585),x=C(8460),D=C(844),R={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:g=>4!==g.button&&1===g.action&&(g.ctrl=!1,g.alt=!1,g.shift=!1,!0)},VT200:{events:19,restrict:g=>32!==g.action},DRAG:{events:23,restrict:g=>32!==g.action||3!==g.button},ANY:{events:31,restrict:g=>!0}};function c(g,m){let C=(g.ctrl?16:0)|(g.shift?4:0)|(g.alt?8:0);return 4===g.button?(C|=64,C|=g.action):(C|=3&g.button,4&g.button&&(C|=64),8&g.button&&(C|=128),32===g.action?C|=32:0!==g.action||m||(C|=3)),C}let A=String.fromCharCode,B={DEFAULT:g=>{let m=[c(g,!1)+32,g.col+32,g.row+32];return m[0]>255||m[1]>255||m[2]>255?"":`[M${A(m[0])}${A(m[1])}${A(m[2])}`},SGR:g=>{let m=0===g.action&&4!==g.button?"m":"M";return`[<${c(g,!0)};${g.col};${g.row}${m}`},SGR_PIXELS:g=>{let m=0===g.action&&4!==g.button?"m":"M";return`[<${c(g,!0)};${g.x};${g.y}${m}`}},T=m.CoreMouseService=class extends D.Disposable{constructor(g,m){for(let C of(super(),this._bufferService=g,this._coreService=m,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new x.EventEmitter),this.onProtocolChange=this._onProtocolChange.event,Object.keys(R)))this.addProtocol(C,R[C]);for(let g of Object.keys(B))this.addEncoding(g,B[g]);this.reset()}addProtocol(g,m){this._protocols[g]=m}addEncoding(g,m){this._encodings[g]=m}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(g){if(!this._protocols[g])throw Error(`unknown protocol "${g}"`);this._activeProtocol=g,this._onProtocolChange.fire(this._protocols[g].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(g){if(!this._encodings[g])throw Error(`unknown encoding "${g}"`);this._activeEncoding=g}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(g){if(g.col<0||g.col>=this._bufferService.cols||g.row<0||g.row>=this._bufferService.rows||4===g.button&&32===g.action||3===g.button&&32!==g.action||4!==g.button&&(2===g.action||3===g.action)||(g.col++,g.row++,32===g.action&&this._lastEvent&&this._equalEvents(this._lastEvent,g,"SGR_PIXELS"===this._activeEncoding))||!this._protocols[this._activeProtocol].restrict(g))return!1;let m=this._encodings[this._activeEncoding](g);return m&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(m):this._coreService.triggerDataEvent(m,!0)),this._lastEvent=g,!0}explainEvents(g){return{down:!!(1&g),up:!!(2&g),drag:!!(4&g),move:!!(8&g),wheel:!!(16&g)}}_equalEvents(g,m,C){if(C){if(g.x!==m.x||g.y!==m.y)return!1}else if(g.col!==m.col||g.row!==m.row)return!1;return g.button===m.button&&g.action===m.action&&g.ctrl===m.ctrl&&g.alt===m.alt&&g.shift===m.shift}};m.CoreMouseService=y([w(0,k.IBufferService),w(1,k.ICoreService)],T)},6975:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.CoreService=void 0;let k=C(1439),x=C(8460),D=C(844),R=C(2585),A=Object.freeze({insertMode:!1}),B=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),T=m.CoreService=class extends D.Disposable{constructor(g,m,C){super(),this._bufferService=g,this._logService=m,this._optionsService=C,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new x.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new x.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new x.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new x.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,k.clone)(A),this.decPrivateModes=(0,k.clone)(B)}reset(){this.modes=(0,k.clone)(A),this.decPrivateModes=(0,k.clone)(B)}triggerDataEvent(g,m=!1){if(this._optionsService.rawOptions.disableStdin)return;let C=this._bufferService.buffer;m&&this._optionsService.rawOptions.scrollOnUserInput&&C.ybase!==C.ydisp&&this._onRequestScrollToBottom.fire(),m&&this._onUserInput.fire(),this._logService.debug(`sending data "${g}"`,()=>g.split("").map(g=>g.charCodeAt(0))),this._onData.fire(g)}triggerBinaryEvent(g){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${g}"`,()=>g.split("").map(g=>g.charCodeAt(0))),this._onBinary.fire(g))}};m.CoreService=y([w(0,R.IBufferService),w(1,R.ILogService),w(2,R.IOptionsService)],T)},9074:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.DecorationService=void 0;let y=C(8055),w=C(8460),k=C(844),x=C(6106),D=0,R=0;let c=class c extends k.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new x.SortedList(g=>null==g?void 0:g.marker.line),this._onDecorationRegistered=this.register(new w.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new w.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,k.toDisposable)(()=>this.reset()))}registerDecoration(g){if(g.marker.isDisposed)return;let m=new l(g);if(m){let g=m.marker.onDispose(()=>m.dispose());m.onDispose(()=>{m&&(this._decorations.delete(m)&&this._onDecorationRemoved.fire(m),g.dispose())}),this._decorations.insert(m),this._onDecorationRegistered.fire(m)}return m}reset(){for(let g of this._decorations.values())g.dispose();this._decorations.clear()}*getDecorationsAtCell(g,m,C){var y,w,k;let x=0,D=0;for(let R of this._decorations.getKeyIterator(m))D=(x=null!==(y=R.options.x)&&void 0!==y?y:0)+(null!==(w=R.options.width)&&void 0!==w?w:1),g>=x&&g<D&&(!C||(null!==(k=R.options.layer)&&void 0!==k?k:"bottom")===C)&&(yield R)}forEachDecorationAtCell(g,m,C,y){this._decorations.forEachByKey(m,m=>{var w,k,x;R=(D=null!==(w=m.options.x)&&void 0!==w?w:0)+(null!==(k=m.options.width)&&void 0!==k?k:1),g>=D&&g<R&&(!C||(null!==(x=m.options.layer)&&void 0!==x?x:"bottom")===C)&&y(m)})}};m.DecorationService=c;let l=class l extends k.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=y.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=y.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(g){super(),this.options=g,this.onRenderEmitter=this.register(new w.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new w.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=g.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.InstantiationService=m.ServiceCollection=void 0;let y=C(2585),w=C(8343);let n=class n{constructor(...g){for(let[m,C]of(this._entries=new Map,g))this.set(m,C)}set(g,m){let C=this._entries.get(g);return this._entries.set(g,m),C}forEach(g){for(let[m,C]of this._entries.entries())g(m,C)}has(g){return this._entries.has(g)}get(g){return this._entries.get(g)}};m.ServiceCollection=n,m.InstantiationService=class{constructor(){this._services=new n,this._services.set(y.IInstantiationService,this)}setService(g,m){this._services.set(g,m)}getService(g){return this._services.get(g)}createInstance(g,...m){let C=(0,w.getServiceDependencies)(g).sort((g,m)=>g.index-m.index),y=[];for(let m of C){let C=this._services.get(m.id);if(!C)throw Error(`[createInstance] ${g.name} depends on UNKNOWN service ${m.id}.`);y.push(C)}let k=C.length>0?C[0].index:m.length;if(m.length!==k)throw Error(`[createInstance] First service dependency of ${g.name} at position ${k+1} conflicts with ${m.length} static arguments`);return new g(...[...m,...y])}}},7866:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.traceCall=m.setTraceLogger=m.LogService=void 0;let k=C(844),x=C(2585),D={trace:x.LogLevelEnum.TRACE,debug:x.LogLevelEnum.DEBUG,info:x.LogLevelEnum.INFO,warn:x.LogLevelEnum.WARN,error:x.LogLevelEnum.ERROR,off:x.LogLevelEnum.OFF},R,A=m.LogService=class extends k.Disposable{get logLevel(){return this._logLevel}constructor(g){super(),this._optionsService=g,this._logLevel=x.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),R=this}_updateLogLevel(){this._logLevel=D[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(g){for(let m=0;m<g.length;m++)"function"==typeof g[m]&&(g[m]=g[m]())}_log(g,m,C){this._evalLazyOptionalParams(C),g.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+m,...C)}trace(g,...m){var C,y;this._logLevel<=x.LogLevelEnum.TRACE&&this._log(null!==(y=null===(C=this._optionsService.options.logger)||void 0===C?void 0:C.trace.bind(this._optionsService.options.logger))&&void 0!==y?y:console.log,g,m)}debug(g,...m){var C,y;this._logLevel<=x.LogLevelEnum.DEBUG&&this._log(null!==(y=null===(C=this._optionsService.options.logger)||void 0===C?void 0:C.debug.bind(this._optionsService.options.logger))&&void 0!==y?y:console.log,g,m)}info(g,...m){var C,y;this._logLevel<=x.LogLevelEnum.INFO&&this._log(null!==(y=null===(C=this._optionsService.options.logger)||void 0===C?void 0:C.info.bind(this._optionsService.options.logger))&&void 0!==y?y:console.info,g,m)}warn(g,...m){var C,y;this._logLevel<=x.LogLevelEnum.WARN&&this._log(null!==(y=null===(C=this._optionsService.options.logger)||void 0===C?void 0:C.warn.bind(this._optionsService.options.logger))&&void 0!==y?y:console.warn,g,m)}error(g,...m){var C,y;this._logLevel<=x.LogLevelEnum.ERROR&&this._log(null!==(y=null===(C=this._optionsService.options.logger)||void 0===C?void 0:C.error.bind(this._optionsService.options.logger))&&void 0!==y?y:console.error,g,m)}};m.LogService=A=y([w(0,x.IOptionsService)],A),m.setTraceLogger=function(g){R=g},m.traceCall=function(g,m,C){if("function"!=typeof C.value)throw Error("not supported");let y=C.value;C.value=function(...g){if(R.logLevel!==x.LogLevelEnum.TRACE)return y.apply(this,g);R.trace(`GlyphRenderer#${y.name}(${g.map(g=>JSON.stringify(g)).join(", ")})`);let m=y.apply(this,g);return R.trace(`GlyphRenderer#${y.name} return`,m),m}}},7302:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.OptionsService=m.DEFAULT_OPTIONS=void 0;let y=C(8460),w=C(844),k=C(6114);m.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:k.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let x=["normal","bold","100","200","300","400","500","600","700","800","900"];let a=class a extends w.Disposable{constructor(g){super(),this._onOptionChange=this.register(new y.EventEmitter),this.onOptionChange=this._onOptionChange.event;let C=Object.assign({},m.DEFAULT_OPTIONS);for(let m in g)if(m in C)try{let y=g[m];C[m]=this._sanitizeAndValidateOption(m,y)}catch(g){console.error(g)}this.rawOptions=C,this.options=Object.assign({},C),this._setupOptions()}onSpecificOptionChange(g,m){return this.onOptionChange(C=>{C===g&&m(this.rawOptions[g])})}onMultipleOptionChange(g,m){return this.onOptionChange(C=>{-1!==g.indexOf(C)&&m()})}_setupOptions(){let e=g=>{if(!(g in m.DEFAULT_OPTIONS))throw Error(`No option with key "${g}"`);return this.rawOptions[g]},i=(g,C)=>{if(!(g in m.DEFAULT_OPTIONS))throw Error(`No option with key "${g}"`);C=this._sanitizeAndValidateOption(g,C),this.rawOptions[g]!==C&&(this.rawOptions[g]=C,this._onOptionChange.fire(g))};for(let g in this.rawOptions){let m={get:e.bind(this,g),set:i.bind(this,g)};Object.defineProperty(this.options,g,m)}}_sanitizeAndValidateOption(g,C){switch(g){case"cursorStyle":var y;if(C||(C=m.DEFAULT_OPTIONS[g]),!("block"===(y=C)||"underline"===y||"bar"===y))throw Error(`"${C}" is not a valid value for ${g}`);break;case"wordSeparator":C||(C=m.DEFAULT_OPTIONS[g]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof C&&1<=C&&C<=1e3)break;C=x.includes(C)?C:m.DEFAULT_OPTIONS[g];break;case"cursorWidth":C=Math.floor(C);case"lineHeight":case"tabStopWidth":if(C<1)throw Error(`${g} cannot be less than 1, value: ${C}`);break;case"minimumContrastRatio":C=Math.max(1,Math.min(21,Math.round(10*C)/10));break;case"scrollback":if((C=Math.min(C,4294967295))<0)throw Error(`${g} cannot be less than 0, value: ${C}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(C<=0)throw Error(`${g} cannot be less than or equal to 0, value: ${C}`);break;case"rows":case"cols":if(!C&&0!==C)throw Error(`${g} must be numeric, value: ${C}`);break;case"windowsPty":C=null!=C?C:{}}return C}};m.OptionsService=a},2660:function(g,m,C){var y=this&&this.__decorate||function(g,m,C,y){var w,k=arguments.length,x=k<3?m:null===y?y=Object.getOwnPropertyDescriptor(m,C):y;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)x=Reflect.decorate(g,m,C,y);else for(var D=g.length-1;D>=0;D--)(w=g[D])&&(x=(k<3?w(x):k>3?w(m,C,x):w(m,C))||x);return k>3&&x&&Object.defineProperty(m,C,x),x},w=this&&this.__param||function(g,m){return function(C,y){m(C,y,g)}};Object.defineProperty(m,"__esModule",{value:!0}),m.OscLinkService=void 0;let k=C(2585),x=m.OscLinkService=class{constructor(g){this._bufferService=g,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(g){let m=this._bufferService.buffer;if(void 0===g.id){let C=m.addMarker(m.ybase+m.y),y={data:g,id:this._nextId++,lines:[C]};return C.onDispose(()=>this._removeMarkerFromLink(y,C)),this._dataByLinkId.set(y.id,y),y.id}let C=this._getEntryIdKey(g),y=this._entriesWithId.get(C);if(y)return this.addLineToLink(y.id,m.ybase+m.y),y.id;let w=m.addMarker(m.ybase+m.y),k={id:this._nextId++,key:this._getEntryIdKey(g),data:g,lines:[w]};return w.onDispose(()=>this._removeMarkerFromLink(k,w)),this._entriesWithId.set(k.key,k),this._dataByLinkId.set(k.id,k),k.id}addLineToLink(g,m){let C=this._dataByLinkId.get(g);if(C&&C.lines.every(g=>g.line!==m)){let g=this._bufferService.buffer.addMarker(m);C.lines.push(g),g.onDispose(()=>this._removeMarkerFromLink(C,g))}}getLinkData(g){var m;return null===(m=this._dataByLinkId.get(g))||void 0===m?void 0:m.data}_getEntryIdKey(g){return`${g.id};;${g.uri}`}_removeMarkerFromLink(g,m){let C=g.lines.indexOf(m);-1!==C&&(g.lines.splice(C,1),0===g.lines.length&&(void 0!==g.data.id&&this._entriesWithId.delete(g.key),this._dataByLinkId.delete(g.id)))}};m.OscLinkService=y([w(0,k.IBufferService)],x)},8343:(g,m)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.createDecorator=m.getServiceDependencies=m.serviceRegistry=void 0;let C="di$target",y="di$dependencies";m.serviceRegistry=new Map,m.getServiceDependencies=function(g){return g[y]||[]},m.createDecorator=function(g){if(m.serviceRegistry.has(g))return m.serviceRegistry.get(g);let r=function(g,m,w){if(3!=arguments.length)throw Error("@IServiceName-decorator can only be used to decorate a parameter");g[C]===g?g[y].push({id:r,index:w}):(g[y]=[{id:r,index:w}],g[C]=g)};return r.toString=()=>g,m.serviceRegistry.set(g,r),r}},2585:(g,m,C)=>{var y,w;Object.defineProperty(m,"__esModule",{value:!0}),m.IDecorationService=m.IUnicodeService=m.IOscLinkService=m.IOptionsService=m.ILogService=m.LogLevelEnum=m.IInstantiationService=m.ICharsetService=m.ICoreService=m.ICoreMouseService=m.IBufferService=void 0;let k=C(8343);m.IBufferService=(0,k.createDecorator)("BufferService"),m.ICoreMouseService=(0,k.createDecorator)("CoreMouseService"),m.ICoreService=(0,k.createDecorator)("CoreService"),m.ICharsetService=(0,k.createDecorator)("CharsetService"),m.IInstantiationService=(0,k.createDecorator)("InstantiationService"),(w=y||(m.LogLevelEnum=y={}))[w.TRACE=0]="TRACE",w[w.DEBUG=1]="DEBUG",w[w.INFO=2]="INFO",w[w.WARN=3]="WARN",w[w.ERROR=4]="ERROR",w[w.OFF=5]="OFF",m.ILogService=(0,k.createDecorator)("LogService"),m.IOptionsService=(0,k.createDecorator)("OptionsService"),m.IOscLinkService=(0,k.createDecorator)("OscLinkService"),m.IUnicodeService=(0,k.createDecorator)("UnicodeService"),m.IDecorationService=(0,k.createDecorator)("DecorationService")},1480:(g,m,C)=>{Object.defineProperty(m,"__esModule",{value:!0}),m.UnicodeService=void 0;let y=C(8460),w=C(225);m.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new y.EventEmitter,this.onChange=this._onChange.event;let g=new w.UnicodeV6;this.register(g),this._active=g.version,this._activeProvider=g}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(g){if(!this._providers[g])throw Error(`unknown Unicode version "${g}"`);this._active=g,this._activeProvider=this._providers[g],this._onChange.fire(g)}register(g){this._providers[g.version]=g}wcwidth(g){return this._activeProvider.wcwidth(g)}getStringCellWidth(g){let m=0,C=g.length;for(let y=0;y<C;++y){let w=g.charCodeAt(y);if(55296<=w&&w<=56319){if(++y>=C)return m+this.wcwidth(w);let k=g.charCodeAt(y);56320<=k&&k<=57343?w=1024*(w-55296)+k-56320+65536:m+=this.wcwidth(k)}m+=this.wcwidth(w)}return m}}}},m={};function i(C){var y=m[C];if(void 0!==y)return y.exports;var w=m[C]={exports:{}};return g[C].call(w.exports,w,w.exports,i),w.exports}var C={};return(()=>{Object.defineProperty(C,"__esModule",{value:!0}),C.Terminal=void 0;let g=i(9042),m=i(3236),y=i(844),w=i(5741),k=i(8285),x=i(7975),D=i(7090),R=["cols","rows"];let d=class d extends y.Disposable{constructor(g){super(),this._core=this.register(new m.Terminal(g)),this._addonManager=this.register(new w.AddonManager),this._publicOptions=Object.assign({},this._core.options);let t=g=>this._core.options[g],i=(g,m)=>{this._checkReadonlyOptions(g),this._core.options[g]=m};for(let g in this._core.options){let m={get:t.bind(this,g),set:i.bind(this,g)};Object.defineProperty(this._publicOptions,g,m)}}_checkReadonlyOptions(g){if(R.includes(g))throw Error(`Option "${g}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new x.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new D.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new k.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let g=this._core.coreService.decPrivateModes,m="none";switch(this._core.coreMouseService.activeProtocol){case"X10":m="x10";break;case"VT200":m="vt200";break;case"DRAG":m="drag";break;case"ANY":m="any"}return{applicationCursorKeysMode:g.applicationCursorKeys,applicationKeypadMode:g.applicationKeypad,bracketedPasteMode:g.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:m,originMode:g.origin,reverseWraparoundMode:g.reverseWraparound,sendFocusMode:g.sendFocus,wraparoundMode:g.wraparound}}get options(){return this._publicOptions}set options(g){for(let m in g)this._publicOptions[m]=g[m]}blur(){this._core.blur()}focus(){this._core.focus()}resize(g,m){this._verifyIntegers(g,m),this._core.resize(g,m)}open(g){this._core.open(g)}attachCustomKeyEventHandler(g){this._core.attachCustomKeyEventHandler(g)}registerLinkProvider(g){return this._core.registerLinkProvider(g)}registerCharacterJoiner(g){return this._checkProposedApi(),this._core.registerCharacterJoiner(g)}deregisterCharacterJoiner(g){this._checkProposedApi(),this._core.deregisterCharacterJoiner(g)}registerMarker(g=0){return this._verifyIntegers(g),this._core.registerMarker(g)}registerDecoration(g){var m,C,y;return this._checkProposedApi(),this._verifyPositiveIntegers(null!==(m=g.x)&&void 0!==m?m:0,null!==(C=g.width)&&void 0!==C?C:0,null!==(y=g.height)&&void 0!==y?y:0),this._core.registerDecoration(g)}hasSelection(){return this._core.hasSelection()}select(g,m,C){this._verifyIntegers(g,m,C),this._core.select(g,m,C)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(g,m){this._verifyIntegers(g,m),this._core.selectLines(g,m)}dispose(){super.dispose()}scrollLines(g){this._verifyIntegers(g),this._core.scrollLines(g)}scrollPages(g){this._verifyIntegers(g),this._core.scrollPages(g)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(g){this._verifyIntegers(g),this._core.scrollToLine(g)}clear(){this._core.clear()}write(g,m){this._core.write(g,m)}writeln(g,m){this._core.write(g),this._core.write("\r\n",m)}paste(g){this._core.paste(g)}refresh(g,m){this._verifyIntegers(g,m),this._core.refresh(g,m)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(g){this._addonManager.loadAddon(this,g)}static get strings(){return g}_verifyIntegers(...g){for(let m of g)if(m===1/0||isNaN(m)||m%1!=0)throw Error("This API only accepts integers")}_verifyPositiveIntegers(...g){for(let m of g)if(m&&(m===1/0||isNaN(m)||m%1!=0||m<0))throw Error("This API only accepts positive integers")}};C.Terminal=d})(),C})()}}]);